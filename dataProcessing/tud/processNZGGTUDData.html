<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Ben Anderson (b.anderson@soton.ac.uk, @dataknut)" />


<title>Processing, cleaning and saving NZ GREEN Grid project time use diary data</title>

<script src="processNZGGTUDData_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="processNZGGTUDData_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="processNZGGTUDData_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="processNZGGTUDData_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="processNZGGTUDData_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="processNZGGTUDData_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="processNZGGTUDData_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="processNZGGTUDData_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="processNZGGTUDData_files/navigation-1.1/tabsets.js"></script>
<script src="processNZGGTUDData_files/navigation-1.1/codefolding.js"></script>
<link href="processNZGGTUDData_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="processNZGGTUDData_files/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Processing, cleaning and saving NZ GREEN Grid project time use diary data</h1>
<h4 class="author"><em>Ben Anderson (<a href="mailto:b.anderson@soton.ac.uk">b.anderson@soton.ac.uk</a>, <code>@dataknut</code>)</em></h4>
<h4 class="date"><em>Last run at: 2018-05-10 17:39:51</em></h4>

</div>



<div id="citation" class="section level1">
<h1><span class="header-section-number">1</span> Citation</h1>
<p>If you wish to use any of the material from this report please cite as:</p>
<ul>
<li>Anderson, B. (2018) Processing, cleaning and saving NZ GREEN Grid project time use diary data, University of Otago: Dunedin, NZ.</li>
</ul>

</div>
<div id="introduction" class="section level1">
<h1><span class="header-section-number">2</span> Introduction</h1>
<p>Report circulation:</p>
<ul>
<li>Restricted to: <a href="https://www.otago.ac.nz/centre-sustainability/research/energy/otago050285.html">NZ GREEn Grid</a> project partners and contractors.</li>
</ul>
<div id="purpose" class="section level2">
<h2><span class="header-section-number">2.1</span> Purpose</h2>
<p>This report is intended to:</p>
<ul>
<li>load and clean the two time use survey datasets</li>
<li>save the cleaned data out to /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/TUD/ as two seperate files, one for each survey</li>
<li>produce summary data quality statistics</li>
</ul>
</div>
<div id="requirements" class="section level2">
<h2><span class="header-section-number">2.2</span> Requirements:</h2>
<p>Time use survey data held in /Volumes/hum-csafe/Research Projects/GREEN Grid/_RAW DATA/Time Use Diaries/:</p>
<ul>
<li>PowerCo</li>
<li>Unison</li>
</ul>
<p>A lookup table to correct mis-coding of household IDs (/Volumes/hum-csafe/Research Projects/GREEN Grid/_RAW DATA/TUD_2_GridSpyLookup.xlsx).</p>
</div>
<div id="history" class="section level2">
<h2><span class="header-section-number">2.3</span> History</h2>
<p>Generally tracked via our git.soton <a href="https://git.soton.ac.uk/ba1e12/nzGREENGrid">repo</a>:</p>
<ul>
<li><a href="https://git.soton.ac.uk/ba1e12/nzGREENGrid/commits/master">history</a></li>
<li><a href="https://git.soton.ac.uk/ba1e12/nzGREENGrid/issues">issues</a></li>
</ul>
</div>
<div id="support" class="section level2">
<h2><span class="header-section-number">2.4</span> Support</h2>
<p>This work was supported by:</p>
<ul>
<li>The <a href="https://www.otago.ac.nz/">University of Otago</a></li>
<li>The New Zealand <a href="http://www.mbie.govt.nz/">Ministry of Business, Innovation and Employment (MBIE)</a></li>
<li><a href="http://www.energy.soton.ac.uk/tag/spatialec/">SPATIALEC</a> - a <a href="http://ec.europa.eu/research/mariecurieactions/about-msca/actions/if/index_en.htm">Marie Skłodowska-Curie Global Fellowship</a> based at the University of Otago’s <a href="http://www.otago.ac.nz/centre-sustainability/staff/otago673896.html">Centre for Sustainability</a> (2017-2019) &amp; the University of Southampton’s Sustainable Energy Research Group (2019-202).</li>
</ul>
<p>This work is (c) 2018 the University of Southampton.</p>
<p>We do not ‘support’ the code but if you have a problem check the <a href="https://git.soton.ac.uk/ba1e12/nzGREENGrid/issues">issues</a> on our <a href="https://git.soton.ac.uk/ba1e12/nzGREENGrid">repo</a> and if it doesn’t already exist, open one. We might be able to fix it :-)</p>
</div>
</div>
<div id="load-files" class="section level1">
<h1><span class="header-section-number">3</span> Load files</h1>
<p>In this section we load and test the two time-use survey datasets.</p>
<div id="powerco" class="section level2">
<h2><span class="header-section-number">3.1</span> PowerCo</h2>
<p>This consists of 1 file found in /Volumes/hum-csafe/Research Projects/GREEN Grid/_RAW DATA/Time Use Diaries/Powerco/Powerco Annexes/:</p>
<ul>
<li>TUD (Merged data)_BA.csv</li>
</ul>
<p>This is a version of TUD (Merged data).csv with:</p>
<ul>
<li>small edits to correct dates</li>
<li>redundant rows removed from file header</li>
</ul>
<pre class="r"><code>tudPowerCoDT &lt;- fread(paste0(powerCoPath, &quot;TUD (Merged data)_BA.csv&quot;))

nRows &lt;- nrow(tudPowerCoDT)
print(paste0(&quot;Found &quot;, tidyNum(nRows), &quot; rows of data&quot;))</code></pre>
<pre><code>## [1] &quot;Found 352 rows of data&quot;</code></pre>
<pre class="r"><code># Remove identifying data ----
tudPowerCoDT &lt;- tudPowerCoDT[, c(&quot;RowNum&quot;, &quot;Name&quot;,&quot;EmailAddress&quot;) := NULL]

# Fix names of variables ----
tudPowerCoDT &lt;- data.table::setnames(tudPowerCoDT, 
                                    c(&quot;Family size&quot;, &quot;Choose the date of your diary / entry:&quot;), 
                                    c(&quot;ba_nPeople&quot;, &quot;diaryDate&quot;)
)

# Fix dates ----
tudPowerCoDT &lt;- tudPowerCoDT[, r_diaryDate := lubridate::mdy(diaryDate)]

# Fix the hhid
tudPowerCoDT &lt;- tudPowerCoDT[, hhID := paste0(&quot;rf_&quot;, HHCODE)]
tudPowerCoDT &lt;- tudPowerCoDT[, hhID := ifelse(as.integer(HHCODE) &lt; 10, 
                                              paste0(&quot;rf_0&quot;, HHCODE), # single digit so needs &#39;0&#39;
                                                     hhID)]

# Summary table ----
t &lt;- tudPowerCoDT[, .(nDiaries = .N,
                      familySize = mean(ba_nPeople, na.rm = TRUE),
                      minDiaryDate = min(r_diaryDate),
                      maxDiaryDate = max(r_diaryDate)), keyby = .(hhID)]

knitr::kable(caption = &quot;Summary of PowerCo diaries by household&quot;, t)</code></pre>
<table>
<caption>Summary of PowerCo diaries by household</caption>
<thead>
<tr class="header">
<th align="left">hhID</th>
<th align="right">nDiaries</th>
<th align="right">familySize</th>
<th align="left">minDiaryDate</th>
<th align="left">maxDiaryDate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">rf_06</td>
<td align="right">14</td>
<td align="right">2.000000</td>
<td align="left">2014-08-23</td>
<td align="left">2014-08-29</td>
</tr>
<tr class="even">
<td align="left">rf_07</td>
<td align="right">14</td>
<td align="right">3.000000</td>
<td align="left">2014-08-25</td>
<td align="left">2014-08-31</td>
</tr>
<tr class="odd">
<td align="left">rf_08</td>
<td align="right">7</td>
<td align="right">1.000000</td>
<td align="left">2014-08-23</td>
<td align="left">2014-08-29</td>
</tr>
<tr class="even">
<td align="left">rf_09</td>
<td align="right">14</td>
<td align="right">2.000000</td>
<td align="left">2014-08-23</td>
<td align="left">2014-08-29</td>
</tr>
<tr class="odd">
<td align="left">rf_10</td>
<td align="right">14</td>
<td align="right">2.000000</td>
<td align="left">2014-08-23</td>
<td align="left">2014-08-29</td>
</tr>
<tr class="even">
<td align="left">rf_11</td>
<td align="right">7</td>
<td align="right">1.000000</td>
<td align="left">2014-08-23</td>
<td align="left">2014-08-29</td>
</tr>
<tr class="odd">
<td align="left">rf_12</td>
<td align="right">14</td>
<td align="right">3.000000</td>
<td align="left">2014-08-23</td>
<td align="left">2014-08-29</td>
</tr>
<tr class="even">
<td align="left">rf_13</td>
<td align="right">12</td>
<td align="right">2.000000</td>
<td align="left">2014-08-23</td>
<td align="left">2014-08-29</td>
</tr>
<tr class="odd">
<td align="left">rf_14</td>
<td align="right">43</td>
<td align="right">5.906977</td>
<td align="left">2014-08-23</td>
<td align="left">2014-08-29</td>
</tr>
<tr class="even">
<td align="left">rf_15</td>
<td align="right">14</td>
<td align="right">3.000000</td>
<td align="left">2014-08-23</td>
<td align="left">2014-08-29</td>
</tr>
<tr class="odd">
<td align="left">rf_16</td>
<td align="right">14</td>
<td align="right">3.000000</td>
<td align="left">2014-08-23</td>
<td align="left">2014-08-29</td>
</tr>
<tr class="even">
<td align="left">rf_17</td>
<td align="right">14</td>
<td align="right">2.000000</td>
<td align="left">2014-08-26</td>
<td align="left">2014-09-01</td>
</tr>
<tr class="odd">
<td align="left">rf_18</td>
<td align="right">14</td>
<td align="right">2.000000</td>
<td align="left">2014-08-23</td>
<td align="left">2014-08-29</td>
</tr>
<tr class="even">
<td align="left">rf_19</td>
<td align="right">14</td>
<td align="right">3.000000</td>
<td align="left">2014-08-23</td>
<td align="left">2014-08-29</td>
</tr>
<tr class="odd">
<td align="left">rf_20</td>
<td align="right">35</td>
<td align="right">6.000000</td>
<td align="left">2014-08-23</td>
<td align="left">2014-08-29</td>
</tr>
<tr class="even">
<td align="left">rf_21</td>
<td align="right">14</td>
<td align="right">2.000000</td>
<td align="left">2014-08-23</td>
<td align="left">2014-08-29</td>
</tr>
<tr class="odd">
<td align="left">rf_22</td>
<td align="right">14</td>
<td align="right">2.000000</td>
<td align="left">2014-08-23</td>
<td align="left">2014-08-29</td>
</tr>
<tr class="even">
<td align="left">rf_23</td>
<td align="right">14</td>
<td align="right">4.000000</td>
<td align="left">2014-08-23</td>
<td align="left">2014-08-29</td>
</tr>
<tr class="odd">
<td align="left">rf_24</td>
<td align="right">28</td>
<td align="right">4.000000</td>
<td align="left">2014-08-23</td>
<td align="left">2014-08-29</td>
</tr>
<tr class="even">
<td align="left">rf_25</td>
<td align="right">21</td>
<td align="right">4.000000</td>
<td align="left">2014-08-23</td>
<td align="left">2014-08-29</td>
</tr>
<tr class="odd">
<td align="left">rf_26</td>
<td align="right">7</td>
<td align="right">1.000000</td>
<td align="left">2014-08-23</td>
<td align="left">2014-08-29</td>
</tr>
<tr class="even">
<td align="left">rf_27</td>
<td align="right">10</td>
<td align="right">4.000000</td>
<td align="left">2014-08-23</td>
<td align="left">2014-08-29</td>
</tr>
</tbody>
</table>
<pre class="r"><code># save out safe file ----
ofile &lt;- paste0(outPath, &quot;powerCoTUDsafe.csv&quot;)
print(paste0(&quot;Saving PowerCo cleaned time use diary to &quot;, ofile))</code></pre>
<pre><code>## [1] &quot;Saving PowerCo cleaned time use diary to /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/TUD/powerCoTUDsafe.csv&quot;</code></pre>
<pre class="r"><code>write.csv(tudPowerCoDT, ofile)
print(&quot;Done&quot;)</code></pre>
<pre><code>## [1] &quot;Done&quot;</code></pre>
<p>Should all be in August 2014…</p>
<pre class="r"><code>myCaption &lt;- paste0(&quot;Data source: &quot;, powerCoPath)

plotDT &lt;- tudPowerCoDT[, .(nDiaries = .N), keyby = .(r_diaryDate)]
ggplot2::ggplot(plotDT, aes(x = r_diaryDate, y = nDiaries)) +
  geom_point() +
    scale_x_date(date_labels = &quot;%a %d %b %Y&quot;, date_breaks = &quot;1 day&quot;) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 0.5)) + 
  labs(title = &quot;Number of PowerCo diaries per day&quot;,
       caption = paste0(myCaption),
       x = &quot;Date&quot;,
       y = &quot;Total number of diaries&quot;
    
  )</code></pre>
<p><img src="processNZGGTUDData_files/figure-html/powerCoDiaryPlot-1.png" /><!-- --></p>
<pre class="r"><code>ggplot2::ggsave(paste0(outPath, &quot;powerCoTUDdates.png&quot;))</code></pre>
<pre><code>## Saving 7 x 5 in image</code></pre>
<p>In total we have 352 diaries from 22 PowerCo households.</p>
</div>
<div id="unison" class="section level2">
<h2><span class="header-section-number">3.2</span> Unison</h2>
<p>This consists of 5 files found in /Volumes/hum-csafe/Research Projects/GREEN Grid/_RAW DATA/Time Use Diaries/Unison/Unison Raw Data/Raw data with paper diaries included/Cleaned excel data files/:</p>
<ul>
<li>TUDAdult_ONE_Child_Unison_forSAS_BA.xlsx</li>
<li>TUDAdult_TWO_Children_Unison_forSAS_BA.xlsx</li>
<li>TUDAdult-THREE-Children-Unison_forSAS_BA.xlsx</li>
<li>TUDAdult-Unison-forSAS_BA.xlsx</li>
<li>TUDTeenagerorChild-Unison_forSAS_BA.xlsx</li>
</ul>
<p>As before these are copies of the original versions with slight editing to correct dates and for ease of processing. The relationship between them is currently unclear!</p>
<pre class="r"><code>#fList &lt;- c(&quot;TUDAdult_ONE_Child_Unison_forSAS_BA.xlsx&quot;, &quot;TUDAdult_TWO_Children_Unison_forSAS_BA.xlsx&quot;,
#           &quot;TUDAdult-THREE-Children-Unison_forSAS_BA.xlsx&quot;, &quot;TUDAdult-Unison-forSAS_BA.xlsx&quot;, &quot;TUDTeenagerorChild-Unison_forSAS_BA.xlsx&quot;)

# load and add sourceFile for easy tracking of errors
tudUnison1chDT &lt;- data.table::as.data.table(read_xlsx(paste0(unisonPath, &quot;TUDAdult_ONE_Child_Unison_forSAS_BA.xlsx&quot;)))
tudUnison1chDT$sourceFile &lt;- &quot;TUDAdult_ONE_Child_Unison_forSAS_BA.xlsx&quot;
tudUnison2chDT &lt;- data.table::as.data.table(read_xlsx(paste0(unisonPath, &quot;TUDAdult_TWO_Children_Unison_forSAS_BA.xlsx&quot;)))
tudUnison2chDT$sourceFile &lt;- &quot;TUDAdult_TWO_Children_Unison_forSAS_BA.xlsx&quot;
tudUnison3chDT &lt;- data.table::as.data.table(read_xlsx(paste0(unisonPath, &quot;TUDAdult-THREE-Children-Unison_forSAS_BA.xlsx&quot;)))
tudUnison3chDT$sourceFile &lt;- &quot;TUDAdult-THREE-Children-Unison_forSAS_BA.xlsx&quot;
tudUnisonAdultDT &lt;- data.table::as.data.table(read_xlsx(paste0(unisonPath, &quot;TUDAdult-Unison-forSAS_BA.xlsx&quot;)))
tudUnisonAdultDT$sourceFile &lt;- &quot;TUDAdult-Unison-forSAS_BA.xlsx&quot;
tudUnisonTeenChDT &lt;- data.table::as.data.table(read_xlsx(paste0(unisonPath, &quot;TUDTeenagerorChild-Unison_forSAS_BA.xlsx&quot;)))
tudUnisonTeenChDT$sourceFile &lt;- &quot;TUDTeenagerorChild-Unison_forSAS_BA.xlsx&quot;

nRows &lt;- nrow(tudUnison1chDT) + nrow(tudUnison2chDT) + nrow(tudUnison3chDT) + nrow(tudUnisonAdultDT) + nrow(tudUnisonTeenChDT)
print(paste0(&quot;Found &quot;, tidyNum(nRows), &quot; rows in total&quot;))</code></pre>
<pre><code>## [1] &quot;Found 352 rows in total&quot;</code></pre>
<p>Now process the Unison data.</p>
<pre class="r"><code>processUnison &lt;- function(dt){
  # Fix names of variables ----
  # do not rename as it&#39;s then hard to trace errors
  dt &lt;- dt[, r_diaryDate := `Choose the date of your diary / entry:`]
  dt &lt;- dt[, code := `Please enter your designated / CODE`]

  # Fix dates ----
  #dt &lt;- dt[, r_diaryDate := lubridate::dmy(diaryDate)] # not needed as read_xls gets it right :-)
  #dt &lt;- dt[, r_surveyStart := lubridate::dmy_hms(StartDate)]
  #dt &lt;- dt[, r_surveyEnd := lubridate::dmy_hms(EndDate)]
  
  # Fix hhID ----
  dt &lt;- dt[, tudCode := substr(code, 0, 2)] # extracts char 1
}

tudUnison1chDT &lt;- processUnison(tudUnison1chDT)
tudUnison2chDT &lt;- processUnison(tudUnison2chDT)
tudUnison3chDT &lt;- processUnison(tudUnison3chDT)
tudUnisonAdultDT &lt;- processUnison(tudUnisonAdultDT)
tudUnisonTeenChDT &lt;- processUnison(tudUnisonTeenChDT)


# join them together ----
# column name explosion
l &lt;- list(tudUnison1chDT,tudUnison2chDT,tudUnison3chDT,tudUnisonAdultDT,tudUnisonTeenChDT)
tudUnisonAllDT &lt;- data.table::rbindlist(l, fill = TRUE)

# Check for non-parsed diary dates
t &lt;- head(tudUnisonAllDT[is.na(r_diaryDate),.(r_diaryDate, tudCode)])
knitr::kable(caption = &quot;Test diaryDates that did not parse&quot;, t)</code></pre>
<table>
<caption>Test diaryDates that did not parse</caption>
<thead>
<tr class="header">
<th align="left">r_diaryDate</th>
<th align="left">tudCode</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<pre class="r"><code># report edited diary dates (done in .xlsx)
t &lt;- tudUnisonAllDT[!is.na(dateNote),.(r_diaryDate, tudCode, dateNote, sourceFile)]
knitr::kable(caption = &quot;Report diaries with edited diary dates (done in .xlsx before loading)&quot;, t)</code></pre>
<table>
<caption>Report diaries with edited diary dates (done in .xlsx before loading)</caption>
<thead>
<tr class="header">
<th align="left">r_diaryDate</th>
<th align="left">tudCode</th>
<th align="left">dateNote</th>
<th align="left">sourceFile</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2015-07-20</td>
<td align="left">28</td>
<td align="left">imputed</td>
<td align="left">TUDAdult_ONE_Child_Unison_forSAS_BA.xlsx</td>
</tr>
<tr class="even">
<td align="left">2015-07-21</td>
<td align="left">28</td>
<td align="left">imputed</td>
<td align="left">TUDAdult_ONE_Child_Unison_forSAS_BA.xlsx</td>
</tr>
<tr class="odd">
<td align="left">2015-07-20</td>
<td align="left">33</td>
<td align="left">imputed</td>
<td align="left">TUDAdult_ONE_Child_Unison_forSAS_BA.xlsx</td>
</tr>
<tr class="even">
<td align="left">2015-07-20</td>
<td align="left">39</td>
<td align="left">imputed</td>
<td align="left">TUDAdult_ONE_Child_Unison_forSAS_BA.xlsx</td>
</tr>
<tr class="odd">
<td align="left">2015-07-23</td>
<td align="left">39</td>
<td align="left">imputed</td>
<td align="left">TUDAdult_ONE_Child_Unison_forSAS_BA.xlsx</td>
</tr>
<tr class="even">
<td align="left">2015-07-24</td>
<td align="left">39</td>
<td align="left">imputed</td>
<td align="left">TUDAdult_ONE_Child_Unison_forSAS_BA.xlsx</td>
</tr>
<tr class="odd">
<td align="left">2015-07-26</td>
<td align="left">39</td>
<td align="left">imputed</td>
<td align="left">TUDAdult_ONE_Child_Unison_forSAS_BA.xlsx</td>
</tr>
<tr class="even">
<td align="left">2015-07-20</td>
<td align="left">39</td>
<td align="left">imputed</td>
<td align="left">TUDAdult_ONE_Child_Unison_forSAS_BA.xlsx</td>
</tr>
<tr class="odd">
<td align="left">2015-07-20</td>
<td align="left">41</td>
<td align="left">might actually be the 20th</td>
<td align="left">TUDAdult_TWO_Children_Unison_forSAS_BA.xlsx</td>
</tr>
<tr class="even">
<td align="left">2015-07-21</td>
<td align="left">41</td>
<td align="left">might actually be the 21st</td>
<td align="left">TUDAdult_TWO_Children_Unison_forSAS_BA.xlsx</td>
</tr>
<tr class="odd">
<td align="left">2015-07-20</td>
<td align="left">41</td>
<td align="left">imputed from StartDate</td>
<td align="left">TUDAdult_TWO_Children_Unison_forSAS_BA.xlsx</td>
</tr>
<tr class="even">
<td align="left">2015-07-21</td>
<td align="left">41</td>
<td align="left">imputed from StartDate</td>
<td align="left">TUDAdult_TWO_Children_Unison_forSAS_BA.xlsx</td>
</tr>
<tr class="odd">
<td align="left">2015-07-22</td>
<td align="left">41</td>
<td align="left">imputed from StartDate</td>
<td align="left">TUDAdult_TWO_Children_Unison_forSAS_BA.xlsx</td>
</tr>
<tr class="even">
<td align="left">2015-07-23</td>
<td align="left">41</td>
<td align="left">imputed from StartDate</td>
<td align="left">TUDAdult_TWO_Children_Unison_forSAS_BA.xlsx</td>
</tr>
<tr class="odd">
<td align="left">2015-07-24</td>
<td align="left">41</td>
<td align="left">imputed from StartDate</td>
<td align="left">TUDAdult_TWO_Children_Unison_forSAS_BA.xlsx</td>
</tr>
<tr class="even">
<td align="left">2015-07-25</td>
<td align="left">41</td>
<td align="left">imputed from StartDate</td>
<td align="left">TUDAdult_TWO_Children_Unison_forSAS_BA.xlsx</td>
</tr>
<tr class="odd">
<td align="left">2015-07-26</td>
<td align="left">41</td>
<td align="left">imputed from StartDate</td>
<td align="left">TUDAdult_TWO_Children_Unison_forSAS_BA.xlsx</td>
</tr>
<tr class="even">
<td align="left">2015-07-21</td>
<td align="left">31</td>
<td align="left">corrected to July from Feb</td>
<td align="left">TUDTeenagerorChild-Unison_forSAS_BA.xlsx</td>
</tr>
<tr class="odd">
<td align="left">2015-07-26</td>
<td align="left">45</td>
<td align="left">25/7/2015 missing in original</td>
<td align="left">TUDTeenagerorChild-Unison_forSAS_BA.xlsx</td>
</tr>
</tbody>
</table>
<pre class="r"><code># Summary table ----
t &lt;- tudUnisonAllDT[, .(nDiaries = .N,
                      minDiaryDate = min(r_diaryDate),
                      maxDiaryDate = max(r_diaryDate)), keyby = .(tudCode)]

knitr::kable(caption = &quot;Summary of Unison diaries by household&quot;, t)</code></pre>
<table>
<caption>Summary of Unison diaries by household</caption>
<thead>
<tr class="header">
<th align="left">tudCode</th>
<th align="right">nDiaries</th>
<th align="left">minDiaryDate</th>
<th align="left">maxDiaryDate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">NA</td>
<td align="right">3</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">28</td>
<td align="right">21</td>
<td align="left">2015-07-20</td>
<td align="left">2015-07-26</td>
</tr>
<tr class="odd">
<td align="left">29</td>
<td align="right">14</td>
<td align="left">2015-07-20</td>
<td align="left">2015-07-26</td>
</tr>
<tr class="even">
<td align="left">30</td>
<td align="right">14</td>
<td align="left">2015-07-20</td>
<td align="left">2015-07-26</td>
</tr>
<tr class="odd">
<td align="left">31</td>
<td align="right">21</td>
<td align="left">2015-07-20</td>
<td align="left">2015-07-26</td>
</tr>
<tr class="even">
<td align="left">32</td>
<td align="right">21</td>
<td align="left">2015-07-20</td>
<td align="left">2015-07-26</td>
</tr>
<tr class="odd">
<td align="left">33</td>
<td align="right">14</td>
<td align="left">2015-07-20</td>
<td align="left">2015-07-26</td>
</tr>
<tr class="even">
<td align="left">34</td>
<td align="right">14</td>
<td align="left">2015-07-20</td>
<td align="left">2015-07-26</td>
</tr>
<tr class="odd">
<td align="left">35</td>
<td align="right">14</td>
<td align="left">2015-07-20</td>
<td align="left">2015-07-26</td>
</tr>
<tr class="even">
<td align="left">36</td>
<td align="right">14</td>
<td align="left">2015-07-20</td>
<td align="left">2015-07-26</td>
</tr>
<tr class="odd">
<td align="left">37</td>
<td align="right">14</td>
<td align="left">2015-07-20</td>
<td align="left">2015-07-26</td>
</tr>
<tr class="even">
<td align="left">38</td>
<td align="right">21</td>
<td align="left">2015-07-20</td>
<td align="left">2015-07-26</td>
</tr>
<tr class="odd">
<td align="left">39</td>
<td align="right">21</td>
<td align="left">2015-07-20</td>
<td align="left">2015-07-26</td>
</tr>
<tr class="even">
<td align="left">40</td>
<td align="right">14</td>
<td align="left">2015-07-20</td>
<td align="left">2015-07-26</td>
</tr>
<tr class="odd">
<td align="left">41</td>
<td align="right">21</td>
<td align="left">2015-07-20</td>
<td align="left">2015-07-26</td>
</tr>
<tr class="even">
<td align="left">42</td>
<td align="right">21</td>
<td align="left">2015-07-20</td>
<td align="left">2015-07-26</td>
</tr>
<tr class="odd">
<td align="left">43</td>
<td align="right">14</td>
<td align="left">2015-08-03</td>
<td align="left">2015-08-09</td>
</tr>
<tr class="even">
<td align="left">44</td>
<td align="right">14</td>
<td align="left">2015-07-20</td>
<td align="left">2015-07-26</td>
</tr>
<tr class="odd">
<td align="left">45</td>
<td align="right">37</td>
<td align="left">2015-07-20</td>
<td align="left">2015-07-26</td>
</tr>
<tr class="even">
<td align="left">46</td>
<td align="right">11</td>
<td align="left">2015-07-20</td>
<td align="left">2015-07-26</td>
</tr>
<tr class="odd">
<td align="left">47</td>
<td align="right">14</td>
<td align="left">2015-07-20</td>
<td align="left">2015-07-26</td>
</tr>
</tbody>
</table>
<p>All of the diaries should be in July/August 2015…</p>
<pre class="r"><code>myCaption &lt;- paste0(&quot;Data source: &quot;, unisonPath)

plotDT &lt;- tudUnisonAllDT[, .(nDiaries = .N), keyby = .(r_diaryDate)]
ggplot2::ggplot(plotDT, aes(x = as.Date(r_diaryDate), y = nDiaries)) +
  geom_point() +
    scale_x_date(date_labels = &quot;%a %d %b %Y&quot;, date_breaks = &quot;1 day&quot;) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 0.5)) + 
  labs(title = &quot;Number of Unison diaries per day&quot;,
       caption = paste0(myCaption),
       x = &quot;Date&quot;,
       y = &quot;Total number of diaries&quot;
    
  )</code></pre>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
<p><img src="processNZGGTUDData_files/figure-html/unisonDiaryPLot-1.png" /><!-- --></p>
<pre class="r"><code>ggplot2::ggsave(paste0(outPath, &quot;unisonTUDdates.png&quot;))</code></pre>
<pre><code>## Saving 7 x 5 in image</code></pre>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
<p>If any of them are earlier than July 2015 they are flagged below for ease of fixing.</p>
<pre class="r"><code>t &lt;- tudUnisonAllDT[r_diaryDate &lt; &quot;2015-07-01&quot;, .(nDiaries = .N), keyby = .(r_diaryDate, tudCode, sourceFile)]
cap &lt;- paste0(&quot;Households with potential diary date errors&quot;)
knitr::kable(caption = cap, t)</code></pre>
<p>Table: Households with potential diary date errors</p>
<p>r_diaryDate tudCode sourceFile nDiaries ———— ——– ———– ———</p>
<p>The tudCodes are <em>not</em> the gridSpy ids, we need to create these from the unison sheet in /Volumes/hum-csafe/Research Projects/GREEN Grid/_RAW DATA/TUD_2_GridSpyLookup.xlsx.</p>
<pre class="r"><code>unisonLinkLUTDT &lt;- data.table::as.data.table(read_xlsx(paste0(linkLUT), sheet = &quot;unison&quot;))

knitr::kable(caption = &quot;Linking table&quot;, unisonLinkLUTDT)</code></pre>
<table>
<caption>Linking table</caption>
<thead>
<tr class="header">
<th align="right">CODE</th>
<th align="left">tag_gridSpy_Hhid</th>
<th align="left">source</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">28</td>
<td align="left">rf_33</td>
<td align="left">unison</td>
</tr>
<tr class="even">
<td align="right">29</td>
<td align="left">rf_46</td>
<td align="left">unison</td>
</tr>
<tr class="odd">
<td align="right">30</td>
<td align="left">rf_37</td>
<td align="left">unison</td>
</tr>
<tr class="even">
<td align="right">31</td>
<td align="left">rf_28</td>
<td align="left">unison</td>
</tr>
<tr class="odd">
<td align="right">32</td>
<td align="left">rf_39</td>
<td align="left">unison</td>
</tr>
<tr class="even">
<td align="right">33</td>
<td align="left">rf_29</td>
<td align="left">unison</td>
</tr>
<tr class="odd">
<td align="right">34</td>
<td align="left">rf_30</td>
<td align="left">unison</td>
</tr>
<tr class="even">
<td align="right">35</td>
<td align="left">rf_31</td>
<td align="left">unison</td>
</tr>
<tr class="odd">
<td align="right">36</td>
<td align="left">rf_43</td>
<td align="left">unison</td>
</tr>
<tr class="even">
<td align="right">37</td>
<td align="left">rf_35</td>
<td align="left">unison</td>
</tr>
<tr class="odd">
<td align="right">38</td>
<td align="left">rf_44</td>
<td align="left">unison</td>
</tr>
<tr class="even">
<td align="right">39</td>
<td align="left">rf_41</td>
<td align="left">unison</td>
</tr>
<tr class="odd">
<td align="right">40</td>
<td align="left">rf_36</td>
<td align="left">unison</td>
</tr>
<tr class="even">
<td align="right">41</td>
<td align="left">rf_42</td>
<td align="left">unison</td>
</tr>
<tr class="odd">
<td align="right">42</td>
<td align="left">rf_34</td>
<td align="left">unison</td>
</tr>
<tr class="even">
<td align="right">43</td>
<td align="left">rf_38</td>
<td align="left">unison</td>
</tr>
<tr class="odd">
<td align="right">43</td>
<td align="left">rf_38</td>
<td align="left">unison</td>
</tr>
<tr class="even">
<td align="right">44</td>
<td align="left">rf_32</td>
<td align="left">unison</td>
</tr>
<tr class="odd">
<td align="right">45</td>
<td align="left">rf_47</td>
<td align="left">unison</td>
</tr>
<tr class="even">
<td align="right">46</td>
<td align="left">rf_45</td>
<td align="left">unison</td>
</tr>
<tr class="odd">
<td align="right">47</td>
<td align="left">rf_40</td>
<td align="left">unison</td>
</tr>
</tbody>
</table>
<pre class="r"><code>tudUnisonAllDT &lt;- tudUnisonAllDT[, linkCode := as.character(tudCode)]
setkey(tudUnisonAllDT, linkCode)
unisonLinkLUTDT &lt;- unisonLinkLUTDT[, linkCode := as.character(CODE)]
setkey(unisonLinkLUTDT, linkCode)

tudUnisonAllDT &lt;- tudUnisonAllDT[unisonLinkLUTDT] # link them

tudUnisonAllDT &lt;- tudUnisonAllDT[, hhID := tag_gridSpy_Hhid]

# check

t &lt;- tudUnisonAllDT[, .(nDiaries = .N), keyby = .(linkCode, hhID)]
knitr::kable(caption = &quot;Check linkage: there should be 1 or 2 diaries for each combination&quot;, t)</code></pre>
<table>
<caption>Check linkage: there should be 1 or 2 diaries for each combination</caption>
<thead>
<tr class="header">
<th align="left">linkCode</th>
<th align="left">hhID</th>
<th align="right">nDiaries</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">28</td>
<td align="left">rf_33</td>
<td align="right">21</td>
</tr>
<tr class="even">
<td align="left">29</td>
<td align="left">rf_46</td>
<td align="right">14</td>
</tr>
<tr class="odd">
<td align="left">30</td>
<td align="left">rf_37</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">31</td>
<td align="left">rf_28</td>
<td align="right">21</td>
</tr>
<tr class="odd">
<td align="left">32</td>
<td align="left">rf_39</td>
<td align="right">21</td>
</tr>
<tr class="even">
<td align="left">33</td>
<td align="left">rf_29</td>
<td align="right">14</td>
</tr>
<tr class="odd">
<td align="left">34</td>
<td align="left">rf_30</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">35</td>
<td align="left">rf_31</td>
<td align="right">14</td>
</tr>
<tr class="odd">
<td align="left">36</td>
<td align="left">rf_43</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">37</td>
<td align="left">rf_35</td>
<td align="right">14</td>
</tr>
<tr class="odd">
<td align="left">38</td>
<td align="left">rf_44</td>
<td align="right">21</td>
</tr>
<tr class="even">
<td align="left">39</td>
<td align="left">rf_41</td>
<td align="right">21</td>
</tr>
<tr class="odd">
<td align="left">40</td>
<td align="left">rf_36</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">41</td>
<td align="left">rf_42</td>
<td align="right">21</td>
</tr>
<tr class="odd">
<td align="left">42</td>
<td align="left">rf_34</td>
<td align="right">21</td>
</tr>
<tr class="even">
<td align="left">43</td>
<td align="left">rf_38</td>
<td align="right">28</td>
</tr>
<tr class="odd">
<td align="left">44</td>
<td align="left">rf_32</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">45</td>
<td align="left">rf_47</td>
<td align="right">37</td>
</tr>
<tr class="odd">
<td align="left">46</td>
<td align="left">rf_45</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="left">47</td>
<td align="left">rf_40</td>
<td align="right">14</td>
</tr>
</tbody>
</table>
<p>In total we have 363 diaries from 20 Unison households.</p>
<pre class="r"><code># save out safe file ----
ofile &lt;- paste0(outPath, &quot;unisonTUDsafe.csv&quot;)
print(paste0(&quot;Saving Unison cleaned time use diary to &quot;, ofile))</code></pre>
<pre><code>## [1] &quot;Saving Unison cleaned time use diary to /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/TUD/unisonTUDsafe.csv&quot;</code></pre>
<pre class="r"><code>write.csv(tudUnisonAllDT, ofile)
print(&quot;Done&quot;)</code></pre>
<pre><code>## [1] &quot;Done&quot;</code></pre>
</div>
</div>
<div id="runtime" class="section level1">
<h1><span class="header-section-number">4</span> Runtime</h1>
<pre class="r"><code>t &lt;- proc.time() - startTime

elapsed &lt;- t[[3]]</code></pre>
<p>Analysis completed in 13.217 seconds ( 0.22 minutes) using <a href="https://cran.r-project.org/package=knitr">knitr</a> in <a href="http://www.rstudio.com">RStudio</a> with R version 3.4.4 (2018-03-15) running on x86_64-apple-darwin15.6.0.</p>
</div>
<div id="r-environment" class="section level1">
<h1><span class="header-section-number">5</span> R environment</h1>
<p>R packages used: data.table, lubridate, ggplot2, readr, dplyr, readxl, knitr</p>
<ul>
<li>base R - for the basics <span class="citation">(R Core Team 2016)</span></li>
<li>data.table - for fast (big) data handling <span class="citation">(Dowle et al. 2015)</span></li>
<li>lubridate - date manipulation <span class="citation">(Grolemund and Wickham 2011)</span></li>
<li>ggplot2 - for slick graphics <span class="citation">(Wickham 2009)</span></li>
<li>readr - for csv reading/writing <span class="citation">(Wickham, Hester, and Francois 2016)</span></li>
<li>dplyr - for select and contains <span class="citation">(Wickham and Francois 2016)</span></li>
<li>knitr - to create this document <span class="citation">(Xie 2016)</span></li>
<li>greenGridr - for local NZ GREEN Grid utilities</li>
</ul>
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>## R version 3.4.4 (2018-03-15)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS High Sierra 10.13.4
## 
## Matrix products: default
## BLAS: /Library/Frameworks/R.framework/Versions/3.4/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.4/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_GB.UTF-8/en_GB.UTF-8/en_GB.UTF-8/C/en_GB.UTF-8/en_GB.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] knitr_1.20          readxl_1.1.0        dplyr_0.7.4        
## [4] readr_1.1.1         ggplot2_2.2.1       lubridate_1.7.4    
## [7] data.table_1.10.4-3 greenGridr_0.1.0   
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_0.12.16      bindr_0.1.1       magrittr_1.5     
##  [4] hms_0.4.2         munsell_0.4.3     colorspace_1.3-2 
##  [7] R6_2.2.2          rlang_0.2.0.9001  highr_0.6        
## [10] stringr_1.3.0     plyr_1.8.4        tools_3.4.4      
## [13] grid_3.4.4        gtable_0.2.0      htmltools_0.3.6  
## [16] assertthat_0.2.0  yaml_2.1.18       lazyeval_0.2.1   
## [19] rprojroot_1.3-2   digest_0.6.15     tibble_1.4.2     
## [22] bindrcpp_0.2.2    glue_1.2.0        evaluate_0.10.1  
## [25] rmarkdown_1.9     labeling_0.3      stringi_1.1.7    
## [28] cellranger_1.1.0  compiler_3.4.4    pillar_1.2.2     
## [31] scales_0.5.0.9000 backports_1.1.2   pkgconfig_2.0.1</code></pre>
<div id="refs" class="references">
<div id="ref-data.table">
<p>Dowle, M, A Srinivasan, T Short, S Lianoglou with contributions from R Saporta, and E Antonyan. 2015. <em>Data.table: Extension of Data.frame</em>. <a href="https://CRAN.R-project.org/package=data.table" class="uri">https://CRAN.R-project.org/package=data.table</a>.</p>
</div>
<div id="ref-lubridate">
<p>Grolemund, Garrett, and Hadley Wickham. 2011. “Dates and Times Made Easy with lubridate.” <em>Journal of Statistical Software</em> 40 (3): 1–25. <a href="http://www.jstatsoft.org/v40/i03/" class="uri">http://www.jstatsoft.org/v40/i03/</a>.</p>
</div>
<div id="ref-baseR">
<p>R Core Team. 2016. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/" class="uri">https://www.R-project.org/</a>.</p>
</div>
<div id="ref-ggplot2">
<p>Wickham, Hadley. 2009. <em>Ggplot2: Elegant Graphics for Data Analysis</em>. Springer-Verlag New York. <a href="http://ggplot2.org" class="uri">http://ggplot2.org</a>.</p>
</div>
<div id="ref-dplyr">
<p>Wickham, Hadley, and Romain Francois. 2016. <em>Dplyr: A Grammar of Data Manipulation</em>. <a href="https://CRAN.R-project.org/package=dplyr" class="uri">https://CRAN.R-project.org/package=dplyr</a>.</p>
</div>
<div id="ref-readr">
<p>Wickham, Hadley, Jim Hester, and Romain Francois. 2016. <em>Readr: Read Tabular Data</em>. <a href="https://CRAN.R-project.org/package=readr" class="uri">https://CRAN.R-project.org/package=readr</a>.</p>
</div>
<div id="ref-knitr">
<p>Xie, Yihui. 2016. <em>Knitr: A General-Purpose Package for Dynamic Report Generation in R</em>. <a href="https://CRAN.R-project.org/package=knitr" class="uri">https://CRAN.R-project.org/package=knitr</a>.</p>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
