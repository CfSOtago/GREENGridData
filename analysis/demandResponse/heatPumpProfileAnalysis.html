<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Carsten Dortans (xxx@otago.ac.nz)" />


<title>Technical Potential of Demand Response</title>

<script src="heatPumpProfileAnalysis_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="heatPumpProfileAnalysis_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="heatPumpProfileAnalysis_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="heatPumpProfileAnalysis_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="heatPumpProfileAnalysis_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="heatPumpProfileAnalysis_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="heatPumpProfileAnalysis_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="heatPumpProfileAnalysis_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="heatPumpProfileAnalysis_files/navigation-1.1/tabsets.js"></script>
<link href="heatPumpProfileAnalysis_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="heatPumpProfileAnalysis_files/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Technical Potential of Demand Response</h1>
<h3 class="subtitle"><em>Heat Pump Analysis</em></h3>
<h4 class="author"><em>Carsten Dortans (<a href="mailto:xxx@otago.ac.nz">xxx@otago.ac.nz</a>)</em></h4>
<h4 class="date"><em>Last run at: 2018-09-28 15:34:55</em></h4>

</div>



<div id="citation" class="section level1">
<h1><span class="header-section-number">1</span> Citation</h1>
<p>If you wish to use any of the material from this report please cite as:</p>
<ul>
<li>Dortans, C. (2018) Technical Potential of Demand Response: Heat Pump Analysis, <a href="http://www.otago.ac.nz/centre-sustainability/">Centre for Sustainability</a>, University of Otago: Dunedin, New Zealand.</li>
</ul>
<p>This work is (c) 2018 the University of Southampton.</p>

</div>
<div id="about" class="section level1">
<h1><span class="header-section-number">2</span> About</h1>
<div id="circulation" class="section level2">
<h2><span class="header-section-number">2.1</span> Circulation</h2>
<p>Report circulation:</p>
<ul>
<li>Restricted to: <a href="https://www.otago.ac.nz/centre-sustainability/research/energy/otago050285.html">NZ GREEN Grid</a> project partners and contractors.</li>
</ul>
</div>
<div id="purpose" class="section level2">
<h2><span class="header-section-number">2.2</span> Purpose</h2>
<p>This report is intended to:</p>
<ul>
<li>load and test GREEN Grid heat pump and hot water profiles.</li>
</ul>
</div>
<div id="requirements" class="section level2">
<h2><span class="header-section-number">2.3</span> Requirements:</h2>
<ul>
<li>test dataset stored at /Volumes/hum-csafe/Research Projects/GREEN Grid/cleanData/safe/gridSpy/1min/dataExtracts/</li>
</ul>
</div>
<div id="history" class="section level2">
<h2><span class="header-section-number">2.4</span> History</h2>
<p>Generally tracked via our git.soton <a href="https://git.soton.ac.uk/ba1e12/nzGREENGrid">repo</a>:</p>
<ul>
<li><a href="https://git.soton.ac.uk/ba1e12/nzGREENGrid/commits/master">history</a></li>
<li><a href="https://git.soton.ac.uk/ba1e12/nzGREENGrid/issues">issues</a></li>
</ul>
<p>Specific history of this code:</p>
<ul>
<li><a href="https://github.com/CfSOtago/GREENGrid/commits/master/analysis/demandResponse/" class="uri">https://github.com/CfSOtago/GREENGrid/commits/master/analysis/demandResponse/</a></li>
</ul>
</div>
<div id="support" class="section level2">
<h2><span class="header-section-number">2.5</span> Support</h2>
<p>This work was supported by:</p>
<ul>
<li>The <a href="https://www.otago.ac.nz/">University of Otago</a>;</li>
<li>The <a href="https://www.southampton.ac.uk/">University of Southampton</a>;</li>
<li>The New Zealand <a href="http://www.mbie.govt.nz/">Ministry of Business, Innovation and Employment (MBIE)</a> through the <a href="https://www.otago.ac.nz/centre-sustainability/research/energy/otago050285.html">NZ GREEN Grid</a> project;</li>
<li><a href="http://www.energy.soton.ac.uk/tag/spatialec/">SPATIALEC</a> - a <a href="http://ec.europa.eu/research/mariecurieactions/about-msca/actions/if/index_en.htm">Marie Skłodowska-Curie Global Fellowship</a> based at the University of Otago’s <a href="http://www.otago.ac.nz/centre-sustainability/staff/otago673896.html">Centre for Sustainability</a> (2017-2019) &amp; the University of Southampton’s Sustainable Energy Research Group (2019-2020).</li>
</ul>
<p>We do not ‘support’ the code but if you notice a problem please check the <a href="https://github.com/CfSOtago/GREENGrid/issues">issues</a> on our <a href="https://github.com/CfSOtago/GREENGrid">repo</a> and if it doesn’t already exist, please open a new one.</p>
</div>
</div>
<div id="load-data-files" class="section level1">
<h1><span class="header-section-number">3</span> Load data files</h1>
<div id="heat-pump-profiles" class="section level2">
<h2><span class="header-section-number">3.1</span> Heat pump profiles</h2>
<p>This file is the pre-aggregated data for all heat pump circuits in the GREEN Grid data for April 2015 - March 2016 (check!)</p>
<pre class="r"><code>#ggParams$profilesFile &lt;- paste0(ggParams$dataLoc, &quot;Heat #Pump_2015-04-01_2016-03-31_observations.csv.gz&quot;)</code></pre>
<p>In this section we load and describe the data files from .</p>
<pre class="r"><code>#print(paste0(&quot;Trying to load: &quot;, ggParams$profilesFile))

heatPumpProfileDT1 &lt;- data.table::as.data.table(
 readr::read_csv(&quot;/Volumes/hum-csafe/Research Projects/GREEN Grid/cleanData/safe/gridSpy/1min/dataExtracts/Heat Pump_2015-04-01_2016-03-31_observations.csv.gz&quot;,
                       col_types = cols(
                       hhID = col_character(),
                       linkID = col_character(),
                       r_dateTime = col_datetime(format = &quot;&quot;),
                       circuit = col_character(),
                       powerW = col_double() # &lt;- crucial otherwise readr infers integers for some reason
                     )
                 )
)

#heatPumpProfileDT1 &lt;- #data.table::as.data.table(readr::read_csv(ggParams$profilesFile))

heatPumpProfileDT &lt;- heatPumpProfileDT1
heatPumpProfileDT &lt;- heatPumpProfileDT[, year := lubridate::year(r_dateTime)]
heatPumpProfileDT &lt;- heatPumpProfileDT[, obsHourMin := hms::as.hms(r_dateTime)]
heatPumpProfileDT &lt;- heatPumpProfileDT[, month := lubridate::month(r_dateTime)]

heatPumpProfileDT &lt;- heatPumpProfileDT[month == 12 | month == 1 | month == 2, season := &quot;Summer&quot;]
heatPumpProfileDT &lt;- heatPumpProfileDT[month == 3 | month == 4 | month == 5, season := &quot;Autumn&quot;]
heatPumpProfileDT &lt;- heatPumpProfileDT[month == 6 | month == 7 | month == 8, season := &quot;Winter&quot;]
heatPumpProfileDT &lt;- heatPumpProfileDT[month == 9 | month == 10 | month == 11, season := &quot;Spring&quot;]

#Building daily average per season

#heatPumpProfileDT[ , 5][is.na(heatPumpProfileDT[ , 5] ) ] = 0 

heatPumpProfileDT &lt;- heatPumpProfileDT[, .(meanW = mean(powerW, na.rm = TRUE)), keyby = .(obsHourMin, season)]</code></pre>
<p>Describe using skim:</p>
<pre class="r"><code>skimr::skim(heatPumpProfileDT)</code></pre>
<pre><code>## Skim summary statistics
##  n obs: 5760 
##  n variables: 3 
## 
## ── Variable type:character ────────────────────────────────────────────────────────────────────────────────────────────
##  variable missing complete    n min max empty n_unique
##    season       0     5760 5760   6   6     0        4
## 
## ── Variable type:difftime ─────────────────────────────────────────────────────────────────────────────────────────────
##    variable missing complete    n    min        max     median n_unique
##  obsHourMin       0     5760 5760 0 secs 86340 secs 43170 secs     1440
## 
## ── Variable type:numeric ──────────────────────────────────────────────────────────────────────────────────────────────
##  variable missing complete    n   mean     sd    p0   p25    p50    p75
##     meanW       0     5760 5760 143.53 117.47 34.99 69.26 104.83 174.66
##    p100     hist
##  613.89 ▇▃▂▁▁▁▁▁</code></pre>
<p>Draw a plot of GreenGrid heat pump profiles.</p>
<pre class="r"><code>myPlot &lt;- ggplot2::ggplot(heatPumpProfileDT, aes(x = obsHourMin, colour = season)) +
  geom_point(aes(y = meanW)) +
  facet_grid(season ~ .)

myPlot</code></pre>
<div class="figure"><span id="fig:profilePlot"></span>
<img src="heatPumpProfileAnalysis_files/figure-html/profilePlot-1.png" alt="Heat pump profiles"  />
<p class="caption">
Figure 3.1: Heat pump profiles
</p>
</div>
</div>
</div>
<div id="scaling" class="section level1">
<h1><span class="header-section-number">4</span> Scaling</h1>
<div id="scaling-method-1" class="section level2">
<h2><span class="header-section-number">4.1</span> Scaling method 1</h2>
<p>Now draw a plot of what woud happen if we scaled this up to all NZ households?</p>
<p>Figure <a href="#fig:scaledUpPlots">4.1</a></p>
<pre class="r"><code>nzHH &lt;- 1549890

heatPumpProfileDT &lt;- heatPumpProfileDT[, scaledMWmethod1 := (meanW * nzHH)/10^6]

myPlot &lt;- ggplot2::ggplot(heatPumpProfileDT, aes(x = obsHourMin, colour = season)) +
  geom_point(aes(y = scaledMWmethod1)) +
  facet_grid(season ~ .)

myPlot</code></pre>
<div class="figure"><span id="fig:scaledUpPlots"></span>
<img src="heatPumpProfileAnalysis_files/figure-html/scaledUpPlots-1.png" alt="Mean Load Heat Pumps by Season"  />
<p class="caption">
Figure 4.1: Mean Load Heat Pumps by Season
</p>
</div>
</div>
<div id="scaling-method-2" class="section level2">
<h2><span class="header-section-number">4.2</span> Scaling method 2</h2>
<p>Alternative calculation method: Assuming EECA data is correct for heat pump value, 1) generating the percentage of total load (peroftotal) while telling data.table to create a new column with the calculation of the percentage. We then multiplied EECA’s total GWh with the percentage</p>
<pre class="r"><code>totalGWH&lt;-708

summeanW&lt;-heatPumpProfileDT[,sum(meanW)]



heatPumpProfileDT &lt;- heatPumpProfileDT[, EECApmMethod2 := (meanW / summeanW) * totalGWH] 

myPlot &lt;- ggplot2::ggplot(heatPumpProfileDT, aes(x = obsHourMin, colour = season)) +
  geom_point(aes(y = EECApmMethod2)) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;)

myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/new%20calc-1.png" /><!-- --></p>
</div>
</div>
<div id="aggregation-to-half-hours" class="section level1">
<h1><span class="header-section-number">5</span> Aggregation to half-hours</h1>
<p>So far we have used data at the 1 minute level. This makes for difficulties in comparison with standared electricity sector half-hourly tariff periods etc. This section takes each scaling method, aggregates to half-hours as appropriate and re-plots.</p>
<p>To do that we need to set a half-hour value from the observed time. We do this using truncate so that:</p>
<ul>
<li>13:18:00 -&gt; 13:00:00</li>
<li>13:40:00 -&gt; 13:30 etc</li>
</ul>
<blockquote>
<p>NB: This means any plots will be using the 1/2 hour value at the <em>start</em> of the period!</p>
</blockquote>
<pre class="r"><code># create a &#39;half hour&#39; variable for aggregation
heatPumpProfileDT &lt;- heatPumpProfileDT[, obsHalfHour := hms::trunc_hms(obsHourMin, 1800)] # &lt;- this truncates the time to the previous half hour (hms works in seconds so 30 mins * 60 secs = 1800 secs). e.g. 13:18:00 -&gt; 13:00:00 but 13:40:00 -&gt; 13:30 etc

# This means any plots will be using the 1/2 hour value at the  -&gt; start &lt;-  of the period!

# check
head(heatPumpProfileDT)</code></pre>
<pre><code>##    obsHourMin season     meanW scaledMWmethod1 EECApmMethod2 obsHalfHour
## 1:   00:00:00 Autumn  64.40783        99.82505    0.05515844    00:00:00
## 2:   00:00:00 Spring  55.96022        86.73218    0.04792396    00:00:00
## 3:   00:00:00 Summer  59.26967        91.86146    0.05075815    00:00:00
## 4:   00:00:00 Winter 124.01313       192.20670    0.10620402    00:00:00
## 5:   00:01:00 Autumn  63.29641        98.10247    0.05420663    00:00:00
## 6:   00:01:00 Spring  55.18319        85.52787    0.04725852    00:00:00</code></pre>
<div id="method-1" class="section level2">
<h2><span class="header-section-number">5.1</span> Method 1</h2>
<pre class="r"><code># aggregate the scaled MW to half hours
# as it is MW we need to take the mean - taking the sum would not be meaningful
method1AggDT &lt;- heatPumpProfileDT[, .(meanMW = mean(scaledMWmethod1)), 
                                  keyby = .(season, obsHalfHour)] # &lt;- takes the mean for each category of half hour &amp; season

#Change the order in facet_grid()
method1AggDT$season &lt;- factor(method1AggDT$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))

myPlot &lt;- ggplot2::ggplot(method1AggDT, aes(x = obsHalfHour, colour = season)) +
  geom_point(aes(y = meanMW)) +
  facet_grid(season ~ .) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  labs(x=&#39;Time of Day&#39;, y=&#39;Mean MW&#39;) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),       hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;), 
  hms::as.hms(&quot;20:00:00&quot;))) 

myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/aggregateMethod1-1.png" /><!-- --></p>
</div>
<div id="method-2" class="section level2">
<h2><span class="header-section-number">5.2</span> Method 2</h2>
<p>Used the EECA total NZ number for heat pump energy consumption and converted it into GWh. Converted minute data into half-hour steps. To do :-)</p>
<blockquote>
<p>NB: should you aggregate this scaling method using mean or sum? Why? :-) –&gt;Since we take the percentages of GWh we need to sum up</p>
</blockquote>
<pre class="r"><code># aggregate the percentage of GWh
method2AggDT &lt;- heatPumpProfileDT[, .(GWh = sum(EECApmMethod2)), 
                                  keyby = .(season, obsHalfHour)] # &lt;- takes the sum for each category of half hour &amp; season

#Change the order in facet_grid()
method2AggDT$season &lt;- factor(method2AggDT$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))

myPlot &lt;- ggplot2::ggplot(method2AggDT, aes(x = obsHalfHour, colour=GWh)) +
  geom_point(aes(y = GWh)) +
  ggtitle(&quot;Total New Zealand half hour heat pump energy consumption by season for 2015&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),       hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;), 
  hms::as.hms(&quot;20:00:00&quot;))) +
scale_colour_gradient(low= &quot;green&quot;, high=&quot;red&quot;)

myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/aggregateMethod2-1.png" /><!-- --></p>
</div>
</div>
<div id="branz-vs.eeca-comparison" class="section level1">
<h1><span class="header-section-number">6</span> BRANZ vs. EECA comparison</h1>
<pre class="r"><code>nzHHheatPumps &lt;- 515015 #This is based on the BRANZ report of household ownership (House condition survey 2015) and 2013 census data
wToKw &lt;- 1000
assumeDaysPerSeason &lt;- 90

heatPumpProfileDT &lt;- heatPumpProfileDT[, scaledGWh := (((meanW * nzHHheatPumps)/wToKw)*(1/60)*assumeDaysPerSeason)/1000/1000] # &lt;- convert mean W to kWh for all NZ hhs, then assumes 90 days per season and calculate GWh

sumbranzGWh &lt;- heatPumpProfileDT[, sum(scaledGWh)]


diffbranzeeca &lt;- 1-(sumbranzGWh/totalGWH)
skimr::skim(sumbranzGWh)</code></pre>
<pre><code>## 
## Skim summary statistics
## 
## ── Variable type:numeric ──────────────────────────────────────────────────────────────────────────────────────────────
##     variable missing complete n   mean sd     p0    p25    p50    p75
##  sumbranzGWh       0        1 1 638.66 NA 638.66 638.66 638.66 638.66
##    p100     hist
##  638.66 ▁▁▁▇▁▁▁▁</code></pre>
<pre class="r"><code>skimr::skim(totalGWH)</code></pre>
<pre><code>## 
## Skim summary statistics
## 
## ── Variable type:numeric ──────────────────────────────────────────────────────────────────────────────────────────────
##  variable missing complete n mean sd  p0 p25 p50 p75 p100     hist
##  totalGWH       0        1 1  708 NA 708 708 708 708  708 ▁▁▁▇▁▁▁▁</code></pre>
<pre class="r"><code>skimr::skim(diffbranzeeca)</code></pre>
<pre><code>## 
## Skim summary statistics
## 
## ── Variable type:numeric ──────────────────────────────────────────────────────────────────────────────────────────────
##       variable missing complete n  mean sd    p0   p25   p50   p75  p100
##  diffbranzeeca       0        1 1 0.098 NA 0.098 0.098 0.098 0.098 0.098
##      hist
##  ▁▁▁▇▁▁▁▁</code></pre>
<p>Wee identify that BRANZ in comination with GREENGrid Grid Spy and 2013 household ownership census data represent a 9% lower total energy consumption for heat pumps than EECA calculates.</p>
<p>EECA total energy consumption by heat pumps for 2015 (totalGWH) &lt;- 708GWh</p>
<p>BRANZ 40% of owner-occupied households and 25% of rentals own heat pumps. Energy consumption based on BRANZ proportion, Census 2013 and GREENGris Grid Spy data (sumbranzGWh) &lt;- 638GWh</p>
</div>
<div id="yearly-consumption" class="section level1">
<h1><span class="header-section-number">7</span> Yearly consumption</h1>
<p>We need the original data for this, currently the data basis is for an average day in each season.</p>
<pre class="r"><code>heatPumpProfileDT &lt;- heatPumpProfileDT[, obsHalfHour := hms::trunc_hms(obsHourMin, 1800)]</code></pre>
</div>
<div id="technical-potential-of-demand-response-scenarios-for-heat-pump-data" class="section level1">
<h1><span class="header-section-number">8</span> Technical potential of demand response: Scenarios for heat pump data</h1>
<p>We assume that peak time periods are prevalent from 6.00am-10.00am and from 4.00pm-8.00pm.</p>
<div id="load-curtailment-to-zero-sc1" class="section level2">
<h2><span class="header-section-number">8.1</span> Load curtailment to zero: SC1</h2>
<p>In this first scenario we assume that the laod during peak time periods is cut out of the consumption pattern.</p>
<div id="defining-peakoff-peak-periods" class="section level3">
<h3><span class="header-section-number">8.1.1</span> Defining peak/off-peak periods</h3>
<p>Steps: 1) Extracting peak time-periods from heat pump data 2) Building sum of GWh</p>
<pre class="r"><code>MPS &lt;- hms::as.hms(&quot;06:00:00&quot;)
MPE &lt;- hms::as.hms(&quot;10:00:00&quot;)

EPS &lt;- hms::as.hms(&quot;17:00:00&quot;)
EPE &lt;- hms::as.hms(&quot;21:00:00&quot;)

OP1S &lt;- hms::as.hms(&quot;21:30:00&quot;)
OP1E &lt;- hms::as.hms(&quot;23:30:00&quot;)

OP12S &lt;- hms::as.hms(&quot;00:00:00&quot;)
OP12E &lt;- hms::as.hms(&quot;05:30:00&quot;)

OP2S &lt;- hms::as.hms(&quot;10:30:00&quot;)
OP2E &lt;- hms::as.hms(&quot;16:30:00&quot;)



sc1data &lt;- heatPumpProfileDT
sc1data[, c(&quot;medianW&quot;, &quot;obsHourMin&quot;, &quot;meanW&quot;, &quot;nObs&quot;, &quot;sdW&quot;,
            &quot;scaledMWmethod1&quot;, &quot;EECApmMethod2&quot;):=NULL] #Deleting unnecessary columns</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;medianW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;nObs&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;sdW&#39; then assigning NULL (deleting it).</code></pre>
<pre class="r"><code>sc1data &lt;- sc1data[, .(GWh = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]


sc1data &lt;- sc1data[, Period := &quot;Not Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]</code></pre>
</div>
<div id="visualising-periods" class="section level3">
<h3><span class="header-section-number">8.1.2</span> Visualising periods</h3>
<pre class="r"><code>#Change the order in facet_grid()
sc1data$season &lt;- factor(sc1data$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))

myPlot &lt;- ggplot2::ggplot(sc1data, aes(x = obsHalfHour, color=Period)) +
  geom_point(aes(y=GWh), size=1, alpha = 1) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Total heat pump energy consumption per day by time-period&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
  scale_color_discrete(breaks=c(&quot;Off Peak 1&quot;, &quot;Morning Peak&quot;, &quot;Off Peak 2&quot;,
                                &quot;Evening Peak&quot;)) +
  scale_color_discrete(breaks=c(&quot;Off Peak 1&quot;, &quot;Morning Peak&quot;, &quot;Off Peak 2&quot;,
                                &quot;Evening Peak&quot;))+
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),       hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;), 
  hms::as.hms(&quot;20:00:00&quot;))) </code></pre>
<pre><code>## Scale for &#39;colour&#39; is already present. Adding another scale for
## &#39;colour&#39;, which will replace the existing scale.</code></pre>
<pre class="r"><code>  #scale_colour_gradient(low= &quot;green&quot;, high=&quot;red&quot;, guide = &quot;colorbar&quot;)

myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/visualising%20peak/off-peak-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Total heat pump energy consumption by time-period for 2015.jpeg&quot;,
#       dpi=600)</code></pre>
</div>
<div id="potential-load-curtailment-output-by-period-in-gwh" class="section level3">
<h3><span class="header-section-number">8.1.3</span> Potential load curtailment output by period in GWh</h3>
<pre class="r"><code>sc1data &lt;- sc1data[, .(PotCur = sum(GWh)),
                   keyby = .(season, Period)]
sc1data</code></pre>
<pre><code>##     season       Period    PotCur
##  1: Spring Evening Peak  40.78758
##  2: Spring Morning Peak  36.10921
##  3: Spring   Off Peak 1  28.78128
##  4: Spring   Off Peak 2  25.61482
##  5: Summer Evening Peak  27.80357
##  6: Summer Morning Peak  10.80551
##  7: Summer   Off Peak 1  22.60697
##  8: Summer   Off Peak 2  26.18007
##  9: Autumn Evening Peak  40.23145
## 10: Autumn Morning Peak  30.00890
## 11: Autumn   Off Peak 1  29.61507
## 12: Autumn   Off Peak 2  23.81100
## 13: Winter Evening Peak 102.90678
## 14: Winter Morning Peak  79.14425
## 15: Winter   Off Peak 1  64.48189
## 16: Winter   Off Peak 2  49.77366</code></pre>
</div>
<div id="visualising-curtailed-periods" class="section level3">
<h3><span class="header-section-number">8.1.4</span> Visualising curtailed periods</h3>
<pre class="r"><code>sc1data &lt;- heatPumpProfileDT
sc1data[, c(&quot;medianW&quot;, &quot;obsHourMin&quot;, &quot;meanW&quot;, &quot;nObs&quot;, &quot;sdW&quot;,
            &quot;scaledMWmethod1&quot;, &quot;EECApmMethod2&quot;):=NULL] #Deleting unnecessary columns</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;medianW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;obsHourMin&#39; then assigning NULL (deleting
## it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;meanW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;nObs&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;sdW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;scaledMWmethod1&#39; then assigning NULL
## (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;EECApmMethod2&#39; then assigning NULL (deleting
## it).</code></pre>
<pre class="r"><code>sc1data &lt;- sc1data[, .(GWhs1 = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

sc1data &lt;- sc1data[, Period := &quot;Not Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

sc1data &lt;- sc1data[, GWh:=GWhs1] # Creating new column GWh based on GWhs1


#sc1data &lt;- sc1data[Period == &quot;Evening Peak&quot;,
                   #GWh := 0]

sc1data &lt;- sc1data[, GWh:= ifelse(Period == &quot;Evening Peak&quot;, 0, GWh )] # If Period is Evening peak then make GWh zero
                   
sc1data &lt;- sc1data[, GWh:= ifelse(Period == &quot;Morning Peak&quot;, 0, GWh )]


#Change the order in facet_grid()
sc1data$season &lt;- factor(sc1data$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))
#setnames(sc1data, old=c(&quot;GWh&quot;), new=c(&quot;MWh&quot;))

myPlot &lt;- ggplot2::ggplot(sc1data, aes(x = obsHalfHour, y = GWh, color=GWh)) +
  geom_line(size=1) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Total heat pump load curtailment in peak time-periods by season&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
  #scale_y_continuous(breaks = c(3, 6, 9, 12)) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),       hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;), 
  hms::as.hms(&quot;20:00:00&quot;))) +
  scale_colour_gradient(low= &quot;green&quot;, high=&quot;red&quot;, guide = &quot;colorbar&quot;)

myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/setting%20peak%20periods%20to%20zero-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Total heat pump load curtailment in peak time-periods by season.jpeg&quot;,
     # dpi=600) </code></pre>
</div>
</div>
<div id="load-curtailment-of-particular-amount-sc2" class="section level2">
<h2><span class="header-section-number">8.2</span> Load curtailment of particular amount: SC2</h2>
<div id="visualising-new-load-profile" class="section level3">
<h3><span class="header-section-number">8.2.1</span> Visualising new load profile</h3>
<pre class="r"><code>sc1data &lt;- heatPumpProfileDT
sc1data[, c(&quot;medianW&quot;, &quot;obsHourMin&quot;, &quot;meanW&quot;, &quot;nObs&quot;, &quot;sdW&quot;,
            &quot;scaledMWmethod1&quot;, &quot;EECApmMethod2&quot;):=NULL] #Deleting unnecessary columns</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;medianW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;obsHourMin&#39; then assigning NULL (deleting
## it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;meanW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;nObs&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;sdW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;scaledMWmethod1&#39; then assigning NULL
## (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;EECApmMethod2&#39; then assigning NULL (deleting
## it).</code></pre>
<pre class="r"><code>sc1data &lt;- sc1data[, .(GWhs1 = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

sc1data &lt;- sc1data[, Period := &quot;Not Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

sc1data &lt;- sc1data[, GWh:=GWhs1] # Creating new column GWh based on GWhs1

sc1data &lt;- sc1data[, GWh:= ifelse(Period == &quot;Evening Peak&quot;, 0.5*GWh, GWh )] # If Period is Evening peak then change the value of GWh by 50%
                   
sc1data &lt;- sc1data[, GWh:= ifelse(Period == &quot;Morning Peak&quot;, GWh*0.5, GWh )]



#Change the order in facet_grid()
sc1data$season &lt;- factor(sc1data$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))
#setnames(sc1data, old=c(&quot;GWh&quot;), new=c(&quot;MWh&quot;))

myPlot &lt;- ggplot2::ggplot(sc1data, aes(x = obsHalfHour, y = GWh, color=GWh)) +
  geom_line(size=1) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Total heat pump load per curtailment in peak time-periods by season 50%&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
  scale_y_continuous(breaks = c(3, 6, 9, 12)) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),       hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;), 
  hms::as.hms(&quot;20:00:00&quot;))) +
  scale_colour_gradient(low= &quot;green&quot;, high=&quot;red&quot;, guide = &quot;colorbar&quot;)

myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/Curtail%20load%20based%20on%20percentage-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Total heat pump 0.5 load curtailment in peak time-periods by season.jpeg&quot;,
    #  dpi=600) </code></pre>
</div>
<div id="potential-load-curtailment-based-on-percentage-curtailed" class="section level3">
<h3><span class="header-section-number">8.2.2</span> Potential load curtailment based on percentage curtailed</h3>
<pre class="r"><code>sc1data &lt;- sc1data[, .(PotCur = sum(GWh)),
                   keyby = .(season, Period)]
sc1data</code></pre>
<pre><code>##     season       Period    PotCur
##  1: Spring Evening Peak 20.393788
##  2: Spring Morning Peak 18.054604
##  3: Spring   Off Peak 1 28.781280
##  4: Spring   Off Peak 2 25.614817
##  5: Summer Evening Peak 13.901786
##  6: Summer Morning Peak  5.402753
##  7: Summer   Off Peak 1 22.606967
##  8: Summer   Off Peak 2 26.180072
##  9: Autumn Evening Peak 20.115726
## 10: Autumn Morning Peak 15.004450
## 11: Autumn   Off Peak 1 29.615072
## 12: Autumn   Off Peak 2 23.811002
## 13: Winter Evening Peak 51.453388
## 14: Winter Morning Peak 39.572127
## 15: Winter   Off Peak 1 64.481887
## 16: Winter   Off Peak 2 49.773665</code></pre>
</div>
</div>
<div id="load-shifting-to-prior-periods-sc3" class="section level2">
<h2><span class="header-section-number">8.3</span> Load shifting to prior periods: SC3</h2>
<pre class="r"><code>sc1data &lt;- heatPumpProfileDT
sc1data[, c(&quot;medianW&quot;, &quot;obsHourMin&quot;, &quot;meanW&quot;, &quot;nObs&quot;, &quot;sdW&quot;,
            &quot;scaledMWmethod1&quot;, &quot;EECApmMethod2&quot;):=NULL] #Deleting unnecessary columns</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;medianW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;obsHourMin&#39; then assigning NULL (deleting
## it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;meanW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;nObs&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;sdW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;scaledMWmethod1&#39; then assigning NULL
## (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;EECApmMethod2&#39; then assigning NULL (deleting
## it).</code></pre>
<pre class="r"><code>sc1data &lt;- sc1data[, .(GWhs1 = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]


#Defining peak and off-peak periods
sc1data &lt;- sc1data[, Period := &quot;Not Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

#Building the sum of each peak period by season
AuMP &lt;- sc1data[season == &quot;Autumn&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhs1)]
WiMP &lt;- sc1data[season == &quot;Winter&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhs1)]
SpMP &lt;- sc1data[season == &quot;Spring&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhs1)]
SuMP &lt;- sc1data[season == &quot;Summer&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhs1)]

AuEP &lt;- sc1data[season == &quot;Autumn&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhs1)]
WiEP &lt;- sc1data[season == &quot;Winter&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhs1)]
SpEP &lt;- sc1data[season == &quot;Spring&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhs1)]
SuEP &lt;- sc1data[season == &quot;Summer&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhs1)]


#Counting number of rows that will be associated to spread the Morning Peak
AuMPHalfHours &lt;- nrow(sc1data[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
WiMPHalfHours &lt;- nrow(sc1data[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
SpMPHalfHours &lt;- nrow(sc1data[season == &quot;Spring&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
SuMPHalfHours &lt;- nrow(sc1data[season == &quot;Summer&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])

#Counting number of rows that will be associated to spread the Evening Peak
AuEPHalfHours &lt;- nrow(sc1data[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
WiEPHalfHours &lt;- nrow(sc1data[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
SpEPHalfHours &lt;- nrow(sc1data[season == &quot;Spring&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
SuEPHalfHours &lt;- nrow(sc1data[season == &quot;Summer&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])

#Calculating the proportion that each row will take on to spread the GWhs
distGWhOP1Au &lt;- AuMP/AuMPHalfHours
distGWhOP1Wi &lt;- WiMP/WiMPHalfHours
distGWhOP1Sp &lt;- SpMP/SpMPHalfHours
distGWhOP1Su &lt;- SuMP/SuMPHalfHours

distGWhOP2Au &lt;- AuEP/AuEPHalfHours
distGWhOP2Wi &lt;- WiEP/WiEPHalfHours
distGWhOP2Sp &lt;- SpEP/SpEPHalfHours
distGWhOP2Su &lt;- SuEP/SuEPHalfHours



#Adding amount of spreaded peak consumption to off-peak periods
sc1data &lt;- sc1data[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs3 :=
                     GWhs1 + distGWhOP1Au]
sc1data &lt;- sc1data[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs3 :=
                     GWhs1 + distGWhOP1Wi]
sc1data &lt;- sc1data[season == &quot;Spring&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs3 :=
                     GWhs1 + distGWhOP1Sp]
sc1data &lt;- sc1data[season == &quot;Summer&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs3 :=
                     GWhs1 + distGWhOP1Su]


sc1data &lt;- sc1data[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs3 :=
                     GWhs1 + distGWhOP2Au]
sc1data &lt;- sc1data[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs3 :=
                     GWhs1 + distGWhOP2Wi]
sc1data &lt;- sc1data[season == &quot;Spring&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs3 :=
                     GWhs1 + distGWhOP2Sp]
sc1data &lt;- sc1data[season == &quot;Summer&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs3 :=
                     GWhs1 + distGWhOP2Su]


#Setting missing values in peak periods to NULL
sc1data &lt;- sc1data[, GWhs3:= ifelse(Period ==&quot;Morning Peak&quot;,
                                  0, GWhs3)]
sc1data &lt;- sc1data[, GWhs3:= ifelse(Period ==&quot;Evening Peak&quot;,
                                  0, GWhs3)]


#Renaming GWhs3 into GWh to depict the right text in the colorbar
setnames(sc1data, old=c(&quot;GWhs3&quot;), new=c(&quot;GWh&quot;))

#Visualising only shifted consumption
#myPlot &lt;- ggplot2::ggplot(sc1data, aes(x = obsHalfHour, color=GWh)) +
  #geom_line(aes(y=GWh), size=0.5) +
  #theme(text = element_text(family = &quot;Cambria&quot;)) +
  #ggtitle(&quot;Total shifted New Zealand half hour heat pump energy consumption by season for 2015&quot;) +
  #facet_grid(season ~ .) +
  #labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
  #scale_y_continuous(breaks = c(4, 8, 12, 16)) +
  #scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;03:00:00&quot;), hms::as.hms(&quot;06:00:00&quot;),       hms::as.hms(&quot;09:00:00&quot;), hms::as.hms(&quot;12:00:00&quot;), 
  #hms::as.hms(&quot;15:00:00&quot;), hms::as.hms(&quot;18:00:00&quot;), hms::as.hms(&quot;21:00:00&quot;))) +
  #scale_colour_gradient(low= &quot;green&quot;, high=&quot;red&quot;, guide = &quot;colorbar&quot;)

#myPlot

#myPlot &lt;- ggplot2::ggplot(sc1data, aes(x = obsHalfHour)) +
 # geom_line(aes(y=GWh, color=GWh), size=0.5) +
  #geom_line(aes(y=GWhs1, color=GWhs1), size=0.5) +
 # theme(text = element_text(family = &quot;Cambria&quot;)) +
 # ggtitle(&quot;Original and shifted New Zealand half hour heat pump energy consumption by season for 2015&quot;) +
 # facet_grid(season ~ .) +
 # labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
 # scale_y_continuous(breaks = c(4, 8, 12, 16)) +
 # scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;03:00:00&quot;), hms::as.hms(&quot;06:00:00&quot;),       hms::as.hms(&quot;09:00:00&quot;), hms::as.hms(&quot;12:00:00&quot;), 
 # hms::as.hms(&quot;15:00:00&quot;), hms::as.hms(&quot;18:00:00&quot;), hms::as.hms(&quot;21:00:00&quot;))) +
 # scale_color_gradient(low= &quot;green&quot;, high=&quot;red&quot;)

#myPlot

#Change the order in facet_grid()
sc1data$season &lt;- factor(sc1data$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))

#Visualising shifted and original consumption with labels in different colours
myPlot &lt;- ggplot2::ggplot(sc1data, aes(x = obsHalfHour)) +
  geom_line(aes(y=GWh, color=&quot;red&quot;), size=0.5) +
  geom_line(aes(y=GWhs1, color=&quot;blue&quot;), size=0.5) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Original and shifted New Zealand per day half hour heat pump energy consumption by season for 2015&quot;) +
  scale_colour_manual(name = element_blank(), 
         values =c(&#39;red&#39;=&#39;red&#39;,&#39;blue&#39;=&#39;blue&#39;), labels = c(&#39;Original consumption&#39;,
                  &#39;Shifted consumption&#39;)) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
# scale_y_continuous(breaks = c(4, 8, 12, 16)) +
 scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),       hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;), 
  hms::as.hms(&quot;20:00:00&quot;)))  
  #scale_color_gradient(low= &quot;green&quot;, high=&quot;red&quot;)

myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/load%20shifting%20to%20prior%20periods-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Original and shifted New Zealand half hour heat pump energy consumption by season for 2015.jpeg&quot;,
     #  dpi=600)</code></pre>
</div>
</div>
<div id="technical-potential-of-demand-response-scenarios-for-hot-water-data" class="section level1">
<h1><span class="header-section-number">9</span> Technical potential of demand response: Scenarios for hot water data</h1>
<div id="loading-data" class="section level2">
<h2><span class="header-section-number">9.1</span> Loading data</h2>
<p>This file is the pre-aggregated data for all hot water circuits in the GREEN Grid data for April 2015 - March 2016 (check!)</p>
<pre class="r"><code>#ggParams$profilesFile &lt;- paste0(ggParams$dataLoc, &quot;Hot #Water_2015-04-01_2016-03-31_overallSeasonalProfiles.csv.gz&quot;)</code></pre>
<p>In this section we load and describe the data files from .</p>
<pre class="r"><code>#print(paste0(&quot;Trying to load: &quot;, ggParams$profilesFile))
#hotWaterProfileDT &lt;- data.table::as.data.table(readr::read_csv(ggParams$profilesFile))

HotwaterHCS &lt;- data.table::as.data.table(
 readr::read_csv(&quot;/Volumes/hum-csafe/Research Projects/GREEN Grid/cleanData/safe/gridSpy/1min/dataExtracts/Hot Water_2015-04-01_2016-03-31_observations.csv.gz&quot;,
                       col_types = cols(
                       hhID = col_character(),
                       linkID = col_character(),
                       r_dateTime = col_datetime(format = &quot;&quot;),
                       circuit = col_character(),
                       powerW = col_double() # &lt;- crucial otherwise readr infers integers for some reason
                     )
                 )
)

HotwaterObsDT &lt;- data.table::as.data.table(HotwaterHCS)

HotwaterObsDT &lt;- HotwaterObsDT[, year := lubridate::year(r_dateTime)]
HotwaterObsDT &lt;- HotwaterObsDT[, obsHourMin := hms::as.hms(r_dateTime)]
HotwaterObsDT &lt;- HotwaterObsDT[, month := lubridate::month(r_dateTime)]

HotwaterObsDT &lt;- HotwaterObsDT[month &gt;= 12 | month == 1 | month == 2, season := &quot;Summer&quot;]
HotwaterObsDT &lt;- HotwaterObsDT[month &gt;= 3 | month == 4 | month == 5, season := &quot;Autumn&quot;]
HotwaterObsDT &lt;- HotwaterObsDT[month == 6 | month == 7 | month == 8, season := &quot;Winter&quot;]
HotwaterObsDT &lt;- HotwaterObsDT[month == 9 | month == 10 | month == 11, season := &quot;Spring&quot;]

#Building daily average per season

hotWaterProfileDT &lt;- HotwaterObsDT[, .(meanW = mean(powerW)), keyby = .(obsHourMin, season)]</code></pre>
</div>
<div id="branz-vs.eeca-comparison-1" class="section level2">
<h2><span class="header-section-number">9.2</span> BRANZ vs. EECA comparison</h2>
<pre class="r"><code>totalGWH &lt;- 12727.99 * 0.2777777778 #Converting TJ (EECA 2015) into GWh
nzHH &lt;- 1549890 #Based on Census 2013
nzHHhotWater &lt;- nzHH * 0.88 #This is based on the BRANZ report HOT WATER OVER TIME– THE NEW ZEALAND EXPERIENCE (2008) No. 132; 88% of Hot Water Systems were electric in 2008

wToKw &lt;- 1000
assumeDaysPerSeason &lt;- 90

hotWaterProfileDT &lt;- hotWaterProfileDT[, scaledGWh := (((meanW * nzHHhotWater)/wToKw)*(1/60)*assumeDaysPerSeason)/1000/1000] # &lt;- convert mean W to kWh for all NZ hhs, then assumes 90 days per season and calculate GWh

sumbranzGWh &lt;- hotWaterProfileDT[, sum(scaledGWh)]


diffbranzeeca &lt;- 1-(sumbranzGWh/totalGWH)</code></pre>
<p>I have used the 2015 EECA data because our load profiles data from the year 2015 as well. This given we identify that EECA assumes 3,535 GWh whereas the combination of BRANZ and Census 2013 calculates an amount of 3,313 GWh. EECA estimates therefore a 6% higher energy consumption of hot water systems in New Zealand using electricity fuel. In the following the BRANZ calculation will be used.</p>
</div>
<div id="aggregation-to-half-hours-and-initial-plot" class="section level2">
<h2><span class="header-section-number">9.3</span> Aggregation to half-hours and initial plot</h2>
<p>So far we have used data at the 1 minute level. This makes for difficulties in comparison with standared electricity sector half-hourly tariff periods etc. This section takes each scaling method, aggregates to half-hours as appropriate and re-plots.</p>
<p>To do that we need to set a half-hour value from the observed time. We do this using truncate so that:</p>
<ul>
<li>13:18:00 -&gt; 13:00:00</li>
<li>13:40:00 -&gt; 13:30 etc</li>
</ul>
<blockquote>
<p>NB: This means any plots will be using the 1/2 hour value at the <em>start</em> of the period!</p>
</blockquote>
<pre class="r"><code># create a &#39;half hour&#39; variable for aggregation
hotWaterProfileDT &lt;- hotWaterProfileDT[, obsHalfHour := hms::trunc_hms(obsHourMin, 1800)] # &lt;- this truncates the time to the previous half hour (hms works in seconds so 30 mins * 60 secs = 1800 secs). e.g. 13:18:00 -&gt; 13:00:00 but 13:40:00 -&gt; 13:30 etc

# This means any plots will be using the 1/2 hour value at the  -&gt; start &lt;-  of the period!

method2AggDT &lt;- hotWaterProfileDT[, .(GWh = sum(scaledGWh)), 
                                  keyby = .(season, obsHalfHour)]#Building sum of half hours by season


# check
head(method2AggDT)</code></pre>
<pre><code>##    season obsHalfHour      GWh
## 1: Autumn    00:00:00 7.429713
## 2: Autumn    00:30:00 6.780614
## 3: Autumn    01:00:00 6.811152
## 4: Autumn    01:30:00 5.888405
## 5: Autumn    02:00:00 5.910528
## 6: Autumn    02:30:00 5.654303</code></pre>
<pre class="r"><code>#Change the order in facet_grid()
method2AggDT$season &lt;- factor(method2AggDT$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))


myPlot &lt;- ggplot2::ggplot(method2AggDT, aes(x = obsHalfHour, color=GWh)) +
  geom_line(aes(y=GWh), size=0.5) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Total New Zealand half hour hot water energy consumption by season for 2015&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
  scale_y_continuous(breaks = c(10, 20, 30, 40)) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;03:00:00&quot;), hms::as.hms(&quot;06:00:00&quot;),       hms::as.hms(&quot;09:00:00&quot;), hms::as.hms(&quot;12:00:00&quot;), 
  hms::as.hms(&quot;15:00:00&quot;), hms::as.hms(&quot;18:00:00&quot;), hms::as.hms(&quot;21:00:00&quot;))) +
  scale_colour_gradient(low= &quot;green&quot;, high=&quot;red&quot;, guide = &quot;colorbar&quot;)

myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/set%20halfHours2-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Total New Zealand half hour hot water energy consumption by season for 2015.jpeg&quot;,
      # dpi = 600)</code></pre>
</div>
<div id="load-curtailment-to-zero-sc1-1" class="section level2">
<h2><span class="header-section-number">9.4</span> Load curtailment to zero SC1</h2>
<pre class="r"><code>#Defining peak and off-peak

sc2data &lt;- method2AggDT

#sc2data &lt;- sc2data[, .(GWh = sum(scaledGWh)), 
 #                   keyby = .(season, obsHalfHour)]

sc2data &lt;- sc2data[, Period := &quot;Not Peak&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

#Change the order in facet_grid()
sc2data$season &lt;- factor(sc2data$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))
#setnames(sc2data, old=c(&quot;GWh&quot;), new=c(&quot;MWh&quot;))

#Visualisig peak periods

myPlot &lt;- ggplot2::ggplot(sc2data, aes(x = obsHalfHour, color=Period)) +
  geom_point(aes(y=GWh), size=1, alpha = 1) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Total New Zealand hot water energy consumption by time-period&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
  scale_color_discrete(breaks=c(&quot;Off Peak 1&quot;, &quot;Morning Peak&quot;, &quot;Off Peak 2&quot;,
                                &quot;Evening Peak&quot;)) +
  scale_y_continuous(breaks = c(10, 20, 30, 40)) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),      hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;), 
  hms::as.hms(&quot;20:00:00&quot;)))  
  #scale_colour_gradient(low= &quot;green&quot;, high=&quot;red&quot;, guide = &quot;colorbar&quot;)

myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/load%20curtailment%20hot%20water%20data-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Total New Zealand per day hot water energy consumption by time-period.jpeg&quot;,
#       dpi = 600)

#Potential load curtailment by season

sc2data &lt;- sc2data[, .(PotCur = sum(GWh)),
                   keyby = .(season, Period)]
sc2data</code></pre>
<pre><code>##     season       Period   PotCur
##  1: Spring Evening Peak 223.2705
##  2: Spring Morning Peak 261.4715
##  3: Spring   Off Peak 1 171.1496
##  4: Spring   Off Peak 2 208.4891
##  5: Summer Evening Peak 151.8508
##  6: Summer Morning Peak 163.4540
##  7: Summer   Off Peak 1 137.4521
##  8: Summer   Off Peak 2 152.6129
##  9: Autumn Evening Peak 201.5304
## 10: Autumn Morning Peak 244.0416
## 11: Autumn   Off Peak 1 153.9915
## 12: Autumn   Off Peak 2 209.3414
## 13: Winter Evening Peak 242.9733
## 14: Winter Morning Peak 284.4167
## 15: Winter   Off Peak 1 183.5473
## 16: Winter   Off Peak 2 260.5546</code></pre>
<div id="visualising-curtailed-periods-1" class="section level3">
<h3><span class="header-section-number">9.4.1</span> Visualising curtailed periods</h3>
<pre class="r"><code>sc2data &lt;- hotWaterProfileDT
sc2data[, c(&quot;medianW&quot;, &quot;obsHourMin&quot;, &quot;meanW&quot;, &quot;nObs&quot;, &quot;sdW&quot;,
            &quot;scaledMWmethod1&quot;, &quot;EECApmMethod2&quot;):=NULL] #Deleting unnecessary columns</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;medianW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;nObs&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;sdW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;scaledMWmethod1&#39; then assigning NULL
## (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;EECApmMethod2&#39; then assigning NULL (deleting
## it).</code></pre>
<pre class="r"><code>sc2data &lt;- sc2data[, .(GWhs2 = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

sc2data &lt;- sc2data[, Period := &quot;Not Peak&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

sc2data &lt;- sc2data[, GWh:=GWhs2] # Creating new column GWh based on GWhs2


sc2data &lt;- sc2data[, GWh:= ifelse(Period == &quot;Evening Peak&quot;, 0, GWh )] # If Period is Evening peak then make GWh zero
                   
sc2data &lt;- sc2data[, GWh:= ifelse(Period == &quot;Morning Peak&quot;, 0, GWh )]


#Change the order in facet_grid()
sc2data$season &lt;- factor(sc2data$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))
#setnames(sc2data, old=c(&quot;GWh&quot;), new=c(&quot;MWh&quot;))

myPlot &lt;- ggplot2::ggplot(sc2data, aes(x = obsHalfHour, y = GWh, color=GWh)) +
  geom_line(size=1) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Total hot water load curtailment in peak time-periods by season&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
  scale_y_continuous(breaks = c(10, 20, 30, 40)) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),       hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;), 
  hms::as.hms(&quot;20:00:00&quot;))) +
  scale_colour_gradient(low= &quot;green&quot;, high=&quot;red&quot;, guide = &quot;colorbar&quot;)

myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/visalising%20curtailed%20hot%20water%20consumption-1.png" /><!-- --></p>
<pre class="r"><code> #ggsave(&quot;Total hot water load curtailment in peak time-periods by season.jpeg&quot;,
        #dpi = 600)</code></pre>
</div>
</div>
<div id="load-curtailment-of-particular-amount-50-sc2" class="section level2">
<h2><span class="header-section-number">9.5</span> Load curtailment of particular amount (50%): SC2</h2>
<pre class="r"><code>sc2data &lt;- hotWaterProfileDT
sc2data[, c(&quot;medianW&quot;, &quot;obsHourMin&quot;, &quot;meanW&quot;, &quot;nObs&quot;, &quot;sdW&quot;,
            &quot;scaledMWmethod1&quot;, &quot;EECApmMethod2&quot;):=NULL] #Deleting unnecessary columns</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;medianW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;obsHourMin&#39; then assigning NULL (deleting
## it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;meanW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;nObs&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;sdW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;scaledMWmethod1&#39; then assigning NULL
## (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;EECApmMethod2&#39; then assigning NULL (deleting
## it).</code></pre>
<pre class="r"><code>sc2data &lt;- sc2data[, .(GWhs2 = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

sc2data &lt;- sc2data[, Period := &quot;Not Peak&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

sc2data &lt;- sc2data[, GWh:=GWhs2] # Creating new column GWh based on GWhs2


sc2data &lt;- sc2data[, GWh:= ifelse(Period == &quot;Evening Peak&quot;, GWh * 0.5, GWh )] # If Period is Evening peak then make GWh zero
                   
sc2data &lt;- sc2data[, GWh:= ifelse(Period == &quot;Morning Peak&quot;, GWh * 0.5, GWh )]


#Change the order in facet_grid()
sc2data$season &lt;- factor(sc2data$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))
#setnames(sc2data, old=c(&quot;GWh&quot;), new=c(&quot;MWh&quot;))

myPlot &lt;- ggplot2::ggplot(sc2data, aes(x = obsHalfHour, y = GWh, color=GWh)) +
  geom_line(size=1) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;50 per cent per day hot water load curtailment at peak time-periods by season&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
  scale_y_continuous(breaks = c(10, 20, 30, 40)) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),       hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;), 
  hms::as.hms(&quot;20:00:00&quot;)))  +
  scale_colour_gradient(low= &quot;green&quot;, high=&quot;red&quot;, guide = &quot;colorbar&quot;)

myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/hot%20water%20load%20consumption%20curtailment%20of%20particular%20amount-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;50 per cent hot water load curtailment at peak time-periods by season.jpeg&quot;,
 #      dpi = 600)</code></pre>
<div id="potential-load-curtailment-based-on-percentage" class="section level3">
<h3><span class="header-section-number">9.5.1</span> Potential load curtailment based on percentage</h3>
<pre class="r"><code>sc2data &lt;- sc2data[, .(PotCur = sum(GWh)),
                   keyby = .(season, Period)]
sc2data</code></pre>
<pre><code>##     season       Period    PotCur
##  1: Spring Evening Peak 111.63524
##  2: Spring Morning Peak 130.73577
##  3: Spring   Off Peak 1 171.14962
##  4: Spring   Off Peak 2 208.48912
##  5: Summer Evening Peak  75.92541
##  6: Summer Morning Peak  81.72698
##  7: Summer   Off Peak 1 137.45208
##  8: Summer   Off Peak 2 152.61293
##  9: Autumn Evening Peak 100.76520
## 10: Autumn Morning Peak 122.02079
## 11: Autumn   Off Peak 1 153.99151
## 12: Autumn   Off Peak 2 209.34144
## 13: Winter Evening Peak 121.48666
## 14: Winter Morning Peak 142.20837
## 15: Winter   Off Peak 1 183.54731
## 16: Winter   Off Peak 2 260.55460</code></pre>
</div>
</div>
<div id="load-shifting-to-prior-times-sc3" class="section level2">
<h2><span class="header-section-number">9.6</span> Load shifting to prior times: SC3</h2>
<pre class="r"><code>#I had to insert a 2 and 4 respectively in order to allow comparisons between sc1data and sc2data. I can now run the whole script without affecting the variables associated to sc1data


sc2data &lt;- hotWaterProfileDT
sc2data[, c(&quot;medianW&quot;, &quot;obsHourMin&quot;, &quot;meanW&quot;, &quot;nObs&quot;, &quot;sdW&quot;,
            &quot;scaledMWmethod1&quot;, &quot;EECApmMethod2&quot;):=NULL] #Deleting unnecessary columns</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;medianW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;obsHourMin&#39; then assigning NULL (deleting
## it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;meanW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;nObs&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;sdW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;scaledMWmethod1&#39; then assigning NULL
## (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;EECApmMethod2&#39; then assigning NULL (deleting
## it).</code></pre>
<pre class="r"><code>  sc2data &lt;- sc2data[, .(GWhs2 = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]


#Defining peak and off-peak periods
sc2data &lt;- sc2data[, Period := &quot;Not Peak&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

#Building the sum of each peak period by season
AuMP2 &lt;- sc2data[season == &quot;Autumn&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhs2)]
WiMP2 &lt;- sc2data[season == &quot;Winter&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhs2)]
SpMP2 &lt;- sc2data[season == &quot;Spring&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhs2)]
SuMP2 &lt;- sc2data[season == &quot;Summer&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhs2)]

AuEP2 &lt;- sc2data[season == &quot;Autumn&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhs2)]
WiEP2 &lt;- sc2data[season == &quot;Winter&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhs2)]
SpEP2 &lt;- sc2data[season == &quot;Spring&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhs2)]
SuEP2 &lt;- sc2data[season == &quot;Summer&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhs2)]


#Counting number of rows that will be associated to spread the Morning Peak
AuMPHalfHours2 &lt;- nrow(sc2data[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
WiMPHalfHours2 &lt;- nrow(sc2data[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
SpMPHalfHours2 &lt;- nrow(sc2data[season == &quot;Spring&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
SuMPHalfHours2 &lt;- nrow(sc2data[season == &quot;Summer&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])

#Counting number of rows that will be associated to spread the Evening Peak
AuEPHalfHours2 &lt;- nrow(sc2data[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
WiEPHalfHours2 &lt;- nrow(sc2data[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
SpEPHalfHours2 &lt;- nrow(sc2data[season == &quot;Spring&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
SuEPHalfHours2 &lt;- nrow(sc2data[season == &quot;Summer&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])

#Calculating the proportion that each row will take on to spread the GWhs
distGWhOP1Au2 &lt;- AuMP2/AuMPHalfHours2
distGWhOP1Wi2 &lt;- WiMP2/WiMPHalfHours2
distGWhOP1Sp2 &lt;- SpMP2/SpMPHalfHours2
distGWhOP1Su2 &lt;- SuMP2/SuMPHalfHours2

distGWhOP2Au2 &lt;- AuEP2/AuEPHalfHours2
distGWhOP2Wi2 &lt;- WiEP2/WiEPHalfHours2
distGWhOP2Sp2 &lt;- SpEP2/SpEPHalfHours2
distGWhOP2Su2 &lt;- SuEP2/SuEPHalfHours2



#Adding amount of spreaded peak consumption to off-peak periods
sc2data &lt;- sc2data[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs4 :=
                     GWhs2 + distGWhOP1Au2]
sc2data &lt;- sc2data[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs4 :=
                     GWhs2 + distGWhOP1Wi2]
sc2data &lt;- sc2data[season == &quot;Spring&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs4 :=
                     GWhs2 + distGWhOP1Sp2]
sc2data &lt;- sc2data[season == &quot;Summer&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs4 :=
                     GWhs2 + distGWhOP1Su2]


sc2data &lt;- sc2data[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs4 :=
                     GWhs2 + distGWhOP2Au2]
sc2data &lt;- sc2data[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs4 :=
                     GWhs2 + distGWhOP2Wi2]
sc2data &lt;- sc2data[season == &quot;Spring&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs4 :=
                     GWhs2 + distGWhOP2Sp2]
sc2data &lt;- sc2data[season == &quot;Summer&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs4 :=
                     GWhs2 + distGWhOP2Su2]


#Setting missing values in peak periods to NULL
sc2data &lt;- sc2data[, GWhs4:= ifelse(Period ==&quot;Morning Peak&quot;,
                                  0, GWhs4)]
sc2data &lt;- sc2data[, GWhs4:= ifelse(Period ==&quot;Evening Peak&quot;,
                                  0, GWhs4)]


#Renaming GWhs3 into GWh to depict the right text in the colorbar
setnames(sc2data, old=c(&quot;GWhs2&quot;), new=c(&quot;GWh&quot;))

#Visualising only shifted consumption
#myPlot &lt;- ggplot2::ggplot(sc2data, aes(x = obsHalfHour, color=GWh)) +
  #geom_line(aes(y=GWh), size=0.5) +
  #theme(text = element_text(family = &quot;Cambria&quot;)) +
  #ggtitle(&quot;Total shifted New Zealand half hour heat pump energy consumption by season for 2015&quot;) +
  #facet_grid(season ~ .) +
  #labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
  #scale_y_continuous(breaks = c(10, 20, 30, 40)) +
  #scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;03:00:00&quot;), hms::as.hms(&quot;06:00:00&quot;),       hms::as.hms(&quot;09:00:00&quot;), hms::as.hms(&quot;12:00:00&quot;), 
  #hms::as.hms(&quot;15:00:00&quot;), hms::as.hms(&quot;18:00:00&quot;), hms::as.hms(&quot;21:00:00&quot;))) +
  #scale_colour_gradient(low= &quot;green&quot;, high=&quot;red&quot;, guide = &quot;colorbar&quot;)

#myPlot

#Visualising shifted and original consumption
#myPlot &lt;- ggplot2::ggplot(sc2data, aes(x = obsHalfHour)) +
 # geom_line(aes(y=GWh, color=GWh), size=0.5) +
 # geom_line(aes(y=GWhs4, color=GWhs4), size=0.5) +
 # theme(text = element_text(family = &quot;Cambria&quot;)) +
 # ggtitle(&quot;Original and shifted New Zealand half hour heat pump energy consumption by season for 2015&quot;) +
#  facet_grid(season ~ .) +
#  labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
 # scale_y_continuous(breaks = c(10, 20, 30, 40)) +
#  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;03:00:00&quot;), hms::as.hms(&quot;06:00:00&quot;),       hms::as.hms(&quot;09:00:00&quot;), hms::as.hms(&quot;12:00:00&quot;), 
#  hms::as.hms(&quot;15:00:00&quot;), hms::as.hms(&quot;18:00:00&quot;), hms::as.hms(&quot;21:00:00&quot;))) +
 # scale_color_gradient(low= &quot;green&quot;, high=&quot;red&quot;)

#myPlot

sc2data$season &lt;- factor(sc2data$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))

#Visualising shifted and original consumption two colours
  myPlot &lt;- ggplot2::ggplot(sc2data, aes(x = obsHalfHour)) +
  geom_line(aes(y=GWh, color=&quot;red&quot;), size=0.5) +
  geom_line(aes(y=GWhs4, color=&quot;blue&quot;), size=0.5) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Original and shifted New Zealand half hour heat pump energy consumption by season for 2015&quot;) +
  scale_colour_manual(name = element_blank(), 
         values =c(&#39;red&#39;=&#39;red&#39;,&#39;blue&#39;=&#39;blue&#39;), labels = c(&#39;Original consumption&#39;,
                  &#39;Shifted consumption&#39;)) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
  scale_y_continuous(breaks = c(10, 20, 30, 40)) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),       hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;), 
  hms::as.hms(&quot;20:00:00&quot;))) 
 

myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/load%20shifting%20to%20prior%20periods%20hot%20water-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Original and shifted New Zealand half hour hot water energy consumption by season for 2015.jpeg&quot;,
     #  dpi=600)</code></pre>
</div>
</div>
<div id="technical-potential-of-demand-response-scenarios-for-refrigeration-data" class="section level1">
<h1><span class="header-section-number">10</span> Technical potential of demand response: Scenarios for refrigeration data</h1>
<div id="load-curtailment-to-zero" class="section level2">
<h2><span class="header-section-number">10.1</span> Load curtailment to zero</h2>
<pre class="r"><code>totalGWH&lt;-2074 #EECA fro refrigeration in 2015
nzHouseholds &lt;- 1004329 + 453135

refrigerationProfileDT &lt;- copy(heatPumpProfileDT)
refrigerationProfileDT &lt;- refrigerationProfileDT[, scaledGWh := 2074/.N]#Spreading GWh equally



sc5data &lt;- refrigerationProfileDT

sc5data &lt;- sc5data[, .(GWhREF = sum((scaledGWh)/90)*1000), 
                    keyby = .(season, obsHalfHour)]

sc5data &lt;- sc5data[, Period := &quot;Not Peak&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]


sc5data$season &lt;- factor(sc5data$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))

#Visualising peak ond off-peak
myPlot &lt;- ggplot2::ggplot(sc5data, aes(x = obsHalfHour, color=Period)) +
  geom_point(aes(y=GWhREF), size=1, alpha = 1) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Total consumption refrigeration by season&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
 # scale_y_continuous(breaks = c(20, 40, 60, 80)) +
  scale_color_discrete(breaks=c(&quot;Off Peak 1&quot;, &quot;Morning Peak&quot;, &quot;Off Peak 2&quot;,
                                &quot;Evening Peak&quot;)) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),       hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;), 
  hms::as.hms(&quot;20:00:00&quot;))) 
  #scale_colour_gradient(low= &quot;green&quot;, high=&quot;red&quot;, guide = &quot;colorbar&quot;)

myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/load%20curtialment%20to%20zero%20all%20three%20appliances%201-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Total consumption refrigeration by season.jpeg&quot;, dpi = 600)</code></pre>
<div id="potential-load-curtailment" class="section level3">
<h3><span class="header-section-number">10.1.1</span> Potential load curtailment</h3>
<pre class="r"><code>sc5data &lt;- sc5data[, .(PotCur = sum(GWhREF)),
                   keyby = .(season, Period)]
sc5data</code></pre>
<pre><code>##     season       Period   PotCur
##  1: Spring Evening Peak 1080.208
##  2: Spring Morning Peak 1080.208
##  3: Spring   Off Peak 1 2040.394
##  4: Spring   Off Peak 2 1560.301
##  5: Summer Evening Peak 1080.208
##  6: Summer Morning Peak 1080.208
##  7: Summer   Off Peak 1 2040.394
##  8: Summer   Off Peak 2 1560.301
##  9: Autumn Evening Peak 1080.208
## 10: Autumn Morning Peak 1080.208
## 11: Autumn   Off Peak 1 2040.394
## 12: Autumn   Off Peak 2 1560.301
## 13: Winter Evening Peak 1080.208
## 14: Winter Morning Peak 1080.208
## 15: Winter   Off Peak 1 2040.394
## 16: Winter   Off Peak 2 1560.301</code></pre>
</div>
<div id="visualising-curtailed-periods-2" class="section level3">
<h3><span class="header-section-number">10.1.2</span> Visualising curtailed periods</h3>
<pre class="r"><code>#Defining peak and off-peak for heat pump and hot water seperately


sc5data &lt;- refrigerationProfileDT

sc5data &lt;- sc5data[, .(GWhREF = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

sc5data &lt;- sc5data[, Period := &quot;Not Peak&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]




sc5data &lt;- sc5data[, GWhREF:= ifelse(Period == &quot;Evening Peak&quot;|Period== &quot;Morning Peak&quot;
                                     , 0, GWhREF )] # If Period is Evening peak then make GWh zero
                   





#Renaming PumpandWater to depict the right y in the colorbar
setnames(sc5data, old=c(&quot;GWhREF&quot;), new=c(&quot;MWh&quot;))

myPlot &lt;- ggplot2::ggplot(sc5data, aes(x = obsHalfHour, y = MWh, color=MWh)) +
  geom_line(size=1) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Total refrigeration load curtailment in peak time-periods by season&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
  scale_y_continuous(breaks = c(3, 6, 9, 12)) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),       hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;), 
  hms::as.hms(&quot;20:00:00&quot;))) +
  scale_colour_gradient(low= &quot;green&quot;, high=&quot;red&quot;, guide = &quot;colorbar&quot;)

myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/Visualising%20rf%20curtailed%20periods-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Per_DayTotal refrigeration curtailment in peak time-periods by season.jpeg&quot;, dpi = 600)</code></pre>
</div>
</div>
<div id="load-curtailment-of-particular-amount" class="section level2">
<h2><span class="header-section-number">10.2</span> Load curtailment of particular amount</h2>
<pre class="r"><code>#Defining peak and off-peak for heat pump and hot water seperately

sc5data &lt;- refrigerationProfileDT

sc5data &lt;- sc5data[, .(GWhREF = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

sc5data &lt;- sc5data[, Period := &quot;Not Peak&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]





sc5data &lt;- sc5data[, GWhREF:= ifelse(Period == &quot;Evening Peak&quot;, GWhREF*0.5, GWhREF )] # If Period is Evening peak then make GWh zero
                   
sc5data &lt;- sc5data[, GWhREF:= ifelse(Period == &quot;Morning Peak&quot;, GWhREF*0.5, GWhREF )]

#Renaming PumpandWater to depict the right y in the colorbar
setnames(sc5data, old=c(&quot;GWhREF&quot;), new=c(&quot;GWh&quot;))


sc5data$season &lt;- factor(sc5data$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))

myPlot &lt;- ggplot2::ggplot(sc5data, aes(x = obsHalfHour, y = GWh, color=GWh)) +
  geom_line(size=1) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Total refrigeration 50 per cent load curtailment&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
  #scale_y_continuous(breaks = c(2, 4, 6, 8)) +
 scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),       hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;), 
  hms::as.hms(&quot;20:00:00&quot;)))  +
  scale_colour_gradient(low= &quot;green&quot;, high=&quot;red&quot;, guide = &quot;colorbar&quot;)

myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/load%20curtialmentall%20three%20appliances%20of%20particular%20amount1-1.png" /><!-- --></p>
<pre class="r"><code>ggsave(&quot;Total refrigeration 50 per cent load curtailment.jpeg&quot;, dpi = 600)</code></pre>
<pre><code>## Saving 7 x 5 in image</code></pre>
<div id="potential-load-curtailment-heat-pump-and-hot-water-based-on-percentage" class="section level3">
<h3><span class="header-section-number">10.2.1</span> Potential load curtailment heat pump and hot water based on percentage</h3>
<pre class="r"><code>sc5data &lt;- sc5data[, .(PotCur = sum(GWh)),
                   keyby = .(season, Period)]
sc5data</code></pre>
<pre><code>##     season       Period    PotCur
##  1: Spring Evening Peak  48.60938
##  2: Spring Morning Peak  48.60938
##  3: Spring   Off Peak 1 183.63542
##  4: Spring   Off Peak 2 140.42708
##  5: Summer Evening Peak  48.60938
##  6: Summer Morning Peak  48.60938
##  7: Summer   Off Peak 1 183.63542
##  8: Summer   Off Peak 2 140.42708
##  9: Autumn Evening Peak  48.60938
## 10: Autumn Morning Peak  48.60938
## 11: Autumn   Off Peak 1 183.63542
## 12: Autumn   Off Peak 2 140.42708
## 13: Winter Evening Peak  48.60938
## 14: Winter Morning Peak  48.60938
## 15: Winter   Off Peak 1 183.63542
## 16: Winter   Off Peak 2 140.42708</code></pre>
</div>
</div>
<div id="load-shifting-to-prior-times-sc3-1" class="section level2">
<h2><span class="header-section-number">10.3</span> Load shifting to prior times: SC3</h2>
<pre class="r"><code>sc5data &lt;- refrigerationProfileDT

sc5data &lt;- sc5data[, .(GWhREF = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

sc5data &lt;- sc5data[, Period := &quot;Not Peak&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]





sc3data &lt;- sc5data






#Building the sum of each peak period by season
AuMP3 &lt;- sc3data[season == &quot;Autumn&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhREF)]
WiMP3 &lt;- sc3data[season == &quot;Winter&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhREF)]
SpMP3 &lt;- sc3data[season == &quot;Spring&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhREF)]
SuMP3 &lt;- sc3data[season == &quot;Summer&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhREF)]

AuEP3 &lt;- sc3data[season == &quot;Autumn&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhREF)]
WiEP3 &lt;- sc3data[season == &quot;Winter&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhREF)]
SpEP3 &lt;- sc3data[season == &quot;Spring&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhREF)]
SuEP3 &lt;- sc3data[season == &quot;Summer&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhREF)]


#Counting number of rows that will be associated to spread the Morning Peak
AuMPHalfHours3 &lt;- nrow(sc3data[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
WiMPHalfHours3 &lt;- nrow(sc3data[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
SpMPHalfHours3 &lt;- nrow(sc3data[season == &quot;Spring&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
SuMPHalfHours3 &lt;- nrow(sc3data[season == &quot;Summer&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])

#Counting number of rows that will be associated to spread the Evening Peak
AuEPHalfHours3 &lt;- nrow(sc3data[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
WiEPHalfHours3 &lt;- nrow(sc3data[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
SpEPHalfHours3 &lt;- nrow(sc3data[season == &quot;Spring&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
SuEPHalfHours3 &lt;- nrow(sc3data[season == &quot;Summer&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])

#Calculating the proportion that each row will take on to spread the GWhs
distGWhOP1Au3 &lt;- AuMP3/AuMPHalfHours3
distGWhOP1Wi3 &lt;- WiMP3/WiMPHalfHours3
distGWhOP1Sp3 &lt;- SpMP3/SpMPHalfHours3
distGWhOP1Su3 &lt;- SuMP3/SuMPHalfHours3

distGWhOP2Au3 &lt;- AuEP3/AuEPHalfHours3
distGWhOP2Wi3 &lt;- WiEP3/WiEPHalfHours3
distGWhOP2Sp3 &lt;- SpEP3/SpEPHalfHours3
distGWhOP2Su3 &lt;- SuEP3/SuEPHalfHours3



#Adding amount of spreaded peak consumption to off-peak periods
sc3data &lt;- sc3data[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs4 :=
                     GWhREF + distGWhOP1Au3]
sc3data &lt;- sc3data[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs4 :=
                     GWhREF + distGWhOP1Wi3]
sc3data &lt;- sc3data[season == &quot;Spring&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs4 :=
                     GWhREF + distGWhOP1Sp3]
sc3data &lt;- sc3data[season == &quot;Summer&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs4 :=
                     GWhREF + distGWhOP1Su3]


sc3data &lt;- sc3data[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs4 :=
                     GWhREF + distGWhOP2Au3]
sc3data &lt;- sc3data[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs4 :=
                     GWhREF + distGWhOP2Wi3]
sc3data &lt;- sc3data[season == &quot;Spring&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs4 :=
                     GWhREF + distGWhOP2Sp3]
sc3data &lt;- sc3data[season == &quot;Summer&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs4 :=
                     GWhREF + distGWhOP2Su3]


#Setting missing values in peak periods to NULL
sc3data &lt;- sc3data[, GWhs4:= ifelse(Period ==&quot;Morning Peak&quot;,
                                  0, GWhs4)]
sc3data &lt;- sc3data[, GWhs4:= ifelse(Period ==&quot;Evening Peak&quot;,
                                  0, GWhs4)]


#Renaming GWhs3 into GWh to depict the right text in the colorbar
#setnames(sc2data, old=c(&quot;GWhs4&quot;), new=c(&quot;GWh&quot;))

#Visualising only shifted consumption
#myPlot &lt;- ggplot2::ggplot(sc2data, aes(x = obsHalfHour, color=GWh)) +
  #geom_line(aes(y=GWh), size=0.5) +
  #theme(text = element_text(family = &quot;Cambria&quot;)) +
  #ggtitle(&quot;Total shifted New Zealand half hour heat pump energy consumption by season for 2015&quot;) +
  #facet_grid(season ~ .) +
  #labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
  #scale_y_continuous(breaks = c(10, 20, 30, 40)) +
  #scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;03:00:00&quot;), hms::as.hms(&quot;06:00:00&quot;),       hms::as.hms(&quot;09:00:00&quot;), hms::as.hms(&quot;12:00:00&quot;), 
  #hms::as.hms(&quot;15:00:00&quot;), hms::as.hms(&quot;18:00:00&quot;), hms::as.hms(&quot;21:00:00&quot;))) +
  #scale_colour_gradient(low= &quot;green&quot;, high=&quot;red&quot;, guide = &quot;colorbar&quot;)

#myPlot

#Visualising shifted and original consumption
#myPlot &lt;- ggplot2::ggplot(sc2data, aes(x = obsHalfHour)) +
 # geom_line(aes(y=GWh, color=GWh), size=0.5) +
 # geom_line(aes(y=GWhs4, color=GWhs4), size=0.5) +
 # theme(text = element_text(family = &quot;Cambria&quot;)) +
 # ggtitle(&quot;Original and shifted New Zealand half hour heat pump energy consumption by season for 2015&quot;) +
#  facet_grid(season ~ .) +
#  labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
 # scale_y_continuous(breaks = c(10, 20, 30, 40)) +
#  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;03:00:00&quot;), hms::as.hms(&quot;06:00:00&quot;),       hms::as.hms(&quot;09:00:00&quot;), hms::as.hms(&quot;12:00:00&quot;), 
#  hms::as.hms(&quot;15:00:00&quot;), hms::as.hms(&quot;18:00:00&quot;), hms::as.hms(&quot;21:00:00&quot;))) +
 # scale_color_gradient(low= &quot;green&quot;, high=&quot;red&quot;)

#myPlot

#Change the order in facet_grid()
sc3data$season &lt;- factor(sc3data$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))


#Visualising only winter 
  #myPlot &lt;- ggplot2::ggplot(subset(sc5data, season %in% c(&quot;Winter&quot;)), aes(x = #obsHalfHour)) +
 # geom_line(aes(y=GWhREF, color=&quot;red&quot;), size=0.5) +
  #geom_line(aes(y=GWhs4, color=&quot;blue&quot;), size=0.5) +
 # theme(text = element_text(family = &quot;Cambria&quot;)) +
  #ggtitle(&quot;Per day original and shifted New Zealand refrigeration energy #consumption by season for 2015&quot;) +
  #scale_colour_manual(name = element_blank(), 
         #values =c(&#39;red&#39;=&#39;red&#39;,&#39;blue&#39;=&#39;blue&#39;), labels = c(&#39;Original consumption&#39;,
                  #&#39;Shifted consumption&#39;)) +
  #facet_grid(season ~ .) +
 # labs(x=&#39;Time of Day&#39;, y=&#39;MWh&#39;) +
  #scale_y_continuous(breaks = c(10, 20, 30, 40)) +
  #scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), #hms::as.hms(&quot;08:00:00&quot;),       hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;), 
  #hms::as.hms(&quot;20:00:00&quot;))) 
 

#myPlot



# Orifginal plot, the one above depicts winter
#Visualising shifted and original consumption two colours
  myPlot &lt;- ggplot2::ggplot(sc5data, aes(x = obsHalfHour)) +
  geom_line(aes(y=GWhREF, color=&quot;red&quot;), size=0.5) +
  geom_line(aes(y=GWhs4, color=&quot;blue&quot;), size=0.5) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Per day original and shifted New Zealand refrigeration energy consumption by season for 2015&quot;) +
  scale_colour_manual(name = element_blank(), 
         values =c(&#39;red&#39;=&#39;red&#39;,&#39;blue&#39;=&#39;blue&#39;), labels = c(&#39;Original consumption&#39;,
                 &#39;Shifted consumption&#39;)) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
scale_y_continuous(breaks = c(10, 20, 30, 40)) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),       hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;), 
  hms::as.hms(&quot;20:00:00&quot;))) 
 

myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/rf%20shifting-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Total shifted and original refrigeration in GWh.jpeg&quot;, dpi = 600)</code></pre>
</div>
</div>
<div id="both-appliances-together" class="section level1">
<h1><span class="header-section-number">11</span> Both appliances together</h1>
<div id="load-curtailment-to-zero-sc1-2" class="section level2">
<h2><span class="header-section-number">11.1</span> Load curtailment to zero: SC1</h2>
<div id="visualising-peak-time-periods" class="section level3">
<h3><span class="header-section-number">11.1.1</span> Visualising peak time-periods</h3>
<pre class="r"><code>#Defining peak and off-peak for heat pump and hot water seperately
sc3data &lt;- heatPumpProfileDT


sc3data &lt;- sc3data[, .(GWhHP = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

sc3data &lt;- sc3data[, Period := &quot;Not Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]


sc32data &lt;- hotWaterProfileDT

sc32data &lt;- sc32data[, .(GWhHW = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

sc32data &lt;- sc32data[, Period := &quot;Not Peak&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

#Copying hot water consumption column into heat pump data table
sc3data &lt;- cbind(sc3data, sc32data[,&quot;GWhHW&quot;])

#Building sum of heat pump and hot water consumption
sc3data &lt;- sc3data[, PumpandWater := GWhHP + GWhHW]

sc3data$season &lt;- factor(sc3data$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))

#Visualising peak ond off-peak
myPlot &lt;- ggplot2::ggplot(sc3data, aes(x = obsHalfHour, color=Period)) +
  geom_point(aes(y=PumpandWater), size=1, alpha = 1) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Total consumption heat pump and hot water by season&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
  scale_y_continuous(breaks = c(20, 40, 60, 80)) +
  scale_color_discrete(breaks=c(&quot;Off Peak 1&quot;, &quot;Morning Peak&quot;, &quot;Off Peak 2&quot;,
                                &quot;Evening Peak&quot;)) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),       hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;), 
  hms::as.hms(&quot;20:00:00&quot;))) 
  #scale_colour_gradient(low= &quot;green&quot;, high=&quot;red&quot;, guide = &quot;colorbar&quot;)

myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/heat%20pump%20and%20hot%20water%20together-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Total consumption heat pump and hot water by season.jpeg&quot;, dpi = 600)</code></pre>
</div>
<div id="potential-load-curtailment-1" class="section level3">
<h3><span class="header-section-number">11.1.2</span> Potential load curtailment</h3>
<pre class="r"><code>sc3data &lt;- sc3data[, .(PotCur = sum(PumpandWater)),
                   keyby = .(season, Period)]
sc3data</code></pre>
<pre><code>##     season       Period   PotCur
##  1: Spring Evening Peak 264.0581
##  2: Spring Morning Peak 297.5807
##  3: Spring   Off Peak 1 199.9309
##  4: Spring   Off Peak 2 234.1039
##  5: Summer Evening Peak 179.6544
##  6: Summer Morning Peak 174.2595
##  7: Summer   Off Peak 1 160.0590
##  8: Summer   Off Peak 2 178.7930
##  9: Autumn Evening Peak 241.7618
## 10: Autumn Morning Peak 274.0505
## 11: Autumn   Off Peak 1 183.6066
## 12: Autumn   Off Peak 2 233.1524
## 13: Winter Evening Peak 345.8801
## 14: Winter Morning Peak 363.5610
## 15: Winter   Off Peak 1 248.0292
## 16: Winter   Off Peak 2 310.3283</code></pre>
<pre class="r"><code>#sc3data &lt;- sc1data
#sc3data[, c(&quot;GWhs1&quot;):=NULL] #Deleting unnecessary columns

#Copying the scaled GWh of hot water into the new data table
#sc3data &lt;- cbind(sc3data, sc2data[,&quot;GWhs4&quot;])

#Building the sum of heat pump and hot water scaled numbers in a sepatrate variable
#sc3data &lt;- sc3data[, PumpandWater := GWh + GWhs4]</code></pre>
</div>
<div id="visualising-curtailed-periods-3" class="section level3">
<h3><span class="header-section-number">11.1.3</span> Visualising curtailed periods</h3>
<pre class="r"><code>#Defining peak and off-peak for heat pump and hot water seperately
sc3data &lt;- heatPumpProfileDT


sc3data &lt;- sc3data[, .(GWhHP = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

sc3data &lt;- sc3data[, Period := &quot;Not Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]


sc32data &lt;- hotWaterProfileDT

sc32data &lt;- sc32data[, .(GWhHW = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

sc32data &lt;- sc32data[, Period := &quot;Not Peak&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

#Copying hot water consumption column into heat pump data table
sc3data &lt;- cbind(sc3data, sc32data[,&quot;GWhHW&quot;])

#Building sum of heat pump and hot water consumption
sc3data &lt;- sc3data[, PumpandWater := GWhHP + GWhHW]


sc3data &lt;- sc3data[, PumpandWater:= ifelse(Period == &quot;Evening Peak&quot;, 0, PumpandWater )] # If Period is Evening peak then make GWh zero
                   
sc3data &lt;- sc3data[, PumpandWater:= ifelse(Period == &quot;Morning Peak&quot;, 0, PumpandWater )]



sc3data$season &lt;- factor(sc3data$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))



myPlot &lt;- ggplot2::ggplot(sc3data, aes(x = obsHalfHour, y = PumpandWater, color=PumpandWater)) +
  geom_line(size=1) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Total heat pump and hot water load curtailment in peak time-periods by season&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
  scale_y_continuous(breaks = c(20, 40, 60, 80)) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),       hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;), 
  hms::as.hms(&quot;20:00:00&quot;))) +
  scale_colour_gradient(low= &quot;green&quot;, high=&quot;red&quot;, guide = &quot;colorbar&quot;)

myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/Visualising%20hp%20and%20hw%20curtailed%20periods-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Total heat pump and hot water load curtailment in peak time-periods by season.jpeg&quot;, dpi = 600)</code></pre>
</div>
</div>
<div id="load-curtailment-of-particular-amount-50-sc2-1" class="section level2">
<h2><span class="header-section-number">11.2</span> Load curtailment of particular amount 50%: SC2</h2>
<div id="visualising-new-load-profile-1" class="section level3">
<h3><span class="header-section-number">11.2.1</span> Visualising new load profile</h3>
<pre class="r"><code>sc3data &lt;- heatPumpProfileDT


sc3data &lt;- sc3data[, .(GWhHP = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

sc3data &lt;- sc3data[, Period := &quot;Not Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]


sc32data &lt;- hotWaterProfileDT

sc32data &lt;- sc32data[, .(GWhHW = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

sc32data &lt;- sc32data[, Period := &quot;Not Peak&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

#Copying hot water consumption column into heat pump data table
sc3data &lt;- cbind(sc3data, sc32data[,&quot;GWhHW&quot;])

#Building sum of heat pump and hot water consumption
sc3data &lt;- sc3data[, PumpandWater := GWhHP + GWhHW]


sc3data &lt;- sc3data[, PumpandWater:= ifelse(Period == &quot;Evening Peak&quot;, PumpandWater*0.5, PumpandWater )] # If Period is Evening peak then make GWh zero
                   
sc3data &lt;- sc3data[, PumpandWater:= ifelse(Period == &quot;Morning Peak&quot;, PumpandWater*0.5, PumpandWater )]

#Renaming PumpandWater to depict the right y in the colorbar
setnames(sc3data, old=c(&quot;PumpandWater&quot;), new=c(&quot;GWh&quot;))

sc3data$season &lt;- factor(sc3data$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))


myPlot &lt;- ggplot2::ggplot(sc3data, aes(x = obsHalfHour, y = GWh, color=GWh)) +
  geom_line(size=1) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Total per day heat pump and hot water 50 per cent load curtailment&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
  scale_y_continuous(breaks = c(20, 40, 60, 80)) +
 scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),       hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;), 
  hms::as.hms(&quot;20:00:00&quot;)))  +
  scale_colour_gradient(low= &quot;green&quot;, high=&quot;red&quot;, guide = &quot;colorbar&quot;)

myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/particular%20amount%20of%20hp%20and%20hw-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Total heat pump and hot water 50 per cent load curtailment.jpeg&quot;, dpi = 600)</code></pre>
</div>
<div id="potential-load-curtailment-heat-pump-and-hot-water-based-on-percentage-1" class="section level3">
<h3><span class="header-section-number">11.2.2</span> Potential load curtailment heat pump and hot water based on percentage</h3>
<pre class="r"><code>sc3data &lt;- sc3data[, .(PotCur = sum(GWh)),
                   keyby = .(season, Period)]
sc3data</code></pre>
<pre><code>##     season       Period    PotCur
##  1: Spring Evening Peak 132.02903
##  2: Spring Morning Peak 148.79037
##  3: Spring     Not Peak 434.03483
##  4: Summer Evening Peak  89.82719
##  5: Summer Morning Peak  87.12973
##  6: Summer     Not Peak 338.85205
##  7: Autumn Evening Peak 120.88092
##  8: Autumn Morning Peak 137.02524
##  9: Autumn     Not Peak 416.75902
## 10: Winter Evening Peak 172.94005
## 11: Winter Morning Peak 181.78049
## 12: Winter     Not Peak 558.35746</code></pre>
</div>
</div>
<div id="load-shifting-to-prior-times-sc3-2" class="section level2">
<h2><span class="header-section-number">11.3</span> Load shifting to prior times: SC3</h2>
<pre class="r"><code>sc3data &lt;- heatPumpProfileDT
sc3data[, c(&quot;medianW&quot;, &quot;obsHourMin&quot;, &quot;meanW&quot;, &quot;nObs&quot;, &quot;sdW&quot;,
            &quot;scaledMWmethod1&quot;, &quot;EECApmMethod2&quot;):=NULL] #Deleting unnecessary columns</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;medianW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;obsHourMin&#39; then assigning NULL (deleting
## it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;meanW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;nObs&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;sdW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;scaledMWmethod1&#39; then assigning NULL
## (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;EECApmMethod2&#39; then assigning NULL (deleting
## it).</code></pre>
<pre class="r"><code>  sc3data &lt;- sc3data[, .(GWhHP = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]


#Defining peak and off-peak periods
sc3data &lt;- sc3data[, Period := &quot;Not Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]








sc4data &lt;- hotWaterProfileDT

sc4data &lt;- sc4data[, .(GWhHW = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

sc4data &lt;- sc4data[, Period := &quot;Not Peak&quot;]

sc4data &lt;- sc4data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc4data &lt;- sc4data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc4data &lt;- sc4data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc4data &lt;- sc4data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc4data &lt;- sc4data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]


sc3data &lt;- cbind(sc3data, sc4data[,&quot;GWhHW&quot;])


sc3data &lt;- sc3data[, PumpandWater := GWhHP + GWhHW]






#Building the sum of each peak period by season
AuMP3 &lt;- sc3data[season == &quot;Autumn&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(PumpandWater)]
WiMP3 &lt;- sc3data[season == &quot;Winter&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(PumpandWater)]
SpMP3 &lt;- sc3data[season == &quot;Spring&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(PumpandWater)]
SuMP3 &lt;- sc3data[season == &quot;Summer&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(PumpandWater)]

AuEP3 &lt;- sc3data[season == &quot;Autumn&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(PumpandWater)]
WiEP3 &lt;- sc3data[season == &quot;Winter&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(PumpandWater)]
SpEP3 &lt;- sc3data[season == &quot;Spring&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(PumpandWater)]
SuEP3 &lt;- sc3data[season == &quot;Summer&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(PumpandWater)]


#Counting number of rows that will be associated to spread the Morning Peak
AuMPHalfHours3 &lt;- nrow(sc3data[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
WiMPHalfHours3 &lt;- nrow(sc3data[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
SpMPHalfHours3 &lt;- nrow(sc3data[season == &quot;Spring&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
SuMPHalfHours3 &lt;- nrow(sc3data[season == &quot;Summer&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])

#Counting number of rows that will be associated to spread the Evening Peak
AuEPHalfHours3 &lt;- nrow(sc3data[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
WiEPHalfHours3 &lt;- nrow(sc3data[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
SpEPHalfHours3 &lt;- nrow(sc3data[season == &quot;Spring&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
SuEPHalfHours3 &lt;- nrow(sc3data[season == &quot;Summer&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])

#Calculating the proportion that each row will take on to spread the GWhs
distGWhOP1Au3 &lt;- AuMP3/AuMPHalfHours3
distGWhOP1Wi3 &lt;- WiMP3/WiMPHalfHours3
distGWhOP1Sp3 &lt;- SpMP3/SpMPHalfHours3
distGWhOP1Su3 &lt;- SuMP3/SuMPHalfHours3

distGWhOP2Au3 &lt;- AuEP3/AuEPHalfHours3
distGWhOP2Wi3 &lt;- WiEP3/WiEPHalfHours3
distGWhOP2Sp3 &lt;- SpEP3/SpEPHalfHours3
distGWhOP2Su3 &lt;- SuEP3/SuEPHalfHours3



#Adding amount of spreaded peak consumption to off-peak periods
sc3data &lt;- sc3data[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs4 :=
                     PumpandWater + distGWhOP1Au3]
sc3data &lt;- sc3data[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs4 :=
                     PumpandWater + distGWhOP1Wi3]
sc3data &lt;- sc3data[season == &quot;Spring&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs4 :=
                     PumpandWater + distGWhOP1Sp3]
sc3data &lt;- sc3data[season == &quot;Summer&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs4 :=
                     PumpandWater + distGWhOP1Su3]


sc3data &lt;- sc3data[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs4 :=
                     PumpandWater + distGWhOP2Au3]
sc3data &lt;- sc3data[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs4 :=
                     PumpandWater + distGWhOP2Wi3]
sc3data &lt;- sc3data[season == &quot;Spring&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs4 :=
                     PumpandWater + distGWhOP2Sp3]
sc3data &lt;- sc3data[season == &quot;Summer&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs4 :=
                     PumpandWater + distGWhOP2Su3]


#Setting missing values in peak periods to NULL
sc3data &lt;- sc3data[, GWhs4:= ifelse(Period ==&quot;Morning Peak&quot;,
                                  0, GWhs4)]
sc3data &lt;- sc3data[, GWhs4:= ifelse(Period ==&quot;Evening Peak&quot;,
                                  0, GWhs4)]


#Renaming GWhs3 into GWh to depict the right text in the colorbar
#setnames(sc2data, old=c(&quot;GWhs4&quot;), new=c(&quot;GWh&quot;))

#Visualising only shifted consumption
#myPlot &lt;- ggplot2::ggplot(sc2data, aes(x = obsHalfHour, color=GWh)) +
  #geom_line(aes(y=GWh), size=0.5) +
  #theme(text = element_text(family = &quot;Cambria&quot;)) +
  #ggtitle(&quot;Total shifted New Zealand half hour heat pump energy consumption by season for 2015&quot;) +
  #facet_grid(season ~ .) +
  #labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
  #scale_y_continuous(breaks = c(10, 20, 30, 40)) +
  #scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;03:00:00&quot;), hms::as.hms(&quot;06:00:00&quot;),       hms::as.hms(&quot;09:00:00&quot;), hms::as.hms(&quot;12:00:00&quot;), 
  #hms::as.hms(&quot;15:00:00&quot;), hms::as.hms(&quot;18:00:00&quot;), hms::as.hms(&quot;21:00:00&quot;))) +
  #scale_colour_gradient(low= &quot;green&quot;, high=&quot;red&quot;, guide = &quot;colorbar&quot;)

#myPlot

#Visualising shifted and original consumption
#myPlot &lt;- ggplot2::ggplot(sc2data, aes(x = obsHalfHour)) +
 # geom_line(aes(y=GWh, color=GWh), size=0.5) +
 # geom_line(aes(y=GWhs4, color=GWhs4), size=0.5) +
 # theme(text = element_text(family = &quot;Cambria&quot;)) +
 # ggtitle(&quot;Original and shifted New Zealand half hour heat pump energy consumption by season for 2015&quot;) +
#  facet_grid(season ~ .) +
#  labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
 # scale_y_continuous(breaks = c(10, 20, 30, 40)) +
#  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;03:00:00&quot;), hms::as.hms(&quot;06:00:00&quot;),       hms::as.hms(&quot;09:00:00&quot;), hms::as.hms(&quot;12:00:00&quot;), 
#  hms::as.hms(&quot;15:00:00&quot;), hms::as.hms(&quot;18:00:00&quot;), hms::as.hms(&quot;21:00:00&quot;))) +
 # scale_color_gradient(low= &quot;green&quot;, high=&quot;red&quot;)

#myPlot

#Change the order in facet_grid()
sc3data$season &lt;- factor(sc3data$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))



#Visualising shifted and original consumption two colours
  myPlot &lt;- ggplot2::ggplot(sc3data, aes(x = obsHalfHour)) +
  geom_line(aes(y=GWhs4, color=&quot;red&quot;), size=0.5) +
  geom_line(aes(y=PumpandWater, color=&quot;blue&quot;), size=0.5) +
  geom_line(aes(y=GWhHP, color=&quot;green&quot;), size=0.5) + 
  geom_line(aes(y=GWhHW, color=&quot;black&quot;), size=0.5) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Heat pump and hot water appliances together in GWh&quot;) +
  scale_colour_manual(name = element_blank(), 
        values = c(&#39;red&#39;=&#39;red&#39;,&#39;blue&#39;=&#39;blue&#39;, &#39;green&#39;=&#39;green&#39;, &#39;black&#39;=&#39;black&#39;), labels = c(&#39;Orig. HW&#39;, &#39;Orig. HP &amp; HW&#39;, &#39;Orig. HP&#39;, &#39;Shif. HP &amp; HW&#39;)) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
  #scale_y_continuous(breaks = c(20, 40, 60, 80)) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),       hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;), 
  hms::as.hms(&quot;20:00:00&quot;))) 



myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/hp%20and%20hw%20load%20shifting1-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Heat pump and hot water appliances together in GWh.jpeg&quot;, dpi = 600)</code></pre>
</div>
</div>
<div id="all-three-appliances-together" class="section level1">
<h1><span class="header-section-number">12</span> All three appliances together</h1>
<div id="generating-refrigeration-profile" class="section level2">
<h2><span class="header-section-number">12.1</span> Generating refrigeration profile</h2>
<pre class="r"><code>totalGWH&lt;-2074 #EECA fro refrigeration in 2015
nzHouseholds &lt;- 1004329 + 453135

refrigerationProfileDT &lt;- copy(heatPumpProfileDT)
refrigerationProfileDT &lt;- refrigerationProfileDT[, scaledGWh := 2074/.N]#Spreading GWh equally

#myPlot &lt;- ggplot2::ggplot(refrigerationProfileDT, aes(x = obsHalfHour, colour = season)) +
 # geom_point(aes(y = scaledGWh)) +
 # facet_grid(season ~ .) +
 #labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;)

#myPlot</code></pre>
</div>
<div id="load-curtailment-to-zero-1" class="section level2">
<h2><span class="header-section-number">12.2</span> Load curtailment to zero</h2>
<pre class="r"><code>#Defining peak and off-peak for heat pump and hot water seperately
sc3data &lt;- heatPumpProfileDT


sc3data &lt;- sc3data[, .(GWhHP = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

sc3data &lt;- sc3data[, Period := &quot;Not Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]


sc32data &lt;- hotWaterProfileDT

sc32data &lt;- sc32data[, .(GWhHW = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

sc32data &lt;- sc32data[, Period := &quot;Not Peak&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]



sc5data &lt;- refrigerationProfileDT

sc5data &lt;- sc5data[, .(GWhREF = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

sc5data &lt;- sc5data[, Period := &quot;Not Peak&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

#Copying hot water consumption column into heat pump data table
sc3data &lt;- cbind(sc3data, sc32data[,&quot;GWhHW&quot;], sc5data[,&quot;GWhREF&quot;])

#Building sum of heat pump and hot water consumption
sc3data &lt;- sc3data[, PumpandWater := GWhHP + GWhHW + GWhREF]

sc3data$season &lt;- factor(sc3data$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))

#Visualising peak ond off-peak
myPlot &lt;- ggplot2::ggplot(sc3data, aes(x = obsHalfHour, color=Period)) +
  geom_point(aes(y=PumpandWater), size=1, alpha = 1) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Total consumption heat pump, hot water, refrigeration by season&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
 #scale_y_continuous(breaks = c(20, 40, 60, 80)) +
  scale_color_discrete(breaks=c(&quot;Off Peak 1&quot;, &quot;Morning Peak&quot;, &quot;Off Peak 2&quot;,
                                &quot;Evening Peak&quot;)) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),       hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;), 
  hms::as.hms(&quot;20:00:00&quot;))) 
  #scale_colour_gradient(low= &quot;green&quot;, high=&quot;red&quot;, guide = &quot;colorbar&quot;)

myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/load%20curtialment%20to%20zero%20all%20three%20appliances-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Total consumption heat pump, hot water, refrigeration by season.jpeg&quot;, dpi = 600)</code></pre>
<div id="potential-load-curtailment-2" class="section level3">
<h3><span class="header-section-number">12.2.1</span> Potential load curtailment</h3>
<pre class="r"><code>sc3data &lt;- sc3data[, .(PotCur = sum(PumpandWater)),
                   keyby = .(season, Period)]
sc3data</code></pre>
<pre><code>##     season       Period   PotCur
##  1: Spring Evening Peak 361.2768
##  2: Spring Morning Peak 394.7995
##  3: Spring   Off Peak 1 383.5663
##  4: Spring   Off Peak 2 374.5310
##  5: Summer Evening Peak 276.8731
##  6: Summer Morning Peak 271.4782
##  7: Summer   Off Peak 1 343.6945
##  8: Summer   Off Peak 2 319.2201
##  9: Autumn Evening Peak 338.9806
## 10: Autumn Morning Peak 371.2692
## 11: Autumn   Off Peak 1 367.2420
## 12: Autumn   Off Peak 2 373.5795
## 13: Winter Evening Peak 443.0988
## 14: Winter Morning Peak 460.7797
## 15: Winter   Off Peak 1 431.6646
## 16: Winter   Off Peak 2 450.7553</code></pre>
</div>
<div id="visualising-curtailed-periods-4" class="section level3">
<h3><span class="header-section-number">12.2.2</span> Visualising curtailed periods</h3>
<pre class="r"><code>#Defining peak and off-peak for heat pump and hot water seperately
sc3data &lt;- heatPumpProfileDT


sc3data &lt;- sc3data[, .(GWhHP = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

sc3data &lt;- sc3data[, Period := &quot;Not Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]


sc32data &lt;- hotWaterProfileDT

sc32data &lt;- sc32data[, .(GWhHW = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

sc32data &lt;- sc32data[, Period := &quot;Not Peak&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]





sc5data &lt;- refrigerationProfileDT

sc5data &lt;- sc5data[, .(GWhREF = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

sc5data &lt;- sc5data[, Period := &quot;Not Peak&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

#Copying hot water consumption column into heat pump data table
sc3data &lt;- cbind(sc3data, sc32data[,&quot;GWhHW&quot;], sc5data[,&quot;GWhREF&quot;])

#Building sum of heat pump and hot water consumption
sc3data &lt;- sc3data[, PumpandWater := GWhHP + GWhHW + GWhREF]


sc3data &lt;- sc3data[, PumpandWater:= ifelse(Period == &quot;Evening Peak&quot;, 0, PumpandWater )] # If Period is Evening peak then make GWh zero
                   
sc3data &lt;- sc3data[, PumpandWater:= ifelse(Period == &quot;Morning Peak&quot;, 0, PumpandWater )]



sc3data$season &lt;- factor(sc3data$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))

#Renaming PumpandWater to depict the right y in the colorbar
setnames(sc3data, old=c(&quot;PumpandWater&quot;), new=c(&quot;GWh&quot;))

myPlot &lt;- ggplot2::ggplot(sc3data, aes(x = obsHalfHour, y = GWh, color=GWh)) +
  geom_line(size=1) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Total heat pump hot water, refrigeration load curtailment in peak time-periods by season&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
 # scale_y_continuous(breaks = c(20, 40, 60, 80)) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),       hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;), 
  hms::as.hms(&quot;20:00:00&quot;))) +
  scale_colour_gradient(low= &quot;green&quot;, high=&quot;red&quot;, guide = &quot;colorbar&quot;)

myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/Visualising%20hp%20and%20hw,%20rf%20curtailed%20periods-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Total heat pump, hot water load, refrigeration curtailment in peak time-periods by season.jpeg&quot;, dpi = 600)</code></pre>
</div>
</div>
<div id="load-curtailment-of-particular-amount-1" class="section level2">
<h2><span class="header-section-number">12.3</span> Load curtailment of particular amount</h2>
<pre class="r"><code>#Defining peak and off-peak for heat pump and hot water seperately
sc3data &lt;- heatPumpProfileDT


sc3data &lt;- sc3data[, .(GWhHP = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

sc3data &lt;- sc3data[, Period := &quot;Not Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]


sc32data &lt;- hotWaterProfileDT

sc32data &lt;- sc32data[, .(GWhHW = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

sc32data &lt;- sc32data[, Period := &quot;Not Peak&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]



sc5data &lt;- refrigerationProfileDT

sc5data &lt;- sc5data[, .(GWhREF = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

sc5data &lt;- sc5data[, Period := &quot;Not Peak&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

#Copying hot water consumption column into heat pump data table
sc3data &lt;- cbind(sc3data, sc32data[,&quot;GWhHW&quot;], sc5data[,&quot;GWhREF&quot;])

#Building sum of heat pump and hot water consumption
sc3data &lt;- sc3data[, PumpandWater := GWhHP + GWhHW + GWhREF]

sc3data &lt;- sc3data[, PumpandWater:= ifelse(Period == &quot;Evening Peak&quot;, PumpandWater*0.5, PumpandWater )] # If Period is Evening peak then make GWh zero
                   
sc3data &lt;- sc3data[, PumpandWater:= ifelse(Period == &quot;Morning Peak&quot;, PumpandWater*0.5, PumpandWater )]

#Renaming PumpandWater to depict the right y in the colorbar
setnames(sc3data, old=c(&quot;PumpandWater&quot;), new=c(&quot;GWh&quot;))


sc3data$season &lt;- factor(sc3data$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))

myPlot &lt;- ggplot2::ggplot(sc3data, aes(x = obsHalfHour, y = GWh, color=GWh)) +
  geom_line(size=1) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Total heat pump, hot water, refrigeration 50 per cent load curtailment&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
 # scale_y_continuous(breaks = c(20, 40, 60, 80)) +
 scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),       hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;), 
  hms::as.hms(&quot;20:00:00&quot;)))  +
  scale_colour_gradient(low= &quot;green&quot;, high=&quot;red&quot;, guide = &quot;colorbar&quot;)

myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/load%20curtialmentall%20three%20appliances%20of%20particular%20amount-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Total heat pump, hot water, refrigeration 50 per cent load curtailment.jpeg&quot;, dpi = 600)</code></pre>
<div id="potential-load-curtailment-heat-pump-and-hot-water-based-on-percentage-2" class="section level3">
<h3><span class="header-section-number">12.3.1</span> Potential load curtailment heat pump and hot water based on percentage</h3>
<pre class="r"><code>sc3data &lt;- sc3data[, .(PotCur = sum(GWh)),
                   keyby = .(season, Period)]
sc3data</code></pre>
<pre><code>##     season       Period   PotCur
##  1: Spring Evening Peak 180.6384
##  2: Spring Morning Peak 197.3997
##  3: Spring   Off Peak 1 383.5663
##  4: Spring   Off Peak 2 374.5310
##  5: Summer Evening Peak 138.4366
##  6: Summer Morning Peak 135.7391
##  7: Summer   Off Peak 1 343.6945
##  8: Summer   Off Peak 2 319.2201
##  9: Autumn Evening Peak 169.4903
## 10: Autumn Morning Peak 185.6346
## 11: Autumn   Off Peak 1 367.2420
## 12: Autumn   Off Peak 2 373.5795
## 13: Winter Evening Peak 221.5494
## 14: Winter Morning Peak 230.3899
## 15: Winter   Off Peak 1 431.6646
## 16: Winter   Off Peak 2 450.7553</code></pre>
</div>
</div>
<div id="load-shifting-to-prior-times-sc3-3" class="section level2">
<h2><span class="header-section-number">12.4</span> Load shifting to prior times: SC3</h2>
<pre class="r"><code>sc3data &lt;- heatPumpProfileDT
sc3data[, c(&quot;medianW&quot;, &quot;obsHourMin&quot;, &quot;meanW&quot;, &quot;nObs&quot;, &quot;sdW&quot;,
            &quot;scaledMWmethod1&quot;, &quot;EECApmMethod2&quot;):=NULL] #Deleting unnecessary columns</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;medianW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;obsHourMin&#39; then assigning NULL (deleting
## it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;meanW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;nObs&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;sdW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;scaledMWmethod1&#39; then assigning NULL
## (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;EECApmMethod2&#39; then assigning NULL (deleting
## it).</code></pre>
<pre class="r"><code>  sc3data &lt;- sc3data[, .(GWhHP = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]


#Defining peak and off-peak periods
sc3data &lt;- sc3data[, Period := &quot;Not Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]








sc4data &lt;- hotWaterProfileDT

sc4data &lt;- sc4data[, .(GWhHW = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

sc4data &lt;- sc4data[, Period := &quot;Not Peak&quot;]

sc4data &lt;- sc4data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc4data &lt;- sc4data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc4data &lt;- sc4data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc4data &lt;- sc4data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc4data &lt;- sc4data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]



sc5data &lt;- refrigerationProfileDT

sc5data &lt;- sc5data[, .(GWhREF = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

sc5data &lt;- sc5data[, Period := &quot;Not Peak&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]


sc3data &lt;- cbind(sc3data, sc4data[,&quot;GWhHW&quot;], sc5data[,&quot;GWhREF&quot;])


sc3data &lt;- sc3data[, PumpandWater := GWhHP + GWhHW + GWhREF]






#Building the sum of each peak period by season
AuMP3 &lt;- sc3data[season == &quot;Autumn&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(PumpandWater)]
WiMP3 &lt;- sc3data[season == &quot;Winter&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(PumpandWater)]
SpMP3 &lt;- sc3data[season == &quot;Spring&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(PumpandWater)]
SuMP3 &lt;- sc3data[season == &quot;Summer&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(PumpandWater)]

AuEP3 &lt;- sc3data[season == &quot;Autumn&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(PumpandWater)]
WiEP3 &lt;- sc3data[season == &quot;Winter&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(PumpandWater)]
SpEP3 &lt;- sc3data[season == &quot;Spring&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(PumpandWater)]
SuEP3 &lt;- sc3data[season == &quot;Summer&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(PumpandWater)]


#Counting number of rows that will be associated to spread the Morning Peak
AuMPHalfHours3 &lt;- nrow(sc3data[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
WiMPHalfHours3 &lt;- nrow(sc3data[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
SpMPHalfHours3 &lt;- nrow(sc3data[season == &quot;Spring&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
SuMPHalfHours3 &lt;- nrow(sc3data[season == &quot;Summer&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])

#Counting number of rows that will be associated to spread the Evening Peak
AuEPHalfHours3 &lt;- nrow(sc3data[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
WiEPHalfHours3 &lt;- nrow(sc3data[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
SpEPHalfHours3 &lt;- nrow(sc3data[season == &quot;Spring&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
SuEPHalfHours3 &lt;- nrow(sc3data[season == &quot;Summer&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])

#Calculating the proportion that each row will take on to spread the GWhs
distGWhOP1Au3 &lt;- AuMP3/AuMPHalfHours3
distGWhOP1Wi3 &lt;- WiMP3/WiMPHalfHours3
distGWhOP1Sp3 &lt;- SpMP3/SpMPHalfHours3
distGWhOP1Su3 &lt;- SuMP3/SuMPHalfHours3

distGWhOP2Au3 &lt;- AuEP3/AuEPHalfHours3
distGWhOP2Wi3 &lt;- WiEP3/WiEPHalfHours3
distGWhOP2Sp3 &lt;- SpEP3/SpEPHalfHours3
distGWhOP2Su3 &lt;- SuEP3/SuEPHalfHours3



#Adding amount of spreaded peak consumption to off-peak periods
sc3data &lt;- sc3data[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs4 :=
                     PumpandWater + distGWhOP1Au3]
sc3data &lt;- sc3data[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs4 :=
                     PumpandWater + distGWhOP1Wi3]
sc3data &lt;- sc3data[season == &quot;Spring&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs4 :=
                     PumpandWater + distGWhOP1Sp3]
sc3data &lt;- sc3data[season == &quot;Summer&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs4 :=
                     PumpandWater + distGWhOP1Su3]


sc3data &lt;- sc3data[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs4 :=
                     PumpandWater + distGWhOP2Au3]
sc3data &lt;- sc3data[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs4 :=
                     PumpandWater + distGWhOP2Wi3]
sc3data &lt;- sc3data[season == &quot;Spring&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs4 :=
                     PumpandWater + distGWhOP2Sp3]
sc3data &lt;- sc3data[season == &quot;Summer&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs4 :=
                     PumpandWater + distGWhOP2Su3]


#Setting missing values in peak periods to NULL
sc3data &lt;- sc3data[, GWhs4:= ifelse(Period ==&quot;Morning Peak&quot;,
                                  0, GWhs4)]
sc3data &lt;- sc3data[, GWhs4:= ifelse(Period ==&quot;Evening Peak&quot;,
                                  0, GWhs4)]


#Renaming GWhs3 into GWh to depict the right text in the colorbar
#setnames(sc2data, old=c(&quot;GWhs4&quot;), new=c(&quot;GWh&quot;))

#Visualising only shifted consumption
#myPlot &lt;- ggplot2::ggplot(sc2data, aes(x = obsHalfHour, color=GWh)) +
  #geom_line(aes(y=GWh), size=0.5) +
  #theme(text = element_text(family = &quot;Cambria&quot;)) +
  #ggtitle(&quot;Total shifted New Zealand half hour heat pump energy consumption by season for 2015&quot;) +
  #facet_grid(season ~ .) +
  #labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
  #scale_y_continuous(breaks = c(10, 20, 30, 40)) +
  #scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;03:00:00&quot;), hms::as.hms(&quot;06:00:00&quot;),       hms::as.hms(&quot;09:00:00&quot;), hms::as.hms(&quot;12:00:00&quot;), 
  #hms::as.hms(&quot;15:00:00&quot;), hms::as.hms(&quot;18:00:00&quot;), hms::as.hms(&quot;21:00:00&quot;))) +
  #scale_colour_gradient(low= &quot;green&quot;, high=&quot;red&quot;, guide = &quot;colorbar&quot;)

#myPlot

#Visualising shifted and original consumption
#myPlot &lt;- ggplot2::ggplot(sc2data, aes(x = obsHalfHour)) +
 # geom_line(aes(y=GWh, color=GWh), size=0.5) +
 # geom_line(aes(y=GWhs4, color=GWhs4), size=0.5) +
 # theme(text = element_text(family = &quot;Cambria&quot;)) +
 # ggtitle(&quot;Original and shifted New Zealand half hour heat pump energy consumption by season for 2015&quot;) +
#  facet_grid(season ~ .) +
#  labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
 # scale_y_continuous(breaks = c(10, 20, 30, 40)) +
#  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;03:00:00&quot;), hms::as.hms(&quot;06:00:00&quot;),       hms::as.hms(&quot;09:00:00&quot;), hms::as.hms(&quot;12:00:00&quot;), 
#  hms::as.hms(&quot;15:00:00&quot;), hms::as.hms(&quot;18:00:00&quot;), hms::as.hms(&quot;21:00:00&quot;))) +
 # scale_color_gradient(low= &quot;green&quot;, high=&quot;red&quot;)

#myPlot

#Change the order in facet_grid()
sc3data$season &lt;- factor(sc3data$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))



#Visualising shifted and original consumption two colours
  myPlot &lt;- ggplot2::ggplot(sc3data, aes(x = obsHalfHour)) +
  geom_line(aes(y=GWhREF, color=&quot;orange&quot;), size=0.5) +  
  geom_line(aes(y=GWhs4, color=&quot;red&quot;), size=0.5) +
  geom_line(aes(y=PumpandWater, color=&quot;blue&quot;), size=0.5) +
  geom_line(aes(y=GWhHP, color=&quot;green&quot;), size=0.5) + 
  geom_line(aes(y=GWhHW, color=&quot;black&quot;), size=0.5) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Total heat pump, hot water, refrigeration appliances together in GWh&quot;) +
  scale_colour_manual(name = element_blank(), 
        values = c(&#39;orange&#39;=&#39;orange&#39;, &#39;red&#39;=&#39;red&#39;,&#39;blue&#39;=&#39;blue&#39;, &#39;green&#39;=&#39;green&#39;, &#39;black&#39;=&#39;black&#39;), labels = c(&#39;Orig. HW&#39;, &#39;Orig. HP|HW|REF&#39;, &#39;Orig. HP&#39;, &#39;Orig. REF&#39;, &#39;Shif. HP|HW|REF&#39;)) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
  #scale_y_continuous(breaks = c(20, 40, 60, 80)) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),       hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;), 
  hms::as.hms(&quot;20:00:00&quot;))) 



myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/hp%20and%20hw%20load%20shifting-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Total heat pump, hot water, refrigeration appliances together in GWh.jpeg&quot;, dpi = 600)</code></pre>
</div>
</div>
<div id="economic-analysis" class="section level1">
<h1><span class="header-section-number">13</span> Economic analysis</h1>
<div id="reading-original-data" class="section level2">
<h2><span class="header-section-number">13.1</span> Reading original data</h2>
<pre class="r"><code>WholesalePrices  &lt;- &quot;/Volumes/hum-csafe/Research Projects/GREEN Grid/externalData/EA_Wholesale_Prices/Wholesale_16-17_clean.csv&quot;


print(paste0(&quot;Trying to load: &quot;, WholesalePrices))</code></pre>
<pre><code>## [1] &quot;Trying to load: /Volumes/hum-csafe/Research Projects/GREEN Grid/externalData/EA_Wholesale_Prices/Wholesale_16-17_clean.csv&quot;</code></pre>
<pre class="r"><code>PricesDT &lt;- data.table::as.data.table(readr::read_csv(WholesalePrices)) # reading data</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   `Period start` = col_character(),
##   `Period end` = col_character(),
##   `Trading period` = col_integer(),
##   `Region ID` = col_character(),
##   Region = col_character(),
##   `Price ($/MWh)` = col_double()
## )</code></pre>
</div>
<div id="time-adjustments" class="section level2">
<h2><span class="header-section-number">13.2</span> Time adjustments</h2>
<pre class="r"><code>PricesDT &lt;- PricesDT[, dateTimeStartUTC := lubridate::dmy_hm(`Period start`)] # creating column based on orig. data
PricesDT &lt;- PricesDT[, dateTimeStart := lubridate::force_tz(dateTimeStartUTC, tz = &quot;Pacific/Auckland&quot;)] # changing time to NZST
PricesDT$dateTimeStartUTC &lt;- NULL
PricesDT &lt;- PricesDT[, dstFlag := lubridate::dst(dateTimeStart)]
#PricesDT[, .(n = .N), keyby = .(month = lubridate::month(dateTimeStart), dstFlag)]# Daylight saving test</code></pre>
</div>
<div id="defining-seasons" class="section level2">
<h2><span class="header-section-number">13.3</span> Defining seasons</h2>
<pre class="r"><code>PricesDT &lt;- PricesDT[, month := lubridate::month(dateTimeStart)]

PricesDT &lt;- PricesDT[month &gt;= 9 &amp; month &lt;= 11, season := &quot;Spring&quot;]
PricesDT &lt;- PricesDT[month == 12 | month == 1 | month == 2, season := &quot;Summer&quot;]
PricesDT &lt;- PricesDT[month == 3 | month == 4 | month == 5, season := &quot;Autumn&quot;]
PricesDT &lt;- PricesDT[month == 6 | month == 7 | month == 8, season := &quot;Winter&quot;]</code></pre>
</div>
<div id="mean-price-per-mwh" class="section level2">
<h2><span class="header-section-number">13.4</span> Mean Price per MWh</h2>
<pre class="r"><code>PricesDT &lt;- PricesDT[, obsHalfHour := hms::as.hms(dateTimeStart)] # creating time column without date


SeasonAvgDT &lt;- PricesDT[, .(meanprice = mean(`Price ($/MWh)`)), keyby = .(season, obsHalfHour, Region)]</code></pre>
<div id="visualisation" class="section level3">
<h3><span class="header-section-number">13.4.1</span> Visualisation</h3>
<pre class="r"><code>SeasonAvgDT$season &lt;- factor(SeasonAvgDT$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))

myPlot &lt;- ggplot2::ggplot(SeasonAvgDT, aes(x = obsHalfHour)) +
  geom_line(aes(y=meanprice, color= Region), size=0.5) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Wholesale electricity prices 01.09.2016-31.08.2017&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;NZD/MWh&#39;) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),
                          hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;),
                          hms::as.hms(&quot;20:00:00&quot;)))
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/test%20plot-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Mean wholesale prices $ per MWh by season.jpeg&quot;, dpi = 600)</code></pre>
</div>
</div>
<div id="calculations" class="section level2">
<h2><span class="header-section-number">13.5</span> Calculations</h2>
<div id="refrigeration-economic-value" class="section level3">
<h3><span class="header-section-number">13.5.1</span> Refrigeration economic value</h3>
<div id="baseline-value" class="section level4">
<h4><span class="header-section-number">13.5.1.1</span> Baseline value</h4>
<pre class="r"><code>fac1000 &lt;- 1000 # We need this conversion to display MWh as required by prices per MWh

sc0data &lt;- refrigerationProfileDT
sc0data[, c(&quot;medianW&quot;, &quot;obsHourMin&quot;, &quot;meanW&quot;, &quot;nObs&quot;, &quot;sdW&quot;,
            &quot;scaledMWmethod1&quot;, &quot;EECApmMethod2&quot;):=NULL] #Deleting unnecessary columns</code></pre>
<pre><code>## Warning in `[.data.table`(sc0data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;medianW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc0data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;obsHourMin&#39; then assigning NULL (deleting
## it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc0data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;meanW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc0data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;nObs&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc0data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;sdW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc0data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;scaledMWmethod1&#39; then assigning NULL
## (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc0data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;EECApmMethod2&#39; then assigning NULL (deleting
## it).</code></pre>
<pre class="r"><code>sc0data &lt;- sc0data[, .(GWhs1 = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]


#Defining peak and off-peak periods
sc0data &lt;- sc0data[, Period := &quot;Not Peak&quot;]

sc0data &lt;- sc0data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc0data &lt;- sc0data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc0data &lt;- sc0data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc0data &lt;- sc0data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc0data &lt;- sc0data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]


#Economic evaluation begins
sc0data &lt;- sc0data[, MWh:=GWhs1*fac1000] # Creating new column GWh based on GWhs1 in MWh


setkey(SeasonAvgDT, season, obsHalfHour)
setkey(sc0data, season, obsHalfHour)

Mergedsc0DT &lt;- sc0data[SeasonAvgDT]

Mergedsc0DT &lt;- Mergedsc0DT[, ecoValueHH := 0]

Mergedsc0DT &lt;- Mergedsc0DT[, MWh := MWh/5]

Mergedsc0DT &lt;- Mergedsc0DT[, ecoValueHH := MWh * (meanprice)/1000000, 
                           keyby = .(season, Region, obsHalfHour)]

#Change the order in facet_grid()
Mergedsc0DT$season &lt;- factor(Mergedsc0DT$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))



#ggsave(&quot;Cost baseline scenario time of day.jpeg&quot;, dpi = 600)

#Building season sum by period
#Mergedsc0DT &lt;- Mergedsc0DT[, .(EcoVal = sum(ecoValueHH)),
                   #keyby = .(season, Region, Period)]</code></pre>
</div>
<div id="load-curtailment-to-zero-sc1-3" class="section level4">
<h4><span class="header-section-number">13.5.1.2</span> Load curtailment to zero SC1</h4>
<pre class="r"><code>fac1000 &lt;- 1000 # We need this conversion to display MWh as required by prices per MWh

sc1data &lt;- refrigerationProfileDT
sc1data[, c(&quot;medianW&quot;, &quot;obsHourMin&quot;, &quot;meanW&quot;, &quot;nObs&quot;, &quot;sdW&quot;,
            &quot;scaledMWmethod1&quot;, &quot;EECApmMethod2&quot;):=NULL] #Deleting unnecessary columns</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;medianW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;obsHourMin&#39; then assigning NULL (deleting
## it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;meanW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;nObs&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;sdW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;scaledMWmethod1&#39; then assigning NULL
## (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;EECApmMethod2&#39; then assigning NULL (deleting
## it).</code></pre>
<pre class="r"><code>sc1data &lt;- sc1data[, .(GWhs1 = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]


#Defining peak and off-peak periods
sc1data &lt;- sc1data[, Period := &quot;Not Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]


#Economic evaluation begins
sc1data &lt;- sc1data[, MWh:=GWhs1*fac1000] # Creating new column GWh based on GWhs1 in MWh


setkey(SeasonAvgDT, season, obsHalfHour)
setkey(sc1data, season, obsHalfHour)

Mergedsc1DT &lt;- sc1data[SeasonAvgDT]

Mergedsc1DT &lt;- Mergedsc1DT[, ecoValueHH := 0]
Mergedsc1DT &lt;- Mergedsc1DT[, MWh := MWh / 5]

Mergedsc1DT &lt;- Mergedsc1DT[, ecoValueHH := ifelse(Period == &quot;Morning Peak&quot; | 
                                                  Period == &quot;Evening Peak&quot;,
                                                (`MWh` * (-meanprice)),
                                                (MWh * (meanprice))),
                           keyby = .(season, Region, obsHalfHour)] 


#Change the order in facet_grid()
Mergedsc1DT$season &lt;- factor(Mergedsc1DT$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))



#Mergedsc1DT &lt;- Mergedsc1DT[, .(EcoVal = sum(ecoValueHH)),
                   #keyby = .(Region, season, Period)]</code></pre>
</div>
<div id="load-curtailment-of-particular-amount-sc2-1" class="section level4">
<h4><span class="header-section-number">13.5.1.3</span> Load curtailment of particular amount: SC2</h4>
<pre class="r"><code>fac1000 &lt;- 1000 # We need this conversion to display MWh as required by prices per MWh

sc2data &lt;- refrigerationProfileDT
sc2data[, c(&quot;medianW&quot;, &quot;obsHourMin&quot;, &quot;meanW&quot;, &quot;nObs&quot;, &quot;sdW&quot;,
            &quot;scaledMWmethod1&quot;, &quot;EECApmMethod2&quot;):=NULL] #Deleting unnecessary columns</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;medianW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;obsHourMin&#39; then assigning NULL (deleting
## it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;meanW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;nObs&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;sdW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;scaledMWmethod1&#39; then assigning NULL
## (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;EECApmMethod2&#39; then assigning NULL (deleting
## it).</code></pre>
<pre class="r"><code>sc2data &lt;- sc2data[, .(GWhs1 = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]


#Defining peak and off-peak periods
sc2data &lt;- sc2data[, Period := &quot;Not Peak&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc1data &lt;- sc2data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

sc2data &lt;- sc2data[, MWh:= ifelse(Period == &quot;Morning Peak&quot; |
                                    Period == &quot;Evening Peak&quot;, GWhs1*1000*0.5, GWhs1*1000)] # Creating new column GWh based on GWhs1 in MWh


setkey(SeasonAvgDT, season, obsHalfHour)

setkey(sc2data, season, obsHalfHour)

Mergedsc2DT &lt;- sc2data[SeasonAvgDT]

Mergedsc2DT &lt;- Mergedsc2DT[, ecoValueHH := 0]
Mergedsc2DT &lt;- Mergedsc2DT[, MWh := MWh / 5]

Mergedsc2DT &lt;- Mergedsc2DT[, ecoValueHH := ifelse(Period == &quot;Morning Peak&quot; | 
                                                  Period == &quot;Evening Peak&quot;,
                                                (`MWh` * (-meanprice)),
                                                MWh * (meanprice)),
                           keyby = .(season, Region, obsHalfHour)] 

#Change the order in facet_grid()
Mergedsc2DT$season &lt;- factor(Mergedsc2DT$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))

#Visualising only shifted consumption
myPlot &lt;- ggplot2::ggplot(Mergedsc2DT, aes(x = obsHalfHour)) +
  geom_point(aes(y=ecoValueHH, color= Region), size=1.5) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Economic value of particular amount by region&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;Economic value $/MWh&#39;) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;03:00:00&quot;), hms::as.hms(&quot;06:00:00&quot;),
                          hms::as.hms(&quot;09:00:00&quot;), hms::as.hms(&quot;12:00:00&quot;),
                          hms::as.hms(&quot;15:00:00&quot;), hms::as.hms(&quot;18:00:00&quot;), hms::as.hms(&quot;21:00:00&quot;)))
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/refrig.%20economic%20value%20of%20particular%20amount-1.png" /><!-- --></p>
<pre class="r"><code>#Mergedsc2DT &lt;- Mergedsc2DT[, .(EcoVal = sum(ecoValueHH)),
                   #keyby = .(Region, season, Period)]</code></pre>
</div>
<div id="load-shifting-to-prior-time-periods-sc3" class="section level4">
<h4><span class="header-section-number">13.5.1.4</span> Load shifting to prior time periods: SC3</h4>
<pre class="r"><code>sc3data &lt;- refrigerationProfileDT
sc3data[, c(&quot;medianW&quot;, &quot;obsHourMin&quot;, &quot;meanW&quot;, &quot;nObs&quot;, &quot;sdW&quot;,
            &quot;scaledMWmethod1&quot;, &quot;EECApmMethod2&quot;):=NULL] #Deleting unnecessary columns</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;medianW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;obsHourMin&#39; then assigning NULL (deleting
## it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;meanW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;nObs&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;sdW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;scaledMWmethod1&#39; then assigning NULL
## (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;EECApmMethod2&#39; then assigning NULL (deleting
## it).</code></pre>
<pre class="r"><code>sc3data &lt;- sc3data[, .(GWhs1 = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]


#Defining peak and off-peak periods
sc3data &lt;- sc3data[, Period := &quot;Not Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

#Building the sum of each peak period by season
AuMP &lt;- sc3data[season == &quot;Autumn&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhs1)]
WiMP &lt;- sc3data[season == &quot;Winter&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhs1)]
SpMP &lt;- sc3data[season == &quot;Spring&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhs1)]
SuMP &lt;- sc3data[season == &quot;Summer&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhs1)]

AuEP &lt;- sc3data[season == &quot;Autumn&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhs1)]
WiEP &lt;- sc3data[season == &quot;Winter&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhs1)]
SpEP &lt;- sc3data[season == &quot;Spring&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhs1)]
SuEP &lt;- sc3data[season == &quot;Summer&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhs1)]


#Counting number of rows that will be associated to spread the Morning Peak
AuMPHalfHours &lt;- nrow(sc3data[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
WiMPHalfHours &lt;- nrow(sc3data[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
SpMPHalfHours &lt;- nrow(sc3data[season == &quot;Spring&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
SuMPHalfHours &lt;- nrow(sc3data[season == &quot;Summer&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])

#Counting number of rows that will be associated to spread the Evening Peak
AuEPHalfHours &lt;- nrow(sc3data[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
WiEPHalfHours &lt;- nrow(sc3data[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
SpEPHalfHours &lt;- nrow(sc3data[season == &quot;Spring&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
SuEPHalfHours &lt;- nrow(sc3data[season == &quot;Summer&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])

#Calculating the proportion that each row will take on to spread the GWhs
distGWhOP1Au &lt;- AuMP/AuMPHalfHours
distGWhOP1Wi &lt;- WiMP/WiMPHalfHours
distGWhOP1Sp &lt;- SpMP/SpMPHalfHours
distGWhOP1Su &lt;- SuMP/SuMPHalfHours

distGWhOP2Au &lt;- AuEP/AuEPHalfHours
distGWhOP2Wi &lt;- WiEP/WiEPHalfHours
distGWhOP2Sp &lt;- SpEP/SpEPHalfHours
distGWhOP2Su &lt;- SuEP/SuEPHalfHours



#Adding amount of spreaded peak consumption to off-peak periods
sc3data &lt;- sc3data[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs3 :=
                     GWhs1 + distGWhOP1Au]
sc3data &lt;- sc3data[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs3 :=
                     GWhs1 + distGWhOP1Wi]
sc3data &lt;- sc3data[season == &quot;Spring&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs3 :=
                     GWhs1 + distGWhOP1Sp]
sc3data &lt;- sc3data[season == &quot;Summer&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs3 :=
                     GWhs1 + distGWhOP1Su]


sc3data &lt;- sc3data[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs3 :=
                     GWhs1 + distGWhOP2Au]
sc3data &lt;- sc3data[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs3 :=
                     GWhs1 + distGWhOP2Wi]
sc3data &lt;- sc3data[season == &quot;Spring&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs3 :=
                     GWhs1 + distGWhOP2Sp]
sc3data &lt;- sc3data[season == &quot;Summer&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs3 :=
                     GWhs1 + distGWhOP2Su]


#Setting missing values in peak periods to NULL
sc3data &lt;- sc3data[, GWhs3:= ifelse(Period ==&quot;Morning Peak&quot;,
                                  0, GWhs3)]
sc3data &lt;- sc3data[, GWhs3:= ifelse(Period ==&quot;Evening Peak&quot;,
                                  0, GWhs3)]
#Economic value starts::

#Creating new column
sc3data &lt;- sc3data[, DiffOrigMWh := 0]
#Calculating the amount added due to load shifting + converting to MWh
sc3data &lt;- sc3data[, DiffOrigMWh := ifelse(GWhs3 &gt; 0,
                                           (GWhs3-GWhs1) * 1000, (0-GWhs1 * 1000))]
#Preparation for merging DTs
setkey(SeasonAvgDT, season, obsHalfHour)
setkey(sc3data, season, obsHalfHour)

#Merging
Mergedsc3DT &lt;- sc3data[SeasonAvgDT]
Mergedsc3DT &lt;- Mergedsc3DT[, DiffOrigMWh := DiffOrigMWh / 5]
Mergedsc3DT &lt;- Mergedsc3DT[, ecoValueHH := ifelse(Period == &quot;Morning Peak&quot; | 
                                                  Period == &quot;Evening Peak&quot;,
                                                DiffOrigMWh * (meanprice),
                                                DiffOrigMWh * (meanprice)),
                           keyby = .(season, Region, obsHalfHour)]#WARNING DiffOrigMWh represents distinction between positive and negative already


#Change the order in facet_grid()
Mergedsc3DT$season &lt;- factor(Mergedsc3DT$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))


#Putting all values together and check!
EcoVaHHDT &lt;- copy(Mergedsc0DT)

setnames(EcoVaHHDT, old=c(&quot;ecoValueHH&quot;), new=c(&quot;Baseline&quot;))

EcoVaHHDT &lt;- cbind(EcoVaHHDT, Mergedsc1DT[,&quot;ecoValueHH&quot;])
setnames(EcoVaHHDT, old=c(&quot;ecoValueHH&quot;), new=c(&quot;EcoVaLc@Peak&quot;))

EcoVaHHDT &lt;- cbind(EcoVaHHDT, Mergedsc2DT[,&quot;ecoValueHH&quot;])
setnames(EcoVaHHDT, old=c(&quot;ecoValueHH&quot;), new=c(&quot;EcoVaLc*0.5@Peak&quot;))

EcoVaHHDT &lt;- cbind(EcoVaHHDT, Mergedsc3DT[,&quot;ecoValueHH&quot;])
setnames(EcoVaHHDT, old=c(&quot;ecoValueHH&quot;), new=c(&quot;EcoVaLs&quot;))

EcoVaHHDT &lt;- EcoVaHHDT[, c(&quot;GWhs1&quot;, &quot;MWh&quot;) := NULL]

EcoVaHHDT &lt;- EcoVaHHDT[, meanprice := meanprice + 0,
                 keyby = .(season, Region, obsHalfHour)]</code></pre>
</div>
<div id="visualisation-refrigeration" class="section level4">
<h4><span class="header-section-number">13.5.1.5</span> Visualisation refrigeration</h4>
<pre class="r"><code>EcoVaSumDT &lt;- copy(EcoVaHHDT)

EcoVaSumDT &lt;- EcoVaSumDT[, Baseline := Baseline]# Converting to million $
EcoVaSumSC0DT &lt;- EcoVaSumDT[, (Baseline = sum(Baseline)), keyby = .(Region, season, Period)]


EcoVaSumSC0DT$Period &lt;- factor(EcoVaSumSC0DT$Period, levels = c(&quot;Off Peak 1&quot;,&quot;Morning Peak&quot;,
                                                    &quot;Off Peak 2&quot;, &quot;Evening Peak&quot;))

#Analysis
CostBaseline &lt;- sum(EcoVaSumDT$Baseline)

SavingsMillionNZD &lt;- CostBaseline-CostBaseline
SavingsPercent &lt;- 0#Compared to Baseline

SavingsMillionNZD</code></pre>
<pre><code>## [1] 0</code></pre>
<pre class="r"><code>SavingsPercent</code></pre>
<pre><code>## [1] 0</code></pre>
<pre class="r"><code>myPlot &lt;- ggplot2::ggplot(EcoVaSumSC0DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Baseline scenario: Cost for heat pumps&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/refrig.%20economic%20visualisation%20SC0-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Baseline scenario: Cost for heat pumps by period.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC0DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Baseline scenario: Cost for heat pumps in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/refrig.%20economic%20visualisation%20SC0-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Baseline scenario: Cost for heat pumps in winter by period.jpeg&quot;, dpi = 600)                        </code></pre>
<pre class="r"><code>#Plots cost of load curtailment to zero, does not consider baseline
EcoVaSumDT &lt;- copy(EcoVaHHDT)

EcoVaSumDT &lt;- EcoVaSumDT[, `EcoVaLc@Peak` := ifelse(Period == &quot;Morning Peak&quot; |
                                                      Period == &quot;Evening Peak&quot;, 0,
                                                    `EcoVaLc@Peak`)]
EcoVaSumDT &lt;- EcoVaSumDT[, `EcoVaLc@Peak` := `EcoVaLc@Peak`/1000000]# Converting to million $
EcoVaSumSC1DT &lt;- EcoVaSumDT[, (`EcoVaLc@Peak` = sum(`EcoVaLc@Peak`)), keyby = .(Region, season, Period)]

EcoVaSumSC1DT$Period &lt;- factor(EcoVaSumSC1DT$Period, levels = c(&quot;Off Peak 1&quot;,&quot;Morning Peak&quot;,
                                                    &quot;Off Peak 2&quot;, &quot;Evening Peak&quot;))

#Analysis
CostBaseline &lt;- sum(EcoVaSumDT$Baseline)
`CostEcoVaLc@Peak` &lt;- sum(EcoVaSumDT$`EcoVaLc@Peak`)

SavingsMillionNZD &lt;- CostBaseline - `CostEcoVaLc@Peak`
SavingsPercent &lt;- 1-(`CostEcoVaLc@Peak` / CostBaseline)

SavingsMillionNZD</code></pre>
<pre><code>## [1] 56.2045</code></pre>
<pre class="r"><code>SavingsPercent</code></pre>
<pre><code>## [1] 0.4115818</code></pre>
<pre class="r"><code>#Visualisation
myPlot &lt;- ggplot2::ggplot(EcoVaSumSC1DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment scenario: Cost for heat pumps&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/1%20economic%20visualisation%20SC1%201-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment scenario: Cost for heat pumps.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC1DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment scenario: Cost per day for heat pumps in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/1%20economic%20visualisation%20SC1%201-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment scenario: Cost per day for heat pumps in winter.jpeg&quot;, dpi = 600)</code></pre>
<pre class="r"><code>#Plots benefits when load is curtailed to zero 

EcoVaSumDT &lt;- copy(EcoVaHHDT)

EcoVaSumSC1DT &lt;- EcoVaSumDT
EcoVaSumSC1DT &lt;- EcoVaSumSC1DT[, `EcoVaLc@Peak` := ifelse(Period == &quot;Off Peak 1&quot; |
                                                            Period == &quot;Off Peak 2&quot;, 0,
                                                          `EcoVaLc@Peak`*(-1))]#We want to disply savings
EcoVaSumSC1DT &lt;- EcoVaSumSC1DT[, `EcoVaLc@Peak` := `EcoVaLc@Peak`/1000000]# Converting to million $
EcoVaSumSC1DT &lt;- EcoVaSumSC1DT[, (`EcoVaLc@Peak` = sum(`EcoVaLc@Peak`)), keyby = .(Region, season, Period)]


EcoVaSumSC1DT$Period &lt;- factor(EcoVaSumSC1DT$Period, levels = c(&quot;Off Peak 1&quot;,&quot;Morning Peak&quot;,
                                                    &quot;Off Peak 2&quot;, &quot;Evening Peak&quot;))

myPlot &lt;- ggplot2::ggplot(EcoVaSumSC1DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment scenario: Savings at peak time-periods for heat pumps&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Savings in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/1%20economic%20visualisation%20SC1%202-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment scenario: Savings at peak time-periods for heat pumps.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC1DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment scenario: Savings at peak time-periods for heat pumps in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Savings in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/1%20economic%20visualisation%20SC1%202-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment scenario: Savings at peak time-periods for heat pumps in winter.jpeg&quot;, dpi = 600)</code></pre>
<pre class="r"><code>#Plots cost and benefits of load curtailment to 0.5, does not consider baseline
EcoVaSumDT &lt;- copy(EcoVaHHDT)

EcoVaSumDT &lt;- EcoVaSumDT[, `EcoVaLc*0.5@Peak` := ifelse(Period == &quot;Morning Peak&quot; |
                                                          Period == &quot;Evening Peak&quot;,
                                              (Baseline*0.5)*1000000,`EcoVaLc*0.5@Peak`)]

EcoVaSumDT &lt;- EcoVaSumDT[, `EcoVaLc*0.5@Peak` := `EcoVaLc*0.5@Peak`/1000000]# Converting to million $
EcoVaSumSC2DT &lt;- EcoVaSumDT[, (`EcoVaLc*0.5@Peak` = sum(`EcoVaLc*0.5@Peak`)), keyby = .(Region, season, Period)]

EcoVaSumSC2DT$Period &lt;- factor(EcoVaSumSC2DT$Period, levels = c(&quot;Off Peak 1&quot;,
                                                                &quot;Morning Peak&quot;,
                                                                &quot;Off Peak 2&quot;,
                                                                &quot;Evening Peak&quot;))

#Analysis

`CostEcoVaLc*0.5@Peak` &lt;- sum(EcoVaSumDT$`EcoVaLc*0.5@Peak`)

SavingsMillionNZD &lt;- CostBaseline - `CostEcoVaLc*0.5@Peak`
SavingsPercent &lt;- 1-(`CostEcoVaLc*0.5@Peak` / CostBaseline)

SavingsMillionNZD</code></pre>
<pre><code>## [1] 28.10225</code></pre>
<pre class="r"><code>SavingsPercent</code></pre>
<pre><code>## [1] 0.2057909</code></pre>
<pre class="r"><code>myPlot &lt;- ggplot2::ggplot(EcoVaSumSC2DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment 0.5 scenario: Cost for heat pumps&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/1%20economic%20visualisation%20SC2%201-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment 0.5 scenario: Cost for heat pumps.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC2DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment 0.5 scenario: Cost for heat pumps in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/1%20economic%20visualisation%20SC2%201-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment 0.5 scenario: Cost for heat pumps in winter.jpeg&quot;, dpi = 600)</code></pre>
<pre class="r"><code>#Plots benefits when load is curtailed to 0.5 

EcoVaSumDT &lt;- copy(EcoVaHHDT)

EcoVaSumSC2DT &lt;- EcoVaSumDT
EcoVaSumSC2DT &lt;- EcoVaSumSC2DT[, `EcoVaLc*0.5@Peak` := ifelse(Period == &quot;Off Peak 1&quot;|
                                                            Period == &quot;Off Peak 2&quot;,0,
                                 `EcoVaLc*0.5@Peak`*(-1))]#We want to disply savings


EcoVaSumSC2DT &lt;- EcoVaSumSC2DT[, `EcoVaLc*0.5@Peak` := `EcoVaLc*0.5@Peak`/1000000]# Converting to million $
EcoVaSumSC2DT &lt;- EcoVaSumSC2DT[, (`EcoVaLc*0.5@Peak` = sum(`EcoVaLc*0.5@Peak`)), keyby = .(Region, season, Period)]


EcoVaSumSC2DT$Period &lt;- factor(EcoVaSumSC2DT$Period, levels = c(&quot;Off Peak 1&quot;,&quot;Morning Peak&quot;,
                                                    &quot;Off Peak 2&quot;, &quot;Evening Peak&quot;))

myPlot &lt;- ggplot2::ggplot(EcoVaSumSC2DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment 0.5 scenario: Savings at peak time-periods for heat pumps&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Savings in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/1%20economic%20visualisation%20SC2%202-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment 0.5 scenario: Savings at peak time-periods for heat pumps.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC2DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment 0.5 scenario: Savings at peak time-periods for heat pumps in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Savings in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/1%20economic%20visualisation%20SC2%202-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment 0.5 scenario: Savings at peak time-periods for heat pumps in winter.jpeg&quot;, dpi = 600)</code></pre>
<pre class="r"><code>#Plots cost and benefits of load shifting, does not consider baseline but increases costs at off peaks
EcoVaSumDT &lt;- copy(EcoVaHHDT)


EcoVaSumDT &lt;- EcoVaSumDT[, EcoSummary := ifelse(Period == &quot;Off Peak 1&quot; |
                                               Period == &quot;Off Peak 2&quot;,
                                             Baseline + (EcoVaLs/1000000), 0)]#It has to be zero 



#EcoVaSumDT &lt;- EcoVaSumDT[, `EcoSummary` := `EcoSummary`/1000000]# Converting to million $
EcoVaSumSC3DT &lt;- EcoVaSumDT[, (`EcoSummary` = sum(`EcoSummary`)), keyby = .(Region, season, Period)]

EcoVaSumSC3DT$Period &lt;- factor(EcoVaSumSC3DT$Period, levels = c(&quot;Off Peak 1&quot;,&quot;Morning Peak&quot;,
                                                    &quot;Off Peak 2&quot;, &quot;Evening Peak&quot;))





#Analysis
CostBaseline &lt;- sum(EcoVaSumDT$Baseline)
`CostLoadShif` &lt;- sum(EcoVaSumDT$`EcoSummary`)

SavingsMillionNZD &lt;- CostBaseline - `CostLoadShif`
SavingsPercent &lt;- 1-(`CostLoadShif` / CostBaseline)

SavingsMillionNZD</code></pre>
<pre><code>## [1] 7.089037</code></pre>
<pre class="r"><code>SavingsPercent</code></pre>
<pre><code>## [1] 0.05191254</code></pre>
<pre class="r"><code>myPlot &lt;- ggplot2::ggplot(EcoVaSumSC3DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load shifting scenario: Cost for heat pumps&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/1%20economic%20visualisation%20SC3%201-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load shifting scenario: Cost for heat pumps.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC3DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load shifting scenario: Cost for heat pumps in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/1%20economic%20visualisation%20SC3%201-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load shifting scenario: Cost for heat pumps in winter.jpeg&quot;, dpi = 600)</code></pre>
</div>
</div>
<div id="heat-pump-economic-value" class="section level3">
<h3><span class="header-section-number">13.5.2</span> Heat pump economic value</h3>
<div id="baseline-value-1" class="section level4">
<h4><span class="header-section-number">13.5.2.1</span> Baseline value</h4>
<pre class="r"><code>fac1000 &lt;- 1000 # We need this conversion to display MWh as required by prices per MWh

sc0data &lt;- heatPumpProfileDT
sc0data[, c(&quot;medianW&quot;, &quot;obsHourMin&quot;, &quot;meanW&quot;, &quot;nObs&quot;, &quot;sdW&quot;,
            &quot;scaledMWmethod1&quot;, &quot;EECApmMethod2&quot;):=NULL] #Deleting unnecessary columns</code></pre>
<pre><code>## Warning in `[.data.table`(sc0data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;medianW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc0data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;obsHourMin&#39; then assigning NULL (deleting
## it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc0data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;meanW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc0data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;nObs&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc0data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;sdW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc0data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;scaledMWmethod1&#39; then assigning NULL
## (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc0data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;EECApmMethod2&#39; then assigning NULL (deleting
## it).</code></pre>
<pre class="r"><code>sc0data &lt;- sc0data[, .(GWhs1 = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]


#Defining peak and off-peak periods
sc0data &lt;- sc0data[, Period := &quot;Not Peak&quot;]

sc0data &lt;- sc0data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc0data &lt;- sc0data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc0data &lt;- sc0data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc0data &lt;- sc0data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc0data &lt;- sc0data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]


#Economic evaluation begins
sc0data &lt;- sc0data[, MWh:=GWhs1*fac1000] # Creating new column GWh based on GWhs1 in MWh


setkey(SeasonAvgDT, season, obsHalfHour)
setkey(sc0data, season, obsHalfHour)

Mergedsc0DT &lt;- sc0data[SeasonAvgDT]

Mergedsc0DT &lt;- Mergedsc0DT[, ecoValueHH := 0]

Mergedsc0DT &lt;- Mergedsc0DT[, MWh := MWh /5]

Mergedsc0DT &lt;- Mergedsc0DT[, ecoValueHH := MWh * (meanprice)/1000000, 
                           keyby = .(season, Region, obsHalfHour)]

#Change the order in facet_grid()
Mergedsc0DT$season &lt;- factor(Mergedsc0DT$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))

#Visualising
myPlot &lt;- ggplot2::ggplot(Mergedsc0DT, aes(x = obsHalfHour)) +
  geom_point(aes(y=ecoValueHH, color= Region), size=1) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Costs baseline scenario time of day&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;Cost in million NZD&#39;) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),
                          hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;),
                          hms::as.hms(&quot;20:00:00&quot;)))
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/setting%20peak%20periods%20to%20zero%20economic%20value2-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Cost baseline scenario time of day.jpeg&quot;, dpi = 600)

#Building season sum by period
#Mergedsc0DT &lt;- Mergedsc0DT[, .(EcoVal = sum(ecoValueHH)),
                   #keyby = .(season, Region, Period)]</code></pre>
</div>
<div id="load-curtailment-to-zero-sc1-4" class="section level4">
<h4><span class="header-section-number">13.5.2.2</span> Load curtailment to zero SC1</h4>
<pre class="r"><code>fac1000 &lt;- 1000 # We need this conversion to display MWh as required by prices per MWh

sc1data &lt;- heatPumpProfileDT
sc1data[, c(&quot;medianW&quot;, &quot;obsHourMin&quot;, &quot;meanW&quot;, &quot;nObs&quot;, &quot;sdW&quot;,
            &quot;scaledMWmethod1&quot;, &quot;EECApmMethod2&quot;):=NULL] #Deleting unnecessary columns</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;medianW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;obsHourMin&#39; then assigning NULL (deleting
## it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;meanW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;nObs&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;sdW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;scaledMWmethod1&#39; then assigning NULL
## (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;EECApmMethod2&#39; then assigning NULL (deleting
## it).</code></pre>
<pre class="r"><code>sc1data &lt;- sc1data[, .(GWhs1 = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]


#Defining peak and off-peak periods
sc1data &lt;- sc1data[, Period := &quot;Not Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]


#Economic evaluation begins
sc1data &lt;- sc1data[, MWh:=GWhs1*fac1000] # Creating new column GWh based on GWhs1 in MWh


setkey(SeasonAvgDT, season, obsHalfHour)
setkey(sc1data, season, obsHalfHour)

Mergedsc1DT &lt;- sc1data[SeasonAvgDT]

Mergedsc1DT &lt;- Mergedsc1DT[, ecoValueHH := 0]
Mergedsc1DT &lt;- Mergedsc1DT[, MWh := MWh /5]

Mergedsc1DT &lt;- Mergedsc1DT[, ecoValueHH := ifelse(Period == &quot;Morning Peak&quot; | 
                                                  Period == &quot;Evening Peak&quot;,
                                                (`MWh` * (-meanprice)),
                                                (MWh * (meanprice))),
                           keyby = .(season, Region, obsHalfHour)] 


#Change the order in facet_grid()
Mergedsc1DT$season &lt;- factor(Mergedsc1DT$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))

#Visualising
myPlot &lt;- ggplot2::ggplot(Mergedsc1DT, aes(x = obsHalfHour)) +
  geom_point(aes(y=ecoValueHH, color= Region), size=1.5) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Economic value of load curtailment to zero by region&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;Economic value $/MWh&#39;) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;03:00:00&quot;), hms::as.hms(&quot;06:00:00&quot;),
                          hms::as.hms(&quot;09:00:00&quot;), hms::as.hms(&quot;12:00:00&quot;),
                          hms::as.hms(&quot;15:00:00&quot;), hms::as.hms(&quot;18:00:00&quot;), hms::as.hms(&quot;21:00:00&quot;)))
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/setting%20peak%20periods%20to%20zero%20economic%20value-1.png" /><!-- --></p>
<pre class="r"><code>#Mergedsc1DT &lt;- Mergedsc1DT[, .(EcoVal = sum(ecoValueHH)),
                   #keyby = .(Region, season, Period)]</code></pre>
</div>
<div id="load-curtailment-of-particular-amount-sc2-2" class="section level4">
<h4><span class="header-section-number">13.5.2.3</span> Load curtailment of particular amount: SC2</h4>
<pre class="r"><code>fac1000 &lt;- 1000 # We need this conversion to display MWh as required by prices per MWh

sc2data &lt;- heatPumpProfileDT
sc2data[, c(&quot;medianW&quot;, &quot;obsHourMin&quot;, &quot;meanW&quot;, &quot;nObs&quot;, &quot;sdW&quot;,
            &quot;scaledMWmethod1&quot;, &quot;EECApmMethod2&quot;):=NULL] #Deleting unnecessary columns</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;medianW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;obsHourMin&#39; then assigning NULL (deleting
## it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;meanW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;nObs&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;sdW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;scaledMWmethod1&#39; then assigning NULL
## (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;EECApmMethod2&#39; then assigning NULL (deleting
## it).</code></pre>
<pre class="r"><code>sc2data &lt;- sc2data[, .(GWhs1 = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]


#Defining peak and off-peak periods
sc2data &lt;- sc2data[, Period := &quot;Not Peak&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc1data &lt;- sc2data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

sc2data &lt;- sc2data[, MWh:= ifelse(Period == &quot;Morning Peak&quot; |
                                    Period == &quot;Evening Peak&quot;, GWhs1*1000*0.5, GWhs1*1000)] # Creating new column GWh based on GWhs1 in MWh


setkey(SeasonAvgDT, season, obsHalfHour)

setkey(sc2data, season, obsHalfHour)

Mergedsc2DT &lt;- sc2data[SeasonAvgDT]

Mergedsc2DT &lt;- Mergedsc2DT[, ecoValueHH := 0]

Mergedsc2DT &lt;- Mergedsc2DT[, MWh := MWh /5]

Mergedsc2DT &lt;- Mergedsc2DT[, ecoValueHH := ifelse(Period == &quot;Morning Peak&quot; | 
                                                  Period == &quot;Evening Peak&quot;,
                                                (`MWh` * (-meanprice)),
                                                MWh * (meanprice)),
                           keyby = .(season, Region, obsHalfHour)] 

#Change the order in facet_grid()
Mergedsc2DT$season &lt;- factor(Mergedsc2DT$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))

#Visualising only shifted consumption
myPlot &lt;- ggplot2::ggplot(Mergedsc2DT, aes(x = obsHalfHour)) +
  geom_point(aes(y=ecoValueHH, color= Region), size=1.5) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Economic value of particular amount by region&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;Economic value $/MWh&#39;) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;03:00:00&quot;), hms::as.hms(&quot;06:00:00&quot;),
                          hms::as.hms(&quot;09:00:00&quot;), hms::as.hms(&quot;12:00:00&quot;),
                          hms::as.hms(&quot;15:00:00&quot;), hms::as.hms(&quot;18:00:00&quot;), hms::as.hms(&quot;21:00:00&quot;)))
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20value%20of%20particular%20amount-1.png" /><!-- --></p>
<pre class="r"><code>#Mergedsc2DT &lt;- Mergedsc2DT[, .(EcoVal = sum(ecoValueHH)),
                   #keyby = .(Region, season, Period)]</code></pre>
</div>
<div id="load-shifting-to-prior-time-periods-sc3-1" class="section level4">
<h4><span class="header-section-number">13.5.2.4</span> Load shifting to prior time periods: SC3</h4>
<pre class="r"><code>sc3data &lt;- heatPumpProfileDT
sc3data[, c(&quot;medianW&quot;, &quot;obsHourMin&quot;, &quot;meanW&quot;, &quot;nObs&quot;, &quot;sdW&quot;,
            &quot;scaledMWmethod1&quot;, &quot;EECApmMethod2&quot;):=NULL] #Deleting unnecessary columns</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;medianW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;obsHourMin&#39; then assigning NULL (deleting
## it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;meanW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;nObs&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;sdW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;scaledMWmethod1&#39; then assigning NULL
## (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;EECApmMethod2&#39; then assigning NULL (deleting
## it).</code></pre>
<pre class="r"><code>sc3data &lt;- sc3data[, .(GWhs1 = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]


#Defining peak and off-peak periods
sc3data &lt;- sc3data[, Period := &quot;Not Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

#Building the sum of each peak period by season
AuMP &lt;- sc3data[season == &quot;Autumn&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhs1)]
WiMP &lt;- sc3data[season == &quot;Winter&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhs1)]
SpMP &lt;- sc3data[season == &quot;Spring&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhs1)]
SuMP &lt;- sc3data[season == &quot;Summer&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhs1)]

AuEP &lt;- sc3data[season == &quot;Autumn&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhs1)]
WiEP &lt;- sc3data[season == &quot;Winter&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhs1)]
SpEP &lt;- sc3data[season == &quot;Spring&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhs1)]
SuEP &lt;- sc3data[season == &quot;Summer&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhs1)]


#Counting number of rows that will be associated to spread the Morning Peak
AuMPHalfHours &lt;- nrow(sc3data[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
WiMPHalfHours &lt;- nrow(sc3data[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
SpMPHalfHours &lt;- nrow(sc3data[season == &quot;Spring&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
SuMPHalfHours &lt;- nrow(sc3data[season == &quot;Summer&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])

#Counting number of rows that will be associated to spread the Evening Peak
AuEPHalfHours &lt;- nrow(sc3data[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
WiEPHalfHours &lt;- nrow(sc3data[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
SpEPHalfHours &lt;- nrow(sc3data[season == &quot;Spring&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
SuEPHalfHours &lt;- nrow(sc3data[season == &quot;Summer&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])

#Calculating the proportion that each row will take on to spread the GWhs
distGWhOP1Au &lt;- AuMP/AuMPHalfHours
distGWhOP1Wi &lt;- WiMP/WiMPHalfHours
distGWhOP1Sp &lt;- SpMP/SpMPHalfHours
distGWhOP1Su &lt;- SuMP/SuMPHalfHours

distGWhOP2Au &lt;- AuEP/AuEPHalfHours
distGWhOP2Wi &lt;- WiEP/WiEPHalfHours
distGWhOP2Sp &lt;- SpEP/SpEPHalfHours
distGWhOP2Su &lt;- SuEP/SuEPHalfHours



#Adding amount of spreaded peak consumption to off-peak periods
sc3data &lt;- sc3data[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs3 :=
                     GWhs1 + distGWhOP1Au]
sc3data &lt;- sc3data[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs3 :=
                     GWhs1 + distGWhOP1Wi]
sc3data &lt;- sc3data[season == &quot;Spring&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs3 :=
                     GWhs1 + distGWhOP1Sp]
sc3data &lt;- sc3data[season == &quot;Summer&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs3 :=
                     GWhs1 + distGWhOP1Su]


sc3data &lt;- sc3data[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs3 :=
                     GWhs1 + distGWhOP2Au]
sc3data &lt;- sc3data[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs3 :=
                     GWhs1 + distGWhOP2Wi]
sc3data &lt;- sc3data[season == &quot;Spring&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs3 :=
                     GWhs1 + distGWhOP2Sp]
sc3data &lt;- sc3data[season == &quot;Summer&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs3 :=
                     GWhs1 + distGWhOP2Su]


#Setting missing values in peak periods to NULL
sc3data &lt;- sc3data[, GWhs3:= ifelse(Period ==&quot;Morning Peak&quot;,
                                  0, GWhs3)]
sc3data &lt;- sc3data[, GWhs3:= ifelse(Period ==&quot;Evening Peak&quot;,
                                  0, GWhs3)]
#Economic value starts::

#Creating new column
sc3data &lt;- sc3data[, DiffOrigMWh := 0]
#Calculating the amount added due to load shifting + converting to MWh
sc3data &lt;- sc3data[, DiffOrigMWh := ifelse(GWhs3 &gt; 0,
                                           (GWhs3-GWhs1) * 1000, (0-GWhs1 * 1000))]
#Preparation for merging DTs
setkey(SeasonAvgDT, season, obsHalfHour)
setkey(sc3data, season, obsHalfHour)

#Merging
Mergedsc3DT &lt;- sc3data[SeasonAvgDT]
Mergedsc3DT &lt;- Mergedsc3DT[, DiffOrigMWh := DiffOrigMWh /5]

Mergedsc3DT &lt;- Mergedsc3DT[, ecoValueHH := ifelse(Period == &quot;Morning Peak&quot; | 
                                                  Period == &quot;Evening Peak&quot;,
                                                DiffOrigMWh * (meanprice),
                                                DiffOrigMWh * (meanprice)),
                           keyby = .(season, Region, obsHalfHour)]#WARNING DiffOrigMWh represents distinction between positive and negative already


#Change the order in facet_grid()
Mergedsc3DT$season &lt;- factor(Mergedsc3DT$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))


#Putting all values together and check!
EcoVaHHDT &lt;- copy(Mergedsc0DT)

setnames(EcoVaHHDT, old=c(&quot;ecoValueHH&quot;), new=c(&quot;Baseline&quot;))

EcoVaHHDT &lt;- cbind(EcoVaHHDT, Mergedsc1DT[,&quot;ecoValueHH&quot;])
setnames(EcoVaHHDT, old=c(&quot;ecoValueHH&quot;), new=c(&quot;EcoVaLc@Peak&quot;))

EcoVaHHDT &lt;- cbind(EcoVaHHDT, Mergedsc2DT[,&quot;ecoValueHH&quot;])
setnames(EcoVaHHDT, old=c(&quot;ecoValueHH&quot;), new=c(&quot;EcoVaLc*0.5@Peak&quot;))

EcoVaHHDT &lt;- cbind(EcoVaHHDT, Mergedsc3DT[,&quot;ecoValueHH&quot;])
setnames(EcoVaHHDT, old=c(&quot;ecoValueHH&quot;), new=c(&quot;EcoVaLs&quot;))

EcoVaHHDT &lt;- EcoVaHHDT[, c(&quot;GWhs1&quot;, &quot;MWh&quot;) := NULL]

EcoVaHHDT &lt;- EcoVaHHDT[, meanprice := meanprice + 0,
                 keyby = .(season, Region, obsHalfHour)]</code></pre>
</div>
<div id="visualisation-heat-pump" class="section level4">
<h4><span class="header-section-number">13.5.2.5</span> Visualisation heat pump</h4>
<pre class="r"><code>EcoVaSumDT &lt;- copy(EcoVaHHDT)

EcoVaSumDT &lt;- EcoVaSumDT[, Baseline := Baseline]# Converting to million $
EcoVaSumSC0DT &lt;- EcoVaSumDT[, (Baseline = sum(Baseline)), keyby = .(Region, season, Period)]


EcoVaSumSC0DT$Period &lt;- factor(EcoVaSumSC0DT$Period, levels = c(&quot;Off Peak 1&quot;,&quot;Morning Peak&quot;,
                                                    &quot;Off Peak 2&quot;, &quot;Evening Peak&quot;))

#Analysis
CostBaseline &lt;- sum(EcoVaSumDT$Baseline)

SavingsMillionNZD &lt;- CostBaseline-CostBaseline
SavingsPercent &lt;- 0#Compared to Baseline

SavingsMillionNZD</code></pre>
<pre><code>## [1] 0</code></pre>
<pre class="r"><code>SavingsPercent</code></pre>
<pre><code>## [1] 0</code></pre>
<pre class="r"><code>myPlot &lt;- ggplot2::ggplot(EcoVaSumSC0DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Baseline scenario: Cost for heat pumps&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC0-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Baseline scenario: Cost for heat pumps by period.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC0DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Baseline scenario: Cost for heat pumps in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC0-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Baseline scenario: Cost for heat pumps in winter by period.jpeg&quot;, dpi = 600)                        </code></pre>
<pre class="r"><code>#Plots cost of load curtailment to zero, does not consider baseline
EcoVaSumDT &lt;- copy(EcoVaHHDT)

EcoVaSumDT &lt;- EcoVaSumDT[, `EcoVaLc@Peak` := ifelse(Period == &quot;Morning Peak&quot; |
                                                      Period == &quot;Evening Peak&quot;, 0,
                                                    `EcoVaLc@Peak`)]
EcoVaSumDT &lt;- EcoVaSumDT[, `EcoVaLc@Peak` := `EcoVaLc@Peak`/1000000]# Converting to million $
EcoVaSumSC1DT &lt;- EcoVaSumDT[, (`EcoVaLc@Peak` = sum(`EcoVaLc@Peak`)), keyby = .(Region, season, Period)]

EcoVaSumSC1DT$Period &lt;- factor(EcoVaSumSC1DT$Period, levels = c(&quot;Off Peak 1&quot;,&quot;Morning Peak&quot;,
                                                    &quot;Off Peak 2&quot;, &quot;Evening Peak&quot;))

#Analysis
CostBaseline &lt;- sum(EcoVaSumDT$Baseline)
`CostEcoVaLc@Peak` &lt;- sum(EcoVaSumDT$`EcoVaLc@Peak`)

SavingsMillionNZD &lt;- CostBaseline - `CostEcoVaLc@Peak`
SavingsPercent &lt;- 1-(`CostEcoVaLc@Peak` / CostBaseline)

SavingsMillionNZD</code></pre>
<pre><code>## [1] 33.14745</code></pre>
<pre class="r"><code>SavingsPercent</code></pre>
<pre><code>## [1] 0.6210158</code></pre>
<pre class="r"><code>#Visualisation
myPlot &lt;- ggplot2::ggplot(EcoVaSumSC1DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment scenario: Cost for heat pumps&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC1%201-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment scenario: Cost for heat pumps.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC1DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment scenario: Cost per day for heat pumps in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC1%201-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment scenario: Cost per day for heat pumps in winter.jpeg&quot;, dpi = 600)</code></pre>
<pre class="r"><code>#Plots benefits when load is curtailed to zero 

EcoVaSumDT &lt;- copy(EcoVaHHDT)

EcoVaSumSC1DT &lt;- EcoVaSumDT
EcoVaSumSC1DT &lt;- EcoVaSumSC1DT[, `EcoVaLc@Peak` := ifelse(Period == &quot;Off Peak 1&quot; |
                                                            Period == &quot;Off Peak 2&quot;, 0,
                                                          `EcoVaLc@Peak`*(-1))]#We want to disply savings
EcoVaSumSC1DT &lt;- EcoVaSumSC1DT[, `EcoVaLc@Peak` := `EcoVaLc@Peak`/1000000]# Converting to million $
EcoVaSumSC1DT &lt;- EcoVaSumSC1DT[, (`EcoVaLc@Peak` = sum(`EcoVaLc@Peak`)), keyby = .(Region, season, Period)]


EcoVaSumSC1DT$Period &lt;- factor(EcoVaSumSC1DT$Period, levels = c(&quot;Off Peak 1&quot;,&quot;Morning Peak&quot;,
                                                    &quot;Off Peak 2&quot;, &quot;Evening Peak&quot;))

myPlot &lt;- ggplot2::ggplot(EcoVaSumSC1DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment scenario: Savings at peak time-periods for heat pumps&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Savings in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC1%202-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment scenario: Savings at peak time-periods for heat pumps.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC1DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment scenario: Savings at peak time-periods for heat pumps in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Savings in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC1%202-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment scenario: Savings at peak time-periods for heat pumps in winter.jpeg&quot;, dpi = 600)</code></pre>
<pre class="r"><code>#Plots cost and benefits of load curtailment to 0.5, does not consider baseline
EcoVaSumDT &lt;- copy(EcoVaHHDT)

EcoVaSumDT &lt;- EcoVaSumDT[, `EcoVaLc*0.5@Peak` := ifelse(Period == &quot;Morning Peak&quot; |
                                                          Period == &quot;Evening Peak&quot;,
                                              (Baseline*0.5)*1000000,`EcoVaLc*0.5@Peak`)]

EcoVaSumDT &lt;- EcoVaSumDT[, `EcoVaLc*0.5@Peak` := `EcoVaLc*0.5@Peak`/1000000]# Converting to million $
EcoVaSumSC2DT &lt;- EcoVaSumDT[, (`EcoVaLc*0.5@Peak` = sum(`EcoVaLc*0.5@Peak`)), keyby = .(Region, season, Period)]

EcoVaSumSC2DT$Period &lt;- factor(EcoVaSumSC2DT$Period, levels = c(&quot;Off Peak 1&quot;,
                                                                &quot;Morning Peak&quot;,
                                                                &quot;Off Peak 2&quot;,
                                                                &quot;Evening Peak&quot;))

#Analysis

`CostEcoVaLc*0.5@Peak` &lt;- sum(EcoVaSumDT$`EcoVaLc*0.5@Peak`)

SavingsMillionNZD &lt;- CostBaseline - `CostEcoVaLc*0.5@Peak`
SavingsPercent &lt;- 1-(`CostEcoVaLc*0.5@Peak` / CostBaseline)

SavingsMillionNZD</code></pre>
<pre><code>## [1] 16.57373</code></pre>
<pre class="r"><code>SavingsPercent</code></pre>
<pre><code>## [1] 0.3105079</code></pre>
<pre class="r"><code>myPlot &lt;- ggplot2::ggplot(EcoVaSumSC2DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment 0.5 scenario: Cost for heat pumps&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC2%201-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment 0.5 scenario: Cost for heat pumps.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC2DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment 0.5 scenario: Cost for heat pumps in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC2%201-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment 0.5 scenario: Cost for heat pumps in winter.jpeg&quot;, dpi = 600)</code></pre>
<pre class="r"><code>#Plots benefits when load is curtailed to 0.5 

EcoVaSumDT &lt;- copy(EcoVaHHDT)

EcoVaSumSC2DT &lt;- EcoVaSumDT
EcoVaSumSC2DT &lt;- EcoVaSumSC2DT[, `EcoVaLc*0.5@Peak` := ifelse(Period == &quot;Off Peak 1&quot;|
                                                            Period == &quot;Off Peak 2&quot;,0,
                                 `EcoVaLc*0.5@Peak`*(-1))]#We want to disply savings


EcoVaSumSC2DT &lt;- EcoVaSumSC2DT[, `EcoVaLc*0.5@Peak` := `EcoVaLc*0.5@Peak`/1000000]# Converting to million $
EcoVaSumSC2DT &lt;- EcoVaSumSC2DT[, (`EcoVaLc*0.5@Peak` = sum(`EcoVaLc*0.5@Peak`)), keyby = .(Region, season, Period)]


EcoVaSumSC2DT$Period &lt;- factor(EcoVaSumSC2DT$Period, levels = c(&quot;Off Peak 1&quot;,&quot;Morning Peak&quot;,
                                                    &quot;Off Peak 2&quot;, &quot;Evening Peak&quot;))

myPlot &lt;- ggplot2::ggplot(EcoVaSumSC2DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment 0.5 scenario: Savings at peak time-periods for heat pumps&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Savings in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC2%202-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment 0.5 scenario: Savings at peak time-periods for heat pumps.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC2DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment 0.5 scenario: Savings at peak time-periods for heat pumps in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Savings in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC2%202-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment 0.5 scenario: Savings at peak time-periods for heat pumps in winter.jpeg&quot;, dpi = 600)</code></pre>
<pre class="r"><code>#Plots cost and benefits of load shifting, does not consider baseline but increases costs at off peaks
EcoVaSumDT &lt;- copy(EcoVaHHDT)


EcoVaSumDT &lt;- EcoVaSumDT[, EcoSummary := ifelse(Period == &quot;Off Peak 1&quot; |
                                               Period == &quot;Off Peak 2&quot;,
                                             Baseline + (EcoVaLs/1000000), 0)]#It has to be zero 



#EcoVaSumDT &lt;- EcoVaSumDT[, `EcoSummary` := `EcoSummary`/1000000]# Converting to million $
EcoVaSumSC3DT &lt;- EcoVaSumDT[, (`EcoSummary` = sum(`EcoSummary`)), keyby = .(Region, season, Period)]

EcoVaSumSC3DT$Period &lt;- factor(EcoVaSumSC3DT$Period, levels = c(&quot;Off Peak 1&quot;,&quot;Morning Peak&quot;,
                                                    &quot;Off Peak 2&quot;, &quot;Evening Peak&quot;))





#Analysis
CostBaseline &lt;- sum(EcoVaSumDT$Baseline)
`CostLoadShif` &lt;- sum(EcoVaSumDT$`EcoSummary`)

SavingsMillionNZD &lt;- CostBaseline - `CostLoadShif`
SavingsPercent &lt;- 1-(`CostLoadShif` / CostBaseline)

SavingsMillionNZD</code></pre>
<pre><code>## [1] 3.375802</code></pre>
<pre class="r"><code>SavingsPercent</code></pre>
<pre><code>## [1] 0.06324547</code></pre>
<pre class="r"><code>myPlot &lt;- ggplot2::ggplot(EcoVaSumSC3DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load shifting scenario: Cost for heat pumps&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC3%201-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load shifting scenario: Cost for heat pumps.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC3DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load shifting scenario: Cost for heat pumps in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC3%201-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load shifting scenario: Cost for heat pumps in winter.jpeg&quot;, dpi = 600)</code></pre>
</div>
</div>
<div id="hot-water-economic-value" class="section level3">
<h3><span class="header-section-number">13.5.3</span> Hot water economic value</h3>
<div id="baseline" class="section level4">
<h4><span class="header-section-number">13.5.3.1</span> Baseline</h4>
<pre class="r"><code>fac1000 &lt;- 1000 # We need this conversion to display MWh as required by prices per MWh

sc0data &lt;- hotWaterProfileDT
sc0data[, c(&quot;medianW&quot;, &quot;obsHourMin&quot;, &quot;meanW&quot;, &quot;nObs&quot;, &quot;sdW&quot;,
            &quot;scaledMWmethod1&quot;, &quot;EECApmMethod2&quot;):=NULL] #Deleting unnecessary columns</code></pre>
<pre><code>## Warning in `[.data.table`(sc0data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;medianW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc0data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;obsHourMin&#39; then assigning NULL (deleting
## it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc0data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;meanW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc0data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;nObs&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc0data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;sdW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc0data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;scaledMWmethod1&#39; then assigning NULL
## (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc0data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;EECApmMethod2&#39; then assigning NULL (deleting
## it).</code></pre>
<pre class="r"><code>sc0data &lt;- sc0data[, .(GWhs1 = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]


#Defining peak and off-peak periods
sc0data &lt;- sc0data[, Period := &quot;Not Peak&quot;]

sc0data &lt;- sc0data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc0data &lt;- sc0data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc0data &lt;- sc0data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc0data &lt;- sc0data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc0data &lt;- sc0data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]


#Economic evaluation begins
sc0data &lt;- sc0data[, MWh:=GWhs1*fac1000] # Creating new column GWh based on GWhs1 in MWh


setkey(SeasonAvgDT, season, obsHalfHour)
setkey(sc0data, season, obsHalfHour)

Mergedsc0DT &lt;- sc0data[SeasonAvgDT]

Mergedsc0DT &lt;- Mergedsc0DT[, ecoValueHH := 0]

Mergedsc0DT &lt;- Mergedsc0DT[, MWh := MWh / 5]

Mergedsc0DT &lt;- Mergedsc0DT[, ecoValueHH := (MWh * (meanprice)/1000000), 
                           keyby = .(season, Region, obsHalfHour)]

#Change the order in facet_grid()
Mergedsc0DT$season &lt;- factor(Mergedsc0DT$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))

#Visualising
myPlot &lt;- ggplot2::ggplot(Mergedsc0DT, aes(x = obsHalfHour)) +
  geom_point(aes(y=ecoValueHH, color= Region), size=1) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Costs baseline scenario time of day for hot water&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;Cost in million NZD&#39;) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),
                          hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;),
                          hms::as.hms(&quot;20:00:00&quot;)))
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/calculating%20baseline%20scenario%20SC0-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Cost per day baseline scenario time of day.jpeg&quot;, dpi = 600)

#Building season sum by period
#Mergedsc0DT &lt;- Mergedsc0DT[, .(EcoVal = sum(ecoValueHH)),
                  # keyby = .(season, Region, Period)]</code></pre>
</div>
<div id="load-curtailment-to-zero-sc1-5" class="section level4">
<h4><span class="header-section-number">13.5.3.2</span> Load curtailment to zero SC1</h4>
<pre class="r"><code>fac1000 &lt;- 1000 # We need this conversion to display MWh as required by prices per MWh

sc1data &lt;- hotWaterProfileDT
sc1data[, c(&quot;medianW&quot;, &quot;obsHourMin&quot;, &quot;meanW&quot;, &quot;nObs&quot;, &quot;sdW&quot;,
            &quot;scaledMWmethod1&quot;, &quot;EECApmMethod2&quot;):=NULL] #Deleting unnecessary columns</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;medianW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;obsHourMin&#39; then assigning NULL (deleting
## it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;meanW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;nObs&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;sdW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;scaledMWmethod1&#39; then assigning NULL
## (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;EECApmMethod2&#39; then assigning NULL (deleting
## it).</code></pre>
<pre class="r"><code>sc1data &lt;- sc1data[, .(GWhs1 = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]


#Defining peak and off-peak periods
sc1data &lt;- sc1data[, Period := &quot;Not Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]


#Economic evaluation begins
sc1data &lt;- sc1data[, MWh:=GWhs1*fac1000] # Creating new column GWh based on GWhs1 in MWh


setkey(SeasonAvgDT, season, obsHalfHour)
setkey(sc1data, season, obsHalfHour)

Mergedsc1DT &lt;- sc1data[SeasonAvgDT]

Mergedsc1DT &lt;- Mergedsc1DT[, ecoValueHH := 0]

Mergedsc1DT &lt;- Mergedsc1DT[, MWh := MWh / 5]

Mergedsc1DT &lt;- Mergedsc1DT[, ecoValueHH := ifelse(Period == &quot;Morning Peak&quot; | 
                                                  Period == &quot;Evening Peak&quot;,
                                                (`MWh` * (-meanprice)),
                                                (MWh * (meanprice))),
                           keyby = .(season, Region, obsHalfHour)] 


#Change the order in facet_grid()
Mergedsc1DT$season &lt;- factor(Mergedsc1DT$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))

#Visualising
#myPlot &lt;- ggplot2::ggplot(Mergedsc1DT, aes(x = obsHalfHour)) +
#  geom_point(aes(y=ecoValueHH, color= Region), size=1.5) +
#  theme(text = element_text(family = &quot;Cambria&quot;)) +
#  ggtitle(&quot;Economic value of load curtailment to zero by region&quot;) +
#  facet_grid(season ~ .) +
#  labs(x=&#39;Time of Day&#39;, y=&#39;Economic value $/MWh&#39;) +
#  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;03:00:00&quot;), hms::as.hms(&quot;06:00:00&quot;),
                        #  hms::as.hms(&quot;09:00:00&quot;), hms::as.hms(&quot;12:00:00&quot;),
                        #  hms::as.hms(&quot;15:00:00&quot;), hms::as.hms(&quot;18:00:00&quot;), hms::as.hms(&quot;21:00:00&quot;)))
#myPlot

#Mergedsc1DT &lt;- Mergedsc1DT[, .(EcoVal = sum(ecoValueHH)),
                   #keyby = .(Region, season, Period)]</code></pre>
</div>
<div id="load-curtailment-of-particular-amount-sc2-3" class="section level4">
<h4><span class="header-section-number">13.5.3.3</span> Load curtailment of particular amount SC2</h4>
<pre class="r"><code>fac1000 &lt;- 1000 # We need this conversion to display MWh as required by prices per MWh

sc2data &lt;- hotWaterProfileDT
sc2data[, c(&quot;medianW&quot;, &quot;obsHourMin&quot;, &quot;meanW&quot;, &quot;nObs&quot;, &quot;sdW&quot;,
            &quot;scaledMWmethod1&quot;, &quot;EECApmMethod2&quot;):=NULL] #Deleting unnecessary columns</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;medianW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;obsHourMin&#39; then assigning NULL (deleting
## it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;meanW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;nObs&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;sdW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;scaledMWmethod1&#39; then assigning NULL
## (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;EECApmMethod2&#39; then assigning NULL (deleting
## it).</code></pre>
<pre class="r"><code>sc2data &lt;- sc2data[, .(GWhs1 = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]


#Defining peak and off-peak periods
sc2data &lt;- sc2data[, Period := &quot;Not Peak&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

sc2data &lt;- sc2data[, MWh:= ifelse(Period == &quot;Morning Peak&quot; |
                                    Period == &quot;Evening Peak&quot;, GWhs1*1000*0.5, GWhs1*1000)] # Creating new column GWh based on GWhs1 in MWh


setkey(SeasonAvgDT, season, obsHalfHour)

setkey(sc2data, season, obsHalfHour)

Mergedsc2DT &lt;- sc2data[SeasonAvgDT]

Mergedsc2DT &lt;- Mergedsc2DT[, ecoValueHH := 0]

Mergedsc2DT &lt;- Mergedsc2DT[, MWh := MWh / 5]

Mergedsc2DT &lt;- Mergedsc2DT[, ecoValueHH := ifelse(Period == &quot;Morning Peak&quot; | 
                                                  Period == &quot;Evening Peak&quot;,
                                                (`MWh` * (-meanprice)),
                                                MWh * (meanprice)),
                           keyby = .(season, Region, obsHalfHour)] 

#Change the order in facet_grid()
Mergedsc2DT$season &lt;- factor(Mergedsc2DT$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))

#Visualising only shifted consumption
#myPlot &lt;- ggplot2::ggplot(Mergedsc2DT, aes(x = obsHalfHour)) +
 # geom_point(aes(y=ecoValueHH, color= Region), size=1.5) +
 # theme(text = element_text(family = &quot;Cambria&quot;)) +
 # ggtitle(&quot;Economic value of particular amount by region&quot;) +
 # facet_grid(season ~ .) +
 # labs(x=&#39;Time of Day&#39;, y=&#39;Economic value $/MWh&#39;) +
 # scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;03:00:00&quot;), hms::as.hms(&quot;06:00:00&quot;),
                         # hms::as.hms(&quot;09:00:00&quot;), hms::as.hms(&quot;12:00:00&quot;),
                         # hms::as.hms(&quot;15:00:00&quot;), hms::as.hms(&quot;18:00:00&quot;), hms::as.hms(&quot;21:00:00&quot;)))
#myPlot

#Mergedsc2DT &lt;- Mergedsc2DT[, .(EcoVal = sum(ecoValueHH)),
                   #keyby = .(Region, season, Period)]</code></pre>
</div>
<div id="load-shifting-to-prior-time-periods-sc3-2" class="section level4">
<h4><span class="header-section-number">13.5.3.4</span> Load shifting to prior time periods: SC3</h4>
<pre class="r"><code>sc3data &lt;- hotWaterProfileDT
sc3data[, c(&quot;medianW&quot;, &quot;obsHourMin&quot;, &quot;meanW&quot;, &quot;nObs&quot;, &quot;sdW&quot;,
            &quot;scaledMWmethod1&quot;, &quot;EECApmMethod2&quot;):=NULL] #Deleting unnecessary columns</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;medianW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;obsHourMin&#39; then assigning NULL (deleting
## it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;meanW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;nObs&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;sdW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;scaledMWmethod1&#39; then assigning NULL
## (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;EECApmMethod2&#39; then assigning NULL (deleting
## it).</code></pre>
<pre class="r"><code>sc3data &lt;- sc3data[, .(GWhs1 = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]


#Defining peak and off-peak periods
sc3data &lt;- sc3data[, Period := &quot;Not Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

#Building the sum of each peak period by season
AuMP &lt;- sc3data[season == &quot;Autumn&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhs1)]
WiMP &lt;- sc3data[season == &quot;Winter&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhs1)]
SpMP &lt;- sc3data[season == &quot;Spring&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhs1)]
SuMP &lt;- sc3data[season == &quot;Summer&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhs1)]

AuEP &lt;- sc3data[season == &quot;Autumn&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhs1)]
WiEP &lt;- sc3data[season == &quot;Winter&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhs1)]
SpEP &lt;- sc3data[season == &quot;Spring&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhs1)]
SuEP &lt;- sc3data[season == &quot;Summer&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhs1)]


#Counting number of rows that will be associated to spread the Morning Peak
AuMPHalfHours &lt;- nrow(sc3data[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
WiMPHalfHours &lt;- nrow(sc3data[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
SpMPHalfHours &lt;- nrow(sc3data[season == &quot;Spring&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
SuMPHalfHours &lt;- nrow(sc3data[season == &quot;Summer&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])

#Counting number of rows that will be associated to spread the Evening Peak
AuEPHalfHours &lt;- nrow(sc3data[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
WiEPHalfHours &lt;- nrow(sc3data[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
SpEPHalfHours &lt;- nrow(sc3data[season == &quot;Spring&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
SuEPHalfHours &lt;- nrow(sc3data[season == &quot;Summer&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])

#Calculating the proportion that each row will take on to spread the GWhs
distGWhOP1Au &lt;- AuMP/AuMPHalfHours
distGWhOP1Wi &lt;- WiMP/WiMPHalfHours
distGWhOP1Sp &lt;- SpMP/SpMPHalfHours
distGWhOP1Su &lt;- SuMP/SuMPHalfHours

distGWhOP2Au &lt;- AuEP/AuEPHalfHours
distGWhOP2Wi &lt;- WiEP/WiEPHalfHours
distGWhOP2Sp &lt;- SpEP/SpEPHalfHours
distGWhOP2Su &lt;- SuEP/SuEPHalfHours



#Adding amount of spreaded peak consumption to off-peak periods
sc3data &lt;- sc3data[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs3 :=
                     GWhs1 + distGWhOP1Au]
sc3data &lt;- sc3data[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs3 :=
                     GWhs1 + distGWhOP1Wi]
sc3data &lt;- sc3data[season == &quot;Spring&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs3 :=
                     GWhs1 + distGWhOP1Sp]
sc3data &lt;- sc3data[season == &quot;Summer&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs3 :=
                     GWhs1 + distGWhOP1Su]


sc3data &lt;- sc3data[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs3 :=
                     GWhs1 + distGWhOP2Au]
sc3data &lt;- sc3data[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs3 :=
                     GWhs1 + distGWhOP2Wi]
sc3data &lt;- sc3data[season == &quot;Spring&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs3 :=
                     GWhs1 + distGWhOP2Sp]
sc3data &lt;- sc3data[season == &quot;Summer&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs3 :=
                     GWhs1 + distGWhOP2Su]


#Setting missing values in peak periods to NULL
sc3data &lt;- sc3data[, GWhs3:= ifelse(Period ==&quot;Morning Peak&quot;,
                                  0, GWhs3)]
sc3data &lt;- sc3data[, GWhs3:= ifelse(Period ==&quot;Evening Peak&quot;,
                                  0, GWhs3)]
#Economic value starts::

#Creating new column
sc3data &lt;- sc3data[, DiffOrigMWh := 0]
#Calculating the amount added due to load shifting + converting to MWh
sc3data &lt;- sc3data[, DiffOrigMWh := ifelse(GWhs3 &gt; 0,
                                           (GWhs3-GWhs1) * 1000, (0-GWhs1 * 1000))]
#Preparation for merging DTs
setkey(SeasonAvgDT, season, obsHalfHour)
setkey(sc3data, season, obsHalfHour)

#Merging
Mergedsc3DT &lt;- sc3data[SeasonAvgDT]

Mergedsc3DT &lt;- Mergedsc3DT[, DiffOrigMWh := DiffOrigMWh / 5]

Mergedsc3DT &lt;- Mergedsc3DT[, ecoValueHH := ifelse(Period == &quot;Morning Peak&quot; | 
                                                  Period == &quot;Evening Peak&quot;,
                                                DiffOrigMWh * (meanprice),
                                                DiffOrigMWh * (meanprice)),
                           keyby = .(season, Region, obsHalfHour)]#WARNING DiffOrigMWh represents distinction between positive and negative already


#Change the order in facet_grid()
Mergedsc3DT$season &lt;- factor(Mergedsc3DT$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))


#Putting all values together and check!
EcoVaHHDT &lt;- copy(Mergedsc0DT)

setnames(EcoVaHHDT, old=c(&quot;ecoValueHH&quot;), new=c(&quot;Baseline&quot;))

EcoVaHHDT &lt;- cbind(EcoVaHHDT, Mergedsc1DT[,&quot;ecoValueHH&quot;])
setnames(EcoVaHHDT, old=c(&quot;ecoValueHH&quot;), new=c(&quot;EcoVaLc@Peak&quot;))

EcoVaHHDT &lt;- cbind(EcoVaHHDT, Mergedsc2DT[,&quot;ecoValueHH&quot;])
setnames(EcoVaHHDT, old=c(&quot;ecoValueHH&quot;), new=c(&quot;EcoVaLc*0.5@Peak&quot;))

EcoVaHHDT &lt;- cbind(EcoVaHHDT, Mergedsc3DT[,&quot;ecoValueHH&quot;])
setnames(EcoVaHHDT, old=c(&quot;ecoValueHH&quot;), new=c(&quot;EcoVaLs&quot;))

EcoVaHHDT &lt;- EcoVaHHDT[, c(&quot;GWhs1&quot;, &quot;MWh&quot;) := NULL]

EcoVaHHDT &lt;- EcoVaHHDT[, meanprice := meanprice + 0,
                 keyby = .(season, Region, obsHalfHour)]</code></pre>
</div>
<div id="visualisation-hot-water" class="section level4">
<h4><span class="header-section-number">13.5.3.5</span> Visualisation hot water</h4>
<pre class="r"><code>EcoVaSumDT &lt;- copy(EcoVaHHDT)

EcoVaSumDT &lt;- EcoVaSumDT[, Baseline := Baseline]# Converting to million $
EcoVaSumSC0DT &lt;- EcoVaSumDT[, (Baseline = sum(Baseline)), keyby = .(Region, season, Period)]


EcoVaSumSC0DT$Period &lt;- factor(EcoVaSumSC0DT$Period, levels = c(&quot;Off Peak 1&quot;,&quot;Morning Peak&quot;,
                                                    &quot;Off Peak 2&quot;, &quot;Evening Peak&quot;))

#Analysis
CostBaseline &lt;- sum(EcoVaSumDT$Baseline)

SavingsMillionNZD &lt;- CostBaseline-CostBaseline
SavingsPercent &lt;- 0#Compared to Baseline

SavingsMillionNZD</code></pre>
<pre><code>## [1] 0</code></pre>
<pre class="r"><code>SavingsPercent</code></pre>
<pre><code>## [1] 0</code></pre>
<pre class="r"><code>myPlot &lt;- ggplot2::ggplot(EcoVaSumSC0DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Baseline scenario: Cost for hot water&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC0%20hot%20water-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Baseline scenario: Cost for hot water by period.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC0DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Baseline scenario: Cost for hot water in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC0%20hot%20water-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Baseline scenario: Cost for hot water in winter by period.jpeg&quot;, dpi = 600)                        </code></pre>
<pre class="r"><code>#Plots cost of load curtailment to zero, does not consider baseline
EcoVaSumDT &lt;- copy(EcoVaHHDT)

EcoVaSumDT &lt;- EcoVaSumDT[, `EcoVaLc@Peak` := ifelse(Period == &quot;Morning Peak&quot; |
                                                      Period == &quot;Evening Peak&quot;, 0,
                                                    `EcoVaLc@Peak`)]
EcoVaSumDT &lt;- EcoVaSumDT[, `EcoVaLc@Peak` := `EcoVaLc@Peak`/1000000]# Converting to million $
EcoVaSumSC1DT &lt;- EcoVaSumDT[, (`EcoVaLc@Peak` = sum(`EcoVaLc@Peak`)), keyby = .(Region, season, Period)]

EcoVaSumSC1DT$Period &lt;- factor(EcoVaSumSC1DT$Period, levels = c(&quot;Off Peak 1&quot;,&quot;Morning Peak&quot;,
                                                    &quot;Off Peak 2&quot;, &quot;Evening Peak&quot;))

#Analysis
CostBaseline &lt;- sum(EcoVaSumDT$Baseline)
`CostEcoVaLc@Peak` &lt;- sum(EcoVaSumDT$`EcoVaLc@Peak`)

SavingsMillionNZD &lt;- CostBaseline - `CostEcoVaLc@Peak`
SavingsPercent &lt;- 1-(`CostEcoVaLc@Peak` / CostBaseline)

SavingsMillionNZD</code></pre>
<pre><code>## [1] 135.4888</code></pre>
<pre class="r"><code>SavingsPercent</code></pre>
<pre><code>## [1] 0.5705792</code></pre>
<pre class="r"><code>#Visualisation
myPlot &lt;- ggplot2::ggplot(EcoVaSumSC1DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment scenario: Cost for hot water&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC1%201%20hot%20water-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment scenario: Cost for hot water.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC1DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment scenario: Cost for hot water in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC1%201%20hot%20water-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment scenario: Cost for hot water in winter.jpeg&quot;, dpi = 600)</code></pre>
<pre class="r"><code>#Plots benefits when load is curtailed to zero 

EcoVaSumDT &lt;- copy(EcoVaHHDT)

EcoVaSumSC1DT &lt;- EcoVaSumDT
EcoVaSumSC1DT &lt;- EcoVaSumSC1DT[, `EcoVaLc@Peak` := ifelse(Period == &quot;Off Peak 1&quot; |
                                                            Period == &quot;Off Peak 2&quot;, 0,
                                                          `EcoVaLc@Peak`*(-1))]#We want to disply savings
EcoVaSumSC1DT &lt;- EcoVaSumSC1DT[, `EcoVaLc@Peak` := `EcoVaLc@Peak`/1000000]# Converting to million $
EcoVaSumSC1DT &lt;- EcoVaSumSC1DT[, (`EcoVaLc@Peak` = sum(`EcoVaLc@Peak`)), keyby = .(Region, season, Period)]


EcoVaSumSC1DT$Period &lt;- factor(EcoVaSumSC1DT$Period, levels = c(&quot;Off Peak 1&quot;,&quot;Morning Peak&quot;,
                                                    &quot;Off Peak 2&quot;, &quot;Evening Peak&quot;))

myPlot &lt;- ggplot2::ggplot(EcoVaSumSC1DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment scenario: Savings at peak time-periods for hot water&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Savings in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC1%202%20hot%20water-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment scenario: Savings at peak time-periods for hot water.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC1DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment scenario: Savings at peak time-periods for hot water in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Savings in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC1%202%20hot%20water-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment scenario: Savings at peak time-periods for hot water in winter.jpeg&quot;, dpi = 600)</code></pre>
<pre class="r"><code>#Plots cost and benefits of load curtailment to 0.5, does not consider baseline
EcoVaSumDT &lt;- copy(EcoVaHHDT)

EcoVaSumDT &lt;- EcoVaSumDT[, `EcoVaLc*0.5@Peak` := ifelse(Period == &quot;Morning Peak&quot; |
                                                          Period == &quot;Evening Peak&quot;,
                                             ((Baseline*0.5)*1000000),`EcoVaLc*0.5@Peak`)]

EcoVaSumDT &lt;- EcoVaSumDT[, `EcoVaLc*0.5@Peak` := `EcoVaLc*0.5@Peak`/1000000]# Converting to million $
EcoVaSumSC2DT &lt;- EcoVaSumDT[, (`EcoVaLc*0.5@Peak` = sum(`EcoVaLc*0.5@Peak`)), keyby = .(Region, season, Period)]

EcoVaSumSC2DT$Period &lt;- factor(EcoVaSumSC2DT$Period, levels = c(&quot;Off Peak 1&quot;,
                                                                &quot;Morning Peak&quot;,
                                                                &quot;Off Peak 2&quot;,
                                                                &quot;Evening Peak&quot;))

#Analysis
CostBaseline &lt;- sum(EcoVaSumDT$Baseline)
`CostEcoVaLc*0.5@Peak` &lt;- sum(EcoVaSumDT$`EcoVaLc*0.5@Peak`)

SavingsMillionNZD &lt;- CostBaseline - `CostEcoVaLc*0.5@Peak`
SavingsPercent &lt;- 1-(`CostEcoVaLc*0.5@Peak` / CostBaseline)

SavingsMillionNZD</code></pre>
<pre><code>## [1] 67.7444</code></pre>
<pre class="r"><code>SavingsPercent</code></pre>
<pre><code>## [1] 0.2852896</code></pre>
<pre class="r"><code>myPlot &lt;- ggplot2::ggplot(EcoVaSumSC2DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment 0.5 scenario: Cost for hot water&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC2%201%20hot%20water-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment 0.5 scenario: Cost for hot water.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC2DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment 0.5 scenario: Cost for hot water in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC2%201%20hot%20water-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment 0.5 scenario: Cost for hot water in winter.jpeg&quot;, dpi = 600)</code></pre>
<pre class="r"><code>#Plots benefits when load is curtailed to 0.5 

EcoVaSumDT &lt;- copy(EcoVaHHDT)

EcoVaSumSC2DT &lt;- EcoVaSumDT
EcoVaSumSC2DT &lt;- EcoVaSumSC2DT[, `EcoVaLc*0.5@Peak` := ifelse(Period == &quot;Off Peak 1&quot;|
                                                            Period == &quot;Off Peak 2&quot;,0,
                                 `EcoVaLc*0.5@Peak`*(-1))]#We want to disply savings


EcoVaSumSC2DT &lt;- EcoVaSumSC2DT[, `EcoVaLc*0.5@Peak` := `EcoVaLc*0.5@Peak`/1000000]# Converting to million $
EcoVaSumSC2DT &lt;- EcoVaSumSC2DT[, (`EcoVaLc*0.5@Peak` = sum(`EcoVaLc*0.5@Peak`)), keyby = .(Region, season, Period)]


EcoVaSumSC2DT$Period &lt;- factor(EcoVaSumSC2DT$Period, levels = c(&quot;Off Peak 1&quot;,&quot;Morning Peak&quot;,
                                                    &quot;Off Peak 2&quot;, &quot;Evening Peak&quot;))

myPlot &lt;- ggplot2::ggplot(EcoVaSumSC2DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment 0.5 scenario: Savings at peak time-periods for hot water&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Savings in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC2%202%20hot%20water-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment 0.5 scenario: Savings at peak time-periods for hot water.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC2DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment 0.5 scenario: Savings at peak time-periods for hot water in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Savings in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC2%202%20hot%20water-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment 0.5 scenario: Savings at peak time-periods for hot water in winter.jpeg&quot;, dpi = 600)</code></pre>
<pre class="r"><code>#Plots cost and benefits of load shifting, does not consider baseline but increases costs at off peaks
EcoVaSumDT &lt;- copy(EcoVaHHDT)


EcoVaSumDT &lt;- EcoVaSumDT[, EcoSummary := ifelse(Period == &quot;Off Peak 1&quot; |
                                               Period == &quot;Off Peak 2&quot;,
                                             (Baseline*1000000) + EcoVaLs, 0)]#It has to be zero 



EcoVaSumDT &lt;- EcoVaSumDT[, `EcoSummary` := `EcoSummary`/1000000]# Converting to million $
EcoVaSumSC3DT &lt;- EcoVaSumDT[, (`EcoSummary` = sum(`EcoSummary`)), keyby = .(Region, season, Period)]

EcoVaSumSC3DT$Period &lt;- factor(EcoVaSumSC3DT$Period, levels = c(&quot;Off Peak 1&quot;,&quot;Morning Peak&quot;,
                                                    &quot;Off Peak 2&quot;, &quot;Evening Peak&quot;))





#Analysis
CostBaseline &lt;- sum(EcoVaSumDT$Baseline)
`CostLoadShif` &lt;- sum(EcoVaSumDT$`EcoSummary`)

SavingsMillionNZD &lt;- CostBaseline - `CostLoadShif`
SavingsPercent &lt;- 1-(`CostLoadShif` / CostBaseline)

SavingsMillionNZD</code></pre>
<pre><code>## [1] 18.91147</code></pre>
<pre class="r"><code>SavingsPercent</code></pre>
<pre><code>## [1] 0.0796412</code></pre>
<pre class="r"><code>myPlot &lt;- ggplot2::ggplot(EcoVaSumSC3DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load shifting scenario: Cost for hot water&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC3%201%20hot%20water-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load shifting scenario: Cost for hot water.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC3DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load shifting scenario: Cost for hot water in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC3%201%20hot%20water-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load shifting scenario: Cost for hot water in winter.jpeg&quot;, dpi = 600)</code></pre>
</div>
</div>
<div id="both-appliances-together-1" class="section level3">
<h3><span class="header-section-number">13.5.4</span> Both appliances together</h3>
<pre class="r"><code>#Defining peak and off-peak for heat pump and hot water seperately
sc3data &lt;- heatPumpProfileDT

sc3data &lt;- sc3data[, .(GWhHP = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

#Defining peak and off-peak periods
sc3data &lt;- sc3data[, Period := &quot;Not Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]




sc32data &lt;- hotWaterProfileDT

sc32data &lt;- sc32data[, .(GWhHW = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

#Defining peak and off-peak periods

sc32data &lt;- sc32data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

#Copying hot water consumption column into heat pump data table
sc3data &lt;- cbind(sc3data, sc32data[,&quot;GWhHW&quot;])

#Building sum of heat pump and hot water consumption
sc3data &lt;- sc3data[, PumpandWater := GWhHP + GWhHW]</code></pre>
<div id="baseline-1" class="section level4">
<h4><span class="header-section-number">13.5.4.1</span> Baseline</h4>
<pre class="r"><code>#Economic evaluation begins
sc3data &lt;- sc3data[, MWh:=PumpandWater*fac1000] # Creating new column MWh


setkey(SeasonAvgDT, season, obsHalfHour)
setkey(sc3data, season, obsHalfHour)

Mergedsc0DT &lt;- sc3data[SeasonAvgDT]

Mergedsc0DT &lt;- Mergedsc0DT[, ecoValueHH := 0]

Mergedsc0DT &lt;- Mergedsc0DT[, MWh := MWh /5]

Mergedsc0DT &lt;- Mergedsc0DT[, ecoValueHH := (MWh * (meanprice)/1000000), 
                           keyby = .(season, Region, obsHalfHour)]

#Change the order in facet_grid()
Mergedsc0DT$season &lt;- factor(Mergedsc0DT$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))

#Visualising
myPlot &lt;- ggplot2::ggplot(Mergedsc0DT, aes(x = obsHalfHour)) +
  geom_point(aes(y=ecoValueHH, color= Region), size=1) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Costs baseline scenario time of day for heat pump and hot water&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;Cost in million NZD&#39;) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),       hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;), 
  hms::as.hms(&quot;20:00:00&quot;))) 
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/calculating%20baseline%20scenario%20SC0%20economic-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Cost baseline scenario time of day.jpeg&quot;, dpi = 600)

#Building season sum by period
#Mergedsc0DT &lt;- Mergedsc0DT[, .(EcoVal = sum(ecoValueHH)),
                  # keyby = .(season, Region, Period)]</code></pre>
</div>
<div id="load-curtailment-to-zero-sc1-6" class="section level4">
<h4><span class="header-section-number">13.5.4.2</span> Load curtailment to zero SC1</h4>
<pre class="r"><code>fac1000 &lt;- 1000 # We need this conversion to display MWh as required by prices per MWh

sc1data &lt;- sc3data#WARNING PREVIOUS SECTION MUST BE EXECUTED TO REPRESENT CORRECT VALUES HERE WARNING



sc1data[, c(&quot;medianW&quot;, &quot;obsHourMin&quot;, &quot;meanW&quot;, &quot;nObs&quot;, &quot;sdW&quot;,
            &quot;scaledMWmethod1&quot;, &quot;EECApmMethod2&quot;):=NULL] #Deleting unnecessary columns</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;medianW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;obsHourMin&#39; then assigning NULL (deleting
## it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;meanW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;nObs&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;sdW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;scaledMWmethod1&#39; then assigning NULL
## (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;EECApmMethod2&#39; then assigning NULL (deleting
## it).</code></pre>
<pre class="r"><code>sc1data &lt;- sc1data[, .(GWhs1 = sum(PumpandWater)), 
                    keyby = .(season, obsHalfHour)]


#Defining peak and off-peak periods
sc1data &lt;- sc1data[, Period := &quot;Not Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]


#Economic evaluation begins
sc1data &lt;- sc1data[, MWh:=GWhs1*fac1000] # Creating new column GWh based on GWhs1 in MWh


setkey(SeasonAvgDT, season, obsHalfHour)
setkey(sc1data, season, obsHalfHour)

Mergedsc1DT &lt;- sc1data[SeasonAvgDT]

Mergedsc1DT &lt;- Mergedsc1DT[, ecoValueHH := 0]

Mergedsc1DT &lt;- Mergedsc1DT[, MWh := MWh / 5]

Mergedsc1DT &lt;- Mergedsc1DT[, ecoValueHH := ifelse(Period == &quot;Morning Peak&quot; | 
                                                  Period == &quot;Evening Peak&quot;,
                                                (`MWh` * (-meanprice)),
                                                (MWh * (meanprice))),
                           keyby = .(season, Region, obsHalfHour)] 


#Change the order in facet_grid()
Mergedsc1DT$season &lt;- factor(Mergedsc1DT$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))

#Visualising
myPlot &lt;- ggplot2::ggplot(Mergedsc1DT, aes(x = obsHalfHour)) +
  geom_point(aes(y=ecoValueHH, color= Region), size=1.5) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Economic value of load curtailment to zero by region&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;Economic value $/MWh&#39;) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;03:00:00&quot;), hms::as.hms(&quot;06:00:00&quot;),
                          hms::as.hms(&quot;09:00:00&quot;), hms::as.hms(&quot;12:00:00&quot;),
                          hms::as.hms(&quot;15:00:00&quot;), hms::as.hms(&quot;18:00:00&quot;), hms::as.hms(&quot;21:00:00&quot;)))
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/setting%20peak%20periods%20to%20zero%20economic%20value%20both%20appliances-1.png" /><!-- --></p>
<pre class="r"><code>#Mergedsc1DT &lt;- Mergedsc1DT[, .(EcoVal = sum(ecoValueHH)),
                   #keyby = .(Region, season, Period)]</code></pre>
</div>
<div id="load-curtailment-of-particular-amount-sc2-4" class="section level4">
<h4><span class="header-section-number">13.5.4.3</span> Load curtailment of particular amount: SC2</h4>
<pre class="r"><code>fac1000 &lt;- 1000 # We need this conversion to display MWh as required by prices per MWh

sc2data &lt;- sc3data#WARNING PREVIOUS TWO CHUNKS MUST BE EXECUTED TO WORK PROPERLY HERE WARNING
sc2data[, c(&quot;medianW&quot;, &quot;obsHourMin&quot;, &quot;meanW&quot;, &quot;nObs&quot;, &quot;sdW&quot;,
            &quot;scaledMWmethod1&quot;, &quot;EECApmMethod2&quot;):=NULL] #Deleting unnecessary columns</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;medianW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;obsHourMin&#39; then assigning NULL (deleting
## it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;meanW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;nObs&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;sdW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;scaledMWmethod1&#39; then assigning NULL
## (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;EECApmMethod2&#39; then assigning NULL (deleting
## it).</code></pre>
<pre class="r"><code>sc2data &lt;- sc2data[, .(GWhs1 = sum(PumpandWater)), 
                    keyby = .(season, obsHalfHour)]


#Defining peak and off-peak periods
sc2data &lt;- sc2data[, Period := &quot;Not Peak&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc1data &lt;- sc2data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

sc2data &lt;- sc2data[, MWh:= ifelse(Period == &quot;Morning Peak&quot; |
                                    Period == &quot;Evening Peak&quot;, GWhs1*1000*0.5, GWhs1*1000)] # Creating new column GWh based on GWhs1 in MWh
sc2data &lt;- sc2data[, MWh:= MWh /5]

setkey(SeasonAvgDT, season, obsHalfHour)

setkey(sc2data, season, obsHalfHour)

Mergedsc2DT &lt;- sc2data[SeasonAvgDT]

Mergedsc2DT &lt;- Mergedsc2DT[, ecoValueHH := 0]

Mergedsc2DT &lt;- Mergedsc2DT[, ecoValueHH := ifelse(Period == &quot;Morning Peak&quot; | 
                                                  Period == &quot;Evening Peak&quot;,
                                                (`MWh` * (-meanprice)),
                                                MWh * (meanprice)),
                           keyby = .(season, Region, obsHalfHour)] 

#Change the order in facet_grid()
Mergedsc2DT$season &lt;- factor(Mergedsc2DT$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))

#Visualising only shifted consumption
myPlot &lt;- ggplot2::ggplot(Mergedsc2DT, aes(x = obsHalfHour)) +
  geom_point(aes(y=ecoValueHH, color= Region), size=1.5) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Economic value of particular amount by region&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;Economic value $/MWh&#39;) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;03:00:00&quot;), hms::as.hms(&quot;06:00:00&quot;),
                          hms::as.hms(&quot;09:00:00&quot;), hms::as.hms(&quot;12:00:00&quot;),
                          hms::as.hms(&quot;15:00:00&quot;), hms::as.hms(&quot;18:00:00&quot;), hms::as.hms(&quot;21:00:00&quot;)))
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20value%20of%20particular%20amount%20both%20appliances-1.png" /><!-- --></p>
<pre class="r"><code>#Mergedsc2DT &lt;- Mergedsc2DT[, .(EcoVal = sum(ecoValueHH)),
                   #keyby = .(Region, season, Period)]</code></pre>
</div>
<div id="load-shifting-to-prior-time-periods-sc3-3" class="section level4">
<h4><span class="header-section-number">13.5.4.4</span> Load shifting to prior time periods: SC3</h4>
<pre class="r"><code>sc3data[, c(&quot;medianW&quot;, &quot;obsHourMin&quot;, &quot;meanW&quot;, &quot;nObs&quot;, &quot;sdW&quot;,
            &quot;scaledMWmethod1&quot;, &quot;EECApmMethod2&quot;):=NULL] #Deleting unnecessary columns</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;medianW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;obsHourMin&#39; then assigning NULL (deleting
## it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;meanW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;nObs&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;sdW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;scaledMWmethod1&#39; then assigning NULL
## (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;EECApmMethod2&#39; then assigning NULL (deleting
## it).</code></pre>
<pre class="r"><code>sc3data &lt;- sc3data[, .(GWhs1 = sum(PumpandWater)), 
                    keyby = .(season, obsHalfHour)]


#Defining peak and off-peak periods
sc3data &lt;- sc3data[, Period := &quot;Not Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

#Building the sum of each peak period by season
AuMP &lt;- sc3data[season == &quot;Autumn&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhs1)]
WiMP &lt;- sc3data[season == &quot;Winter&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhs1)]
SpMP &lt;- sc3data[season == &quot;Spring&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhs1)]
SuMP &lt;- sc3data[season == &quot;Summer&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhs1)]

AuEP &lt;- sc3data[season == &quot;Autumn&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhs1)]
WiEP &lt;- sc3data[season == &quot;Winter&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhs1)]
SpEP &lt;- sc3data[season == &quot;Spring&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhs1)]
SuEP &lt;- sc3data[season == &quot;Summer&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhs1)]


#Counting number of rows that will be associated to spread the Morning Peak
AuMPHalfHours &lt;- nrow(sc3data[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
WiMPHalfHours &lt;- nrow(sc3data[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
SpMPHalfHours &lt;- nrow(sc3data[season == &quot;Spring&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
SuMPHalfHours &lt;- nrow(sc3data[season == &quot;Summer&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])

#Counting number of rows that will be associated to spread the Evening Peak
AuEPHalfHours &lt;- nrow(sc3data[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
WiEPHalfHours &lt;- nrow(sc3data[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
SpEPHalfHours &lt;- nrow(sc3data[season == &quot;Spring&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
SuEPHalfHours &lt;- nrow(sc3data[season == &quot;Summer&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])

#Calculating the proportion that each row will take on to spread the GWhs
distGWhOP1Au &lt;- AuMP/AuMPHalfHours
distGWhOP1Wi &lt;- WiMP/WiMPHalfHours
distGWhOP1Sp &lt;- SpMP/SpMPHalfHours
distGWhOP1Su &lt;- SuMP/SuMPHalfHours

distGWhOP2Au &lt;- AuEP/AuEPHalfHours
distGWhOP2Wi &lt;- WiEP/WiEPHalfHours
distGWhOP2Sp &lt;- SpEP/SpEPHalfHours
distGWhOP2Su &lt;- SuEP/SuEPHalfHours



#Adding amount of spreaded peak consumption to off-peak periods
sc3data &lt;- sc3data[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs3 :=
                     GWhs1 + distGWhOP1Au]
sc3data &lt;- sc3data[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs3 :=
                     GWhs1 + distGWhOP1Wi]
sc3data &lt;- sc3data[season == &quot;Spring&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs3 :=
                     GWhs1 + distGWhOP1Sp]
sc3data &lt;- sc3data[season == &quot;Summer&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs3 :=
                     GWhs1 + distGWhOP1Su]


sc3data &lt;- sc3data[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs3 :=
                     GWhs1 + distGWhOP2Au]
sc3data &lt;- sc3data[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs3 :=
                     GWhs1 + distGWhOP2Wi]
sc3data &lt;- sc3data[season == &quot;Spring&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs3 :=
                     GWhs1 + distGWhOP2Sp]
sc3data &lt;- sc3data[season == &quot;Summer&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs3 :=
                     GWhs1 + distGWhOP2Su]


#Setting missing values in peak periods to NULL
sc3data &lt;- sc3data[, GWhs3:= ifelse(Period ==&quot;Morning Peak&quot;,
                                  0, GWhs3)]
sc3data &lt;- sc3data[, GWhs3:= ifelse(Period ==&quot;Evening Peak&quot;,
                                  0, GWhs3)]
#Economic value starts::

#Creating new column
sc3data &lt;- sc3data[, DiffOrigMWh := 0]
#Calculating the amount added due to load shifting + converting to MWh
sc3data &lt;- sc3data[, DiffOrigMWh := ifelse(GWhs3 &gt; 0,
                                           (GWhs3-GWhs1) * 1000, (0-GWhs1 * 1000))]

sc3data &lt;- sc3data[, DiffOrigMWh := DiffOrigMWh / 5]
                     
#Preparation for merging DTs
setkey(SeasonAvgDT, season, obsHalfHour)
setkey(sc3data, season, obsHalfHour)

#Merging
Mergedsc3DT &lt;- sc3data[SeasonAvgDT]

Mergedsc3DT &lt;- Mergedsc3DT[, ecoValueHH := ifelse(Period == &quot;Morning Peak&quot; | 
                                                  Period == &quot;Evening Peak&quot;,
                                                DiffOrigMWh * (meanprice),
                                                DiffOrigMWh * (meanprice)),
                           keyby = .(season, Region, obsHalfHour)]#WARNING DiffOrigMWh represents distinction between positive and negative already


#Change the order in facet_grid()
Mergedsc3DT$season &lt;- factor(Mergedsc3DT$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))


#Putting all values together and check!
EcoVaHHDT &lt;- copy(Mergedsc0DT)

setnames(EcoVaHHDT, old=c(&quot;ecoValueHH&quot;), new=c(&quot;Baseline&quot;))

EcoVaHHDT &lt;- cbind(EcoVaHHDT, Mergedsc1DT[,&quot;ecoValueHH&quot;])
setnames(EcoVaHHDT, old=c(&quot;ecoValueHH&quot;), new=c(&quot;EcoVaLc@Peak&quot;))

EcoVaHHDT &lt;- cbind(EcoVaHHDT, Mergedsc2DT[,&quot;ecoValueHH&quot;])
setnames(EcoVaHHDT, old=c(&quot;ecoValueHH&quot;), new=c(&quot;EcoVaLc*0.5@Peak&quot;))

EcoVaHHDT &lt;- cbind(EcoVaHHDT, Mergedsc3DT[,&quot;ecoValueHH&quot;])
setnames(EcoVaHHDT, old=c(&quot;ecoValueHH&quot;), new=c(&quot;EcoVaLs&quot;))

EcoVaHHDT &lt;- EcoVaHHDT[, c(&quot;GWhs1&quot;, &quot;MWh&quot;) := NULL]</code></pre>
<pre><code>## Warning in `[.data.table`(EcoVaHHDT, , `:=`(c(&quot;GWhs1&quot;, &quot;MWh&quot;), NULL)):
## Adding new column &#39;GWhs1&#39; then assigning NULL (deleting it).</code></pre>
<pre class="r"><code>EcoVaHHDT &lt;- EcoVaHHDT[, meanprice := meanprice + 0,
                 keyby = .(season, Region, obsHalfHour)]</code></pre>
</div>
<div id="visualisation-both-aplliances" class="section level4">
<h4><span class="header-section-number">13.5.4.5</span> Visualisation both aplliances</h4>
<pre class="r"><code>EcoVaSumDT &lt;- copy(EcoVaHHDT)

EcoVaSumDT &lt;- EcoVaSumDT[, Baseline := Baseline]# Converting to million $
EcoVaSumSC0DT &lt;- EcoVaSumDT[, (Baseline = sum(Baseline)), keyby = .(Region, season, Period)]


EcoVaSumSC0DT$Period &lt;- factor(EcoVaSumSC0DT$Period, levels = c(&quot;Off Peak 1&quot;,&quot;Morning Peak&quot;,
                                                    &quot;Off Peak 2&quot;, &quot;Evening Peak&quot;))

#Analysis
CostBaseline &lt;- sum(EcoVaSumDT$Baseline)

SavingsMillionNZD &lt;- CostBaseline-CostBaseline
SavingsPercent &lt;- 0#Compared to Baseline

SavingsMillionNZD</code></pre>
<pre><code>## [1] 0</code></pre>
<pre class="r"><code>SavingsPercent</code></pre>
<pre><code>## [1] 0</code></pre>
<pre class="r"><code>myPlot &lt;- ggplot2::ggplot(EcoVaSumSC0DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Baseline scenario: Cost for HP &amp; HW&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC0%20both%20appliances-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Baseline scenario: Cost for HP &amp; HW by period.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC0DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Baseline scenario: Cost for HP &amp; HW in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC0%20both%20appliances-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Baseline scenario: Cost for HP &amp; HW in winter by period.jpeg&quot;, dpi = 600)                        </code></pre>
<pre class="r"><code>#Plots cost of load curtailment to zero, does not consider baseline
EcoVaSumDT &lt;- copy(EcoVaHHDT)

EcoVaSumDT &lt;- EcoVaSumDT[, `EcoVaLc@Peak` := ifelse(Period == &quot;Morning Peak&quot; |
                                                      Period == &quot;Evening Peak&quot;, 0,
                                                    `EcoVaLc@Peak`)]
EcoVaSumDT &lt;- EcoVaSumDT[, `EcoVaLc@Peak` := `EcoVaLc@Peak`/1000000]# Converting to million $
EcoVaSumSC1DT &lt;- EcoVaSumDT[, (`EcoVaLc@Peak` = sum(`EcoVaLc@Peak`)), keyby = .(Region, season, Period)]

EcoVaSumSC1DT$Period &lt;- factor(EcoVaSumSC1DT$Period, levels = c(&quot;Off Peak 1&quot;,&quot;Morning Peak&quot;,
                                                    &quot;Off Peak 2&quot;, &quot;Evening Peak&quot;))

#Analysis
CostBaseline &lt;- sum(EcoVaSumDT$Baseline)
`CostEcoVaLc@Peak` &lt;- sum(EcoVaSumDT$`EcoVaLc@Peak`)

SavingsMillionNZD &lt;- CostBaseline - `CostEcoVaLc@Peak`
SavingsPercent &lt;- 1-(`CostEcoVaLc@Peak` / CostBaseline)

SavingsMillionNZD</code></pre>
<pre><code>## [1] 168.6363</code></pre>
<pre class="r"><code>SavingsPercent</code></pre>
<pre><code>## [1] 0.5798358</code></pre>
<pre class="r"><code>#Visualisation
myPlot &lt;- ggplot2::ggplot(EcoVaSumSC1DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment scenario: Cost for HP &amp; HW&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC1%201%20both%20appliances-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment scenario: Cost for HP &amp; HW.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC1DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment scenario: Cost for HP &amp; HW in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC1%201%20both%20appliances-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment scenario: Cost for HP &amp; HW in winter.jpeg&quot;, dpi = 600)</code></pre>
<pre class="r"><code>#Plots benefits when load is curtailed to zero 

EcoVaSumDT &lt;- copy(EcoVaHHDT)

EcoVaSumSC1DT &lt;- EcoVaSumDT
EcoVaSumSC1DT &lt;- EcoVaSumSC1DT[, `EcoVaLc@Peak` := ifelse(Period == &quot;Off Peak 1&quot; |
                                                            Period == &quot;Off Peak 2&quot;, 0,
                                                          `EcoVaLc@Peak`*(-1))]#We want to disply savings
EcoVaSumSC1DT &lt;- EcoVaSumSC1DT[, `EcoVaLc@Peak` := `EcoVaLc@Peak`/1000000]# Converting to million $
EcoVaSumSC1DT &lt;- EcoVaSumSC1DT[, (`EcoVaLc@Peak` = sum(`EcoVaLc@Peak`)), keyby = .(Region, season, Period)]


EcoVaSumSC1DT$Period &lt;- factor(EcoVaSumSC1DT$Period, levels = c(&quot;Off Peak 1&quot;,&quot;Morning Peak&quot;,
                                                    &quot;Off Peak 2&quot;, &quot;Evening Peak&quot;))

myPlot &lt;- ggplot2::ggplot(EcoVaSumSC1DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment scenario: Savings at peak time-periods for HP &amp; HW&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Savings in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC1%202%20both%20appliances-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment scenario: Savings at peak time-periods for HP &amp; HW.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC1DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment scenario: Savings at peak time-periods for HP &amp; HW in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Savings in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC1%202%20both%20appliances-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment scenario: Savings at peak time-periods for HP &amp; HW in winter.jpeg&quot;, dpi = 600)</code></pre>
<pre class="r"><code>#Plots cost and benefits of load curtailment to 0.5, does not consider baseline
EcoVaSumDT &lt;- copy(EcoVaHHDT)

EcoVaSumDT &lt;- EcoVaSumDT[, `EcoVaLc*0.5@Peak` := ifelse(Period == &quot;Morning Peak&quot; |
                                                          Period == &quot;Evening Peak&quot;,
                                              ((Baseline*0.5)*1000000), `EcoVaLc*0.5@Peak`)]

EcoVaSumDT &lt;- EcoVaSumDT[, `EcoVaLc*0.5@Peak` := `EcoVaLc*0.5@Peak`/1000000]# Converting to million $
EcoVaSumSC2DT &lt;- EcoVaSumDT[, (`EcoVaLc*0.5@Peak` = sum(`EcoVaLc*0.5@Peak`)), keyby = .(Region, season, Period)]

EcoVaSumSC2DT$Period &lt;- factor(EcoVaSumSC2DT$Period, levels = c(&quot;Off Peak 1&quot;,
                                                                &quot;Morning Peak&quot;,
                                                                &quot;Off Peak 2&quot;,
                                                                &quot;Evening Peak&quot;))

#Analysis
CostBaseline &lt;- sum(EcoVaSumDT$Baseline)
`CostEcoVaLc*0.5@Peak` &lt;- sum(EcoVaSumDT$`EcoVaLc*0.5@Peak`)

SavingsMillionNZD &lt;- CostBaseline - `CostEcoVaLc*0.5@Peak`
SavingsPercent &lt;- 1-(`CostEcoVaLc*0.5@Peak` / CostBaseline)

SavingsMillionNZD</code></pre>
<pre><code>## [1] 84.31813</code></pre>
<pre class="r"><code>SavingsPercent</code></pre>
<pre><code>## [1] 0.2899179</code></pre>
<pre class="r"><code>myPlot &lt;- ggplot2::ggplot(EcoVaSumSC2DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment 0.5 scenario: Cost for HP &amp; HW&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC2%201%20both%20appliances-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment 0.5 scenario: Cost for HP &amp; HW.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC2DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment 0.5 scenario: Cost for HP &amp; HW in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC2%201%20both%20appliances-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment 0.5 scenario: Cost for HP &amp; HW in winter.jpeg&quot;, dpi = 600)</code></pre>
<pre class="r"><code>#Plots benefits when load is curtailed to 0.5 

EcoVaSumDT &lt;- copy(EcoVaHHDT)

EcoVaSumSC2DT &lt;- EcoVaSumDT
EcoVaSumSC2DT &lt;- EcoVaSumSC2DT[, `EcoVaLc*0.5@Peak` := ifelse(Period == &quot;Off Peak 1&quot;|
                                                            Period == &quot;Off Peak 2&quot;,0,
                                 `EcoVaLc*0.5@Peak`*(-1))]#We want to disply savings


EcoVaSumSC2DT &lt;- EcoVaSumSC2DT[, `EcoVaLc*0.5@Peak` := `EcoVaLc*0.5@Peak`/1000000]# Converting to million $
EcoVaSumSC2DT &lt;- EcoVaSumSC2DT[, (`EcoVaLc*0.5@Peak` = sum(`EcoVaLc*0.5@Peak`)), keyby = .(Region, season, Period)]


EcoVaSumSC2DT$Period &lt;- factor(EcoVaSumSC2DT$Period, levels = c(&quot;Off Peak 1&quot;,&quot;Morning Peak&quot;,
                                                    &quot;Off Peak 2&quot;, &quot;Evening Peak&quot;))

myPlot &lt;- ggplot2::ggplot(EcoVaSumSC2DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment 0.5 scenario: Savings at peak time-periods for HP &amp; HW&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Savings in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC2%202%20both%20appliances-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment 0.5 scenario: Savings at peak time-periods for HP &amp; HW.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC2DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment 0.5 scenario: Savings at peak time-periods for HP &amp; HW in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Savings in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC2%202%20both%20appliances-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment 0.5 scenario: Savings at peak time-periods for HP &amp; HW in winter.jpeg&quot;, dpi = 600)</code></pre>
<pre class="r"><code>#Plots cost and benefits of load shifting, does not consider baseline but increases costs at off peaks
EcoVaSumDT &lt;- copy(EcoVaHHDT)


EcoVaSumDT &lt;- EcoVaSumDT[, EcoSummary := ifelse(Period == &quot;Off Peak 1&quot; |
                                               Period == &quot;Off Peak 2&quot;,
                                             (Baseline*1000000) + EcoVaLs, 0)]#It has to be zero 



EcoVaSumDT &lt;- EcoVaSumDT[, `EcoSummary` := `EcoSummary`/1000000]# Converting to million $
EcoVaSumSC3DT &lt;- EcoVaSumDT[, (`EcoSummary` = sum(`EcoSummary`)), keyby = .(Region, season, Period)]

EcoVaSumSC3DT$Period &lt;- factor(EcoVaSumSC3DT$Period, levels = c(&quot;Off Peak 1&quot;,&quot;Morning Peak&quot;,
                                                    &quot;Off Peak 2&quot;, &quot;Evening Peak&quot;))





#Analysis
CostBaseline &lt;- sum(EcoVaSumDT$Baseline)
`CostLoadShif` &lt;- sum(EcoVaSumDT$`EcoSummary`)

SavingsMillionNZD &lt;- CostBaseline - `CostLoadShif`
SavingsPercent &lt;- 1-(`CostLoadShif` / CostBaseline)

SavingsMillionNZD</code></pre>
<pre><code>## [1] 22.28727</code></pre>
<pre class="r"><code>SavingsPercent</code></pre>
<pre><code>## [1] 0.07663213</code></pre>
<pre class="r"><code>myPlot &lt;- ggplot2::ggplot(EcoVaSumSC3DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load shifting scenario: Cost for HP &amp; HW&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC3%201%20both%20appliances-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load shifting scenario: Cost for HP &amp; HW.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC3DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load shifting scenario: Cost for HP &amp; HW in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC3%201%20both%20appliances-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load shifting scenario: Cost for HP &amp; HW in winter.jpeg&quot;, dpi = 600)</code></pre>
</div>
</div>
<div id="all-three-applainces-togetehr" class="section level3">
<h3><span class="header-section-number">13.5.5</span> All three applainces togetehr</h3>
<pre class="r"><code>#Defining peak and off-peak for heat pump and hot water seperately
sc3data &lt;- heatPumpProfileDT

sc3data &lt;- sc3data[, .(GWhHP = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

#Defining peak and off-peak periods
sc3data &lt;- sc3data[, Period := &quot;Not Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]




sc32data &lt;- hotWaterProfileDT

sc32data &lt;- sc32data[, .(GWhHW = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

#Defining peak and off-peak periods

sc32data &lt;- sc32data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc32data &lt;- sc32data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]





sc5data &lt;- refrigerationProfileDT

sc5data &lt;- sc5data[, .(GWhREF = sum(scaledGWh)), 
                    keyby = .(season, obsHalfHour)]

#Defining peak and off-peak periods

sc5data &lt;- sc5data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc5data &lt;- sc5data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

#Copying hot water consumption column into heat pump data table
sc3data &lt;- cbind(sc3data, sc32data[,&quot;GWhHW&quot;], sc5data[, &quot;GWhREF&quot;])

#Building sum of heat pump and hot water consumption
sc3data &lt;- sc3data[, PumpandWater := GWhHP + GWhHW + GWhREF]</code></pre>
<div id="baseline-2" class="section level4">
<h4><span class="header-section-number">13.5.5.1</span> Baseline</h4>
<pre class="r"><code>#Economic evaluation begins
sc3data &lt;- sc3data[, MWh:=(PumpandWater*fac1000)] # Creating new column MWh


setkey(SeasonAvgDT, season, obsHalfHour)
setkey(sc3data, season, obsHalfHour)

Mergedsc0DT &lt;- sc3data[SeasonAvgDT]

Mergedsc0DT &lt;- Mergedsc0DT[, MWh:= MWh]
Mergedsc0DT &lt;- Mergedsc0DT[, ecoValueHH := 0]
#Mergedsc0DT &lt;- Mergedsc0DT[, avgregion := sum((meanprice)/5),
                          #keyby = .(season, obsHalfHour)]

Mergedsc0DT &lt;- Mergedsc0DT[, MWh := MWh /5]

Mergedsc0DT &lt;- Mergedsc0DT[, ecoValueHH := (MWh * meanprice), 
                           keyby = .(season, obsHalfHour)]

#Change the order in facet_grid()
Mergedsc0DT$season &lt;- factor(Mergedsc0DT$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))







#Visualising
myPlot &lt;- ggplot2::ggplot(subset(Mergedsc0DT, Region %in% c(&quot;Central North Island&quot;)), aes(x = obsHalfHour)) +
  geom_point(aes(y=ecoValueHH), size=1) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Costs baseline scenario time of day for heat pump and hot water&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;Cost in NZD&#39;) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),       hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;), 
  hms::as.hms(&quot;20:00:00&quot;))) 
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/calculating%20baseline%20scenario%20SC0%20economic%20all%20three-1.png" /><!-- --></p>
<pre class="r"><code>ggsave(&quot;ALLTHREE_PerDayCost baseline scenario time of day all three.jpeg&quot;, dpi = 600)</code></pre>
<pre><code>## Saving 7 x 5 in image</code></pre>
<pre class="r"><code>#Building season sum by period
#Mergedsc0DT &lt;- Mergedsc0DT[, .(EcoVal = sum(ecoValueHH)),
                  # keyby = .(season, Region, Period)]</code></pre>
</div>
<div id="load-curtailment-to-zero-sc1-7" class="section level4">
<h4><span class="header-section-number">13.5.5.2</span> Load curtailment to zero SC1</h4>
<pre class="r"><code>fac1000 &lt;- 1000 # We need this conversion to display MWh as required by prices per MWh

sc1data &lt;- sc3data#WARNING PREVIOUS SECTION MUST BE EXECUTED TO REPRESENT CORRECT VALUES HERE WARNING



sc1data[, c(&quot;medianW&quot;, &quot;obsHourMin&quot;, &quot;meanW&quot;, &quot;nObs&quot;, &quot;sdW&quot;,
            &quot;scaledMWmethod1&quot;, &quot;EECApmMethod2&quot;):=NULL] #Deleting unnecessary columns</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;medianW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;obsHourMin&#39; then assigning NULL (deleting
## it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;meanW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;nObs&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;sdW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;scaledMWmethod1&#39; then assigning NULL
## (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc1data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;EECApmMethod2&#39; then assigning NULL (deleting
## it).</code></pre>
<pre class="r"><code>sc1data &lt;- sc1data[, .(GWhs1 = sum(PumpandWater)), 
                    keyby = .(season, obsHalfHour)]


#Defining peak and off-peak periods
sc1data &lt;- sc1data[, Period := &quot;Not Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]


#Economic evaluation begins
sc1data &lt;- sc1data[, MWh:=GWhs1*fac1000] # Creating new column GWh based on GWhs1 in MWh


setkey(SeasonAvgDT, season, obsHalfHour)
setkey(sc1data, season, obsHalfHour)

Mergedsc1DT &lt;- sc1data[SeasonAvgDT]

Mergedsc1DT &lt;- Mergedsc1DT[, ecoValueHH := 0]

Mergedsc1DT &lt;- Mergedsc1DT[, MWh := MWh / 5]

Mergedsc1DT &lt;- Mergedsc1DT[, ecoValueHH := ifelse(Period == &quot;Morning Peak&quot; | 
                                                  Period == &quot;Evening Peak&quot;,
                                                (`MWh` * (-meanprice)),
                                                (MWh * (meanprice))),
                           keyby = .(season, Region, obsHalfHour)] 


#Change the order in facet_grid()
Mergedsc1DT$season &lt;- factor(Mergedsc1DT$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))

#Visualising
myPlot &lt;- ggplot2::ggplot(Mergedsc1DT, aes(x = obsHalfHour)) +
  geom_point(aes(y=ecoValueHH, color= Region), size=1.5) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Economic value of load curtailment to zero by region&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;Economic value $/MWh&#39;) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;03:00:00&quot;), hms::as.hms(&quot;06:00:00&quot;),
                          hms::as.hms(&quot;09:00:00&quot;), hms::as.hms(&quot;12:00:00&quot;),
                          hms::as.hms(&quot;15:00:00&quot;), hms::as.hms(&quot;18:00:00&quot;), hms::as.hms(&quot;21:00:00&quot;)))
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/setting%20peak%20periods%20to%20zero%20economic%20value%20all%20three%20appliances-1.png" /><!-- --></p>
<pre class="r"><code>#Mergedsc1DT &lt;- Mergedsc1DT[, .(EcoVal = sum(ecoValueHH)),
                   #keyby = .(Region, season, Period)]</code></pre>
</div>
<div id="load-curtailment-of-particular-amount-sc2-5" class="section level4">
<h4><span class="header-section-number">13.5.5.3</span> Load curtailment of particular amount: SC2</h4>
<pre class="r"><code>fac1000 &lt;- 1000 # We need this conversion to display MWh as required by prices per MWh

sc2data &lt;- sc3data#WARNING PREVIOUS TWO CHUNKS MUST BE EXECUTED TO WORK PROPERLY HERE WARNING
sc2data[, c(&quot;medianW&quot;, &quot;obsHourMin&quot;, &quot;meanW&quot;, &quot;nObs&quot;, &quot;sdW&quot;,
            &quot;scaledMWmethod1&quot;, &quot;EECApmMethod2&quot;):=NULL] #Deleting unnecessary columns</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;medianW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;obsHourMin&#39; then assigning NULL (deleting
## it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;meanW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;nObs&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;sdW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;scaledMWmethod1&#39; then assigning NULL
## (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc2data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;EECApmMethod2&#39; then assigning NULL (deleting
## it).</code></pre>
<pre class="r"><code>sc2data &lt;- sc2data[, .(GWhs1 = sum(PumpandWater)), 
                    keyby = .(season, obsHalfHour)]


#Defining peak and off-peak periods
sc2data &lt;- sc2data[, Period := &quot;Not Peak&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc1data &lt;- sc2data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc2data &lt;- sc2data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

sc2data &lt;- sc2data[, MWh:= ifelse(Period == &quot;Morning Peak&quot; |
                                    Period == &quot;Evening Peak&quot;, GWhs1*1000*0.5, GWhs1*1000)] # Creating new column GWh based on GWhs1 in MWh
sc2data &lt;- sc2data[, MWh:= MWh /5]

setkey(SeasonAvgDT, season, obsHalfHour)

setkey(sc2data, season, obsHalfHour)

Mergedsc2DT &lt;- sc2data[SeasonAvgDT]

Mergedsc2DT &lt;- Mergedsc2DT[, ecoValueHH := 0]

Mergedsc2DT &lt;- Mergedsc2DT[, ecoValueHH := ifelse(Period == &quot;Morning Peak&quot; | 
                                                  Period == &quot;Evening Peak&quot;,
                                                (`MWh` * (-meanprice)),
                                                MWh * (meanprice)),
                           keyby = .(season, Region, obsHalfHour)] 

#Change the order in facet_grid()
Mergedsc2DT$season &lt;- factor(Mergedsc2DT$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))

#Visualising only shifted consumption
myPlot &lt;- ggplot2::ggplot(Mergedsc2DT, aes(x = obsHalfHour)) +
  geom_point(aes(y=ecoValueHH, color= Region), size=1.5) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Economic value of particular amount by region&quot;) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;Economic value $/MWh&#39;) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;03:00:00&quot;), hms::as.hms(&quot;06:00:00&quot;),
                          hms::as.hms(&quot;09:00:00&quot;), hms::as.hms(&quot;12:00:00&quot;),
                          hms::as.hms(&quot;15:00:00&quot;), hms::as.hms(&quot;18:00:00&quot;), hms::as.hms(&quot;21:00:00&quot;)))
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20value%20of%20particular%20amount%20all%20three%20appliances-1.png" /><!-- --></p>
<pre class="r"><code>#Mergedsc2DT &lt;- Mergedsc2DT[, .(EcoVal = sum(ecoValueHH)),
                   #keyby = .(Region, season, Period)]</code></pre>
</div>
<div id="load-shifting-to-prior-time-periods-sc3-4" class="section level4">
<h4><span class="header-section-number">13.5.5.4</span> Load shifting to prior time periods: SC3</h4>
<pre class="r"><code>sc3data[, c(&quot;medianW&quot;, &quot;obsHourMin&quot;, &quot;meanW&quot;, &quot;nObs&quot;, &quot;sdW&quot;,
            &quot;scaledMWmethod1&quot;, &quot;EECApmMethod2&quot;):=NULL] #Deleting unnecessary columns</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;medianW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;obsHourMin&#39; then assigning NULL (deleting
## it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;meanW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;nObs&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;sdW&#39; then assigning NULL (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;scaledMWmethod1&#39; then assigning NULL
## (deleting it).</code></pre>
<pre><code>## Warning in `[.data.table`(sc3data, , `:=`(c(&quot;medianW&quot;, &quot;obsHourMin&quot;,
## &quot;meanW&quot;, : Adding new column &#39;EECApmMethod2&#39; then assigning NULL (deleting
## it).</code></pre>
<pre class="r"><code>sc3data &lt;- sc3data[, .(GWhs1 = sum(PumpandWater)), 
                    keyby = .(season, obsHalfHour)]


#Defining peak and off-peak periods
sc3data &lt;- sc3data[, Period := &quot;Not Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc3data &lt;- sc3data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

#Building the sum of each peak period by season
AuMP &lt;- sc3data[season == &quot;Autumn&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhs1)]
WiMP &lt;- sc3data[season == &quot;Winter&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhs1)]
SpMP &lt;- sc3data[season == &quot;Spring&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhs1)]
SuMP &lt;- sc3data[season == &quot;Summer&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(GWhs1)]

AuEP &lt;- sc3data[season == &quot;Autumn&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhs1)]
WiEP &lt;- sc3data[season == &quot;Winter&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhs1)]
SpEP &lt;- sc3data[season == &quot;Spring&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhs1)]
SuEP &lt;- sc3data[season == &quot;Summer&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(GWhs1)]


#Counting number of rows that will be associated to spread the Morning Peak
AuMPHalfHours &lt;- nrow(sc3data[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
WiMPHalfHours &lt;- nrow(sc3data[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
SpMPHalfHours &lt;- nrow(sc3data[season == &quot;Spring&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
SuMPHalfHours &lt;- nrow(sc3data[season == &quot;Summer&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])

#Counting number of rows that will be associated to spread the Evening Peak
AuEPHalfHours &lt;- nrow(sc3data[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
WiEPHalfHours &lt;- nrow(sc3data[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
SpEPHalfHours &lt;- nrow(sc3data[season == &quot;Spring&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
SuEPHalfHours &lt;- nrow(sc3data[season == &quot;Summer&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])

#Calculating the proportion that each row will take on to spread the GWhs
distGWhOP1Au &lt;- AuMP/AuMPHalfHours
distGWhOP1Wi &lt;- WiMP/WiMPHalfHours
distGWhOP1Sp &lt;- SpMP/SpMPHalfHours
distGWhOP1Su &lt;- SuMP/SuMPHalfHours

distGWhOP2Au &lt;- AuEP/AuEPHalfHours
distGWhOP2Wi &lt;- WiEP/WiEPHalfHours
distGWhOP2Sp &lt;- SpEP/SpEPHalfHours
distGWhOP2Su &lt;- SuEP/SuEPHalfHours



#Adding amount of spreaded peak consumption to off-peak periods
sc3data &lt;- sc3data[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs3 :=
                     GWhs1 + distGWhOP1Au]
sc3data &lt;- sc3data[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs3 :=
                     GWhs1 + distGWhOP1Wi]
sc3data &lt;- sc3data[season == &quot;Spring&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs3 :=
                     GWhs1 + distGWhOP1Sp]
sc3data &lt;- sc3data[season == &quot;Summer&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs3 :=
                     GWhs1 + distGWhOP1Su]


sc3data &lt;- sc3data[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs3 :=
                     GWhs1 + distGWhOP2Au]
sc3data &lt;- sc3data[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs3 :=
                     GWhs1 + distGWhOP2Wi]
sc3data &lt;- sc3data[season == &quot;Spring&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs3 :=
                     GWhs1 + distGWhOP2Sp]
sc3data &lt;- sc3data[season == &quot;Summer&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs3 :=
                     GWhs1 + distGWhOP2Su]


#Setting missing values in peak periods to NULL
sc3data &lt;- sc3data[, GWhs3:= ifelse(Period ==&quot;Morning Peak&quot;,
                                  0, GWhs3)]
sc3data &lt;- sc3data[, GWhs3:= ifelse(Period ==&quot;Evening Peak&quot;,
                                  0, GWhs3)]
#Economic value starts::

#Creating new column
sc3data &lt;- sc3data[, DiffOrigMWh := 0]
#Calculating the amount added due to load shifting + converting to MWh
sc3data &lt;- sc3data[, DiffOrigMWh := ifelse(GWhs3 &gt; 0,
                                           (GWhs3-GWhs1) * 1000, (0-GWhs1 * 1000))]

sc3data &lt;- sc3data[, DiffOrigMWh := DiffOrigMWh /5]
                     
#Preparation for merging DTs
setkey(SeasonAvgDT, season, obsHalfHour)
setkey(sc3data, season, obsHalfHour)

#Merging
Mergedsc3DT &lt;- sc3data[SeasonAvgDT]

Mergedsc3DT &lt;- Mergedsc3DT[, ecoValueHH := ifelse(Period == &quot;Morning Peak&quot; | 
                                                  Period == &quot;Evening Peak&quot;,
                                                DiffOrigMWh * (meanprice),
                                                DiffOrigMWh * (meanprice)),
                           keyby = .(season, Region, obsHalfHour)]#WARNING DiffOrigMWh represents distinction between positive and negative already


#Change the order in facet_grid()
Mergedsc3DT$season &lt;- factor(Mergedsc3DT$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))


#Putting all values together and check!
EcoVaHHDT &lt;- copy(Mergedsc0DT)

setnames(EcoVaHHDT, old=c(&quot;ecoValueHH&quot;), new=c(&quot;Baseline&quot;))

EcoVaHHDT &lt;- cbind(EcoVaHHDT, Mergedsc1DT[,&quot;ecoValueHH&quot;])
setnames(EcoVaHHDT, old=c(&quot;ecoValueHH&quot;), new=c(&quot;EcoVaLc@Peak&quot;))

EcoVaHHDT &lt;- cbind(EcoVaHHDT, Mergedsc2DT[,&quot;ecoValueHH&quot;])
setnames(EcoVaHHDT, old=c(&quot;ecoValueHH&quot;), new=c(&quot;EcoVaLc*0.5@Peak&quot;))

EcoVaHHDT &lt;- cbind(EcoVaHHDT, Mergedsc3DT[,&quot;ecoValueHH&quot;])
setnames(EcoVaHHDT, old=c(&quot;ecoValueHH&quot;), new=c(&quot;EcoVaLs&quot;))

EcoVaHHDT &lt;- EcoVaHHDT[, c(&quot;GWhs1&quot;, &quot;MWh&quot;) := NULL]</code></pre>
<pre><code>## Warning in `[.data.table`(EcoVaHHDT, , `:=`(c(&quot;GWhs1&quot;, &quot;MWh&quot;), NULL)):
## Adding new column &#39;GWhs1&#39; then assigning NULL (deleting it).</code></pre>
<pre class="r"><code>EcoVaHHDT &lt;- EcoVaHHDT[, meanprice := meanprice + 0,
                 keyby = .(season, Region, obsHalfHour)]</code></pre>
</div>
<div id="visualisation-all-three-aplliances" class="section level4">
<h4><span class="header-section-number">13.5.5.5</span> Visualisation all three aplliances</h4>
<pre class="r"><code>EcoVaSumDT &lt;- copy(EcoVaHHDT)

EcoVaSumDT &lt;- EcoVaSumDT[, Baseline := Baseline]# Converting to million $
EcoVaSumSC0DT &lt;- EcoVaSumDT[, (Baseline = sum(Baseline)), keyby = .(Region, season, Period)]


EcoVaSumSC0DT$Period &lt;- factor(EcoVaSumSC0DT$Period, levels = c(&quot;Off Peak 1&quot;,&quot;Morning Peak&quot;,
                                                    &quot;Off Peak 2&quot;, &quot;Evening Peak&quot;))

#Analysis
CostBaseline &lt;- sum(EcoVaSumDT$Baseline)

SavingsMillionNZD &lt;- CostBaseline-CostBaseline
SavingsPercent &lt;- 0#Compared to Baseline

SavingsMillionNZD</code></pre>
<pre><code>## [1] 0</code></pre>
<pre class="r"><code>SavingsPercent</code></pre>
<pre><code>## [1] 0</code></pre>
<pre class="r"><code>myPlot &lt;- ggplot2::ggplot(EcoVaSumSC0DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Baseline scenario: Cost for HP &amp; HW&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC0%20all%20three%20appliances-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Baseline scenario: Cost for HP &amp; HW by period.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC0DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Baseline scenario: Cost for HP &amp; HW in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC0%20all%20three%20appliances-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Baseline scenario: Cost for HP &amp; HW in winter by period.jpeg&quot;, dpi = 600)                        </code></pre>
<pre class="r"><code>#Plots cost of load curtailment to zero, does not consider baseline
EcoVaSumDT &lt;- copy(EcoVaHHDT)

EcoVaSumDT &lt;- EcoVaSumDT[, `EcoVaLc@Peak` := ifelse(Period == &quot;Morning Peak&quot; |
                                                      Period == &quot;Evening Peak&quot;, 0,
                                                    `EcoVaLc@Peak`)]
EcoVaSumDT &lt;- EcoVaSumDT[, `EcoVaLc@Peak` := `EcoVaLc@Peak`/1000000]# Converting to million $
EcoVaSumSC1DT &lt;- EcoVaSumDT[, (`EcoVaLc@Peak` = sum(`EcoVaLc@Peak`)), keyby = .(Region, season, Period)]

EcoVaSumSC1DT$Period &lt;- factor(EcoVaSumSC1DT$Period, levels = c(&quot;Off Peak 1&quot;,&quot;Morning Peak&quot;,
                                                    &quot;Off Peak 2&quot;, &quot;Evening Peak&quot;))

#Analysis
CostBaseline &lt;- sum(EcoVaSumDT$Baseline)
`CostEcoVaLc@Peak` &lt;- sum(EcoVaSumDT$`EcoVaLc@Peak`)

SavingsMillionNZD &lt;- CostBaseline - `CostEcoVaLc@Peak`
SavingsPercent &lt;- 1-(`CostEcoVaLc@Peak` / CostBaseline)

SavingsMillionNZD</code></pre>
<pre><code>## [1] 427391825</code></pre>
<pre class="r"><code>SavingsPercent</code></pre>
<pre><code>## [1] 1</code></pre>
<pre class="r"><code>#Visualisation
myPlot &lt;- ggplot2::ggplot(EcoVaSumSC1DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment scenario: Cost for HP &amp; HW&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC1%201%20all%20three%20appliances-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment scenario: Cost for HP &amp; HW.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC1DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment scenario: Cost for HP &amp; HW in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC1%201%20all%20three%20appliances-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment scenario: Cost for HP &amp; HW in winter.jpeg&quot;, dpi = 600)</code></pre>
<pre class="r"><code>#Plots benefits when load is curtailed to zero 

EcoVaSumDT &lt;- copy(EcoVaHHDT)

EcoVaSumSC1DT &lt;- EcoVaSumDT
EcoVaSumSC1DT &lt;- EcoVaSumSC1DT[, `EcoVaLc@Peak` := ifelse(Period == &quot;Off Peak 1&quot; |
                                                            Period == &quot;Off Peak 2&quot;, 0,
                                                          `EcoVaLc@Peak`*(-1))]#We want to disply savings
EcoVaSumSC1DT &lt;- EcoVaSumSC1DT[, `EcoVaLc@Peak` := `EcoVaLc@Peak`/1000000]# Converting to million $
EcoVaSumSC1DT &lt;- EcoVaSumSC1DT[, (`EcoVaLc@Peak` = sum(`EcoVaLc@Peak`)), keyby = .(Region, season, Period)]


EcoVaSumSC1DT$Period &lt;- factor(EcoVaSumSC1DT$Period, levels = c(&quot;Off Peak 1&quot;,&quot;Morning Peak&quot;,
                                                    &quot;Off Peak 2&quot;, &quot;Evening Peak&quot;))

myPlot &lt;- ggplot2::ggplot(EcoVaSumSC1DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment scenario: Savings at peak time-periods for HP &amp; HW&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Savings in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC1%202%20all%20three%20appliances-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment scenario: Savings at peak time-periods for HP &amp; HW.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC1DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment scenario: Savings at peak time-periods for HP &amp; HW in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Savings in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC1%202%20all%20three%20appliances-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment scenario: Savings at peak time-periods for HP &amp; HW in winter.jpeg&quot;, dpi = 600)</code></pre>
<pre class="r"><code>#Plots cost and benefits of load curtailment to 0.5, does not consider baseline
EcoVaSumDT &lt;- copy(EcoVaHHDT)

EcoVaSumDT &lt;- EcoVaSumDT[, `EcoVaLc*0.5@Peak` := ifelse(Period == &quot;Morning Peak&quot; |
                                                          Period == &quot;Evening Peak&quot;,
                                              ((Baseline*0.5)*1000000), `EcoVaLc*0.5@Peak`)]

EcoVaSumDT &lt;- EcoVaSumDT[, `EcoVaLc*0.5@Peak` := `EcoVaLc*0.5@Peak`/1000000]# Converting to million $
EcoVaSumSC2DT &lt;- EcoVaSumDT[, (`EcoVaLc*0.5@Peak` = sum(`EcoVaLc*0.5@Peak`)), keyby = .(Region, season, Period)]

EcoVaSumSC2DT$Period &lt;- factor(EcoVaSumSC2DT$Period, levels = c(&quot;Off Peak 1&quot;,
                                                                &quot;Morning Peak&quot;,
                                                                &quot;Off Peak 2&quot;,
                                                                &quot;Evening Peak&quot;))

#Analysis
CostBaseline &lt;- sum(EcoVaSumDT$Baseline)
`CostEcoVaLc*0.5@Peak` &lt;- sum(EcoVaSumDT$`EcoVaLc*0.5@Peak`)

SavingsMillionNZD &lt;- CostBaseline - `CostEcoVaLc*0.5@Peak`
SavingsPercent &lt;- 1-(`CostEcoVaLc*0.5@Peak` / CostBaseline)

SavingsMillionNZD</code></pre>
<pre><code>## [1] 314971383</code></pre>
<pre class="r"><code>SavingsPercent</code></pre>
<pre><code>## [1] 0.7369617</code></pre>
<pre class="r"><code>myPlot &lt;- ggplot2::ggplot(EcoVaSumSC2DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment 0.5 scenario: Cost for HP &amp; HW&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC2%201%20all%20three%20appliances-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment 0.5 scenario: Cost for HP &amp; HW.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC2DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment 0.5 scenario: Cost for HP &amp; HW in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC2%201%20all%20three%20appliances-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment 0.5 scenario: Cost for HP &amp; HW in winter.jpeg&quot;, dpi = 600)</code></pre>
<pre class="r"><code>#Plots benefits when load is curtailed to 0.5 

EcoVaSumDT &lt;- copy(EcoVaHHDT)

EcoVaSumSC2DT &lt;- EcoVaSumDT
EcoVaSumSC2DT &lt;- EcoVaSumSC2DT[, `EcoVaLc*0.5@Peak` := ifelse(Period == &quot;Off Peak 1&quot;|
                                                            Period == &quot;Off Peak 2&quot;,0,
                                 `EcoVaLc*0.5@Peak`*(-1))]#We want to disply savings


EcoVaSumSC2DT &lt;- EcoVaSumSC2DT[, `EcoVaLc*0.5@Peak` := `EcoVaLc*0.5@Peak`/1000000]# Converting to million $
EcoVaSumSC2DT &lt;- EcoVaSumSC2DT[, (`EcoVaLc*0.5@Peak` = sum(`EcoVaLc*0.5@Peak`)), keyby = .(Region, season, Period)]


EcoVaSumSC2DT$Period &lt;- factor(EcoVaSumSC2DT$Period, levels = c(&quot;Off Peak 1&quot;,&quot;Morning Peak&quot;,
                                                    &quot;Off Peak 2&quot;, &quot;Evening Peak&quot;))

myPlot &lt;- ggplot2::ggplot(EcoVaSumSC2DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment 0.5 scenario: Savings at peak time-periods for HP &amp; HW&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Savings in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC2%202%20all%20three%20appliances-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment 0.5 scenario: Savings at peak time-periods for HP &amp; HW.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC2DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load curtailment 0.5 scenario: Savings at peak time-periods for HP &amp; HW in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Savings in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC2%202%20all%20three%20appliances-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;Load curtailment 0.5 scenario: Savings at peak time-periods for HP &amp; HW in winter.jpeg&quot;, dpi = 600)</code></pre>
<pre class="r"><code>#Plots cost and benefits of load shifting, does not consider baseline but increases costs at off peaks
EcoVaSumDT &lt;- copy(EcoVaHHDT)


EcoVaSumDT &lt;- EcoVaSumDT[, EcoSummary := ifelse(Period == &quot;Off Peak 1&quot; |
                                               Period == &quot;Off Peak 2&quot;,
                                             (Baseline*1000000) + EcoVaLs, 0)]#It has to be zero 



EcoVaSumDT &lt;- EcoVaSumDT[, `EcoSummary` := `EcoSummary`/1000000]# Converting to million $
EcoVaSumSC3DT &lt;- EcoVaSumDT[, (`EcoSummary` = sum(`EcoSummary`)), keyby = .(Region, season, Period)]

EcoVaSumSC3DT$Period &lt;- factor(EcoVaSumSC3DT$Period, levels = c(&quot;Off Peak 1&quot;,&quot;Morning Peak&quot;,
                                                    &quot;Off Peak 2&quot;, &quot;Evening Peak&quot;))





#Analysis
CostBaseline &lt;- sum(EcoVaSumDT$Baseline)
`CostLoadShif` &lt;- sum(EcoVaSumDT$`EcoSummary`)

SavingsMillionNZD &lt;- CostBaseline - `CostLoadShif`
SavingsPercent &lt;- 1-(`CostLoadShif` / CostBaseline)

SavingsMillionNZD</code></pre>
<pre><code>## [1] 224840761</code></pre>
<pre class="r"><code>SavingsPercent</code></pre>
<pre><code>## [1] 0.5260764</code></pre>
<pre class="r"><code>myPlot &lt;- ggplot2::ggplot(EcoVaSumSC3DT, aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load shifting scenario: Cost for HP &amp; HW&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot </code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC3%201%20all%20three%20appliances-1.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;ALLTHREE_Seasonal_Load shifting scenario: Cost for HP &amp; HW.jpeg&quot;, dpi = 600)

myPlot &lt;- ggplot2::ggplot(subset(EcoVaSumSC3DT,
                                 season %in% c(&quot;Winter&quot;)), aes(x = Period, fill = Region)) +
  geom_bar(aes(y= V1), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  #geom_line(aes(y= V1)) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  facet_grid(season ~ .) +
  ggtitle(&quot;Load shifting scenario: Cost for HP &amp; HW in winter&quot;) +
  labs(x=&#39;Period&#39;, y=&#39;Cost in million NZD&#39;) 
  
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/economic%20visualisation%20SC3%201%20all%20three%20appliances-2.png" /><!-- --></p>
<pre class="r"><code>#ggsave(&quot;ALLTHREE_Seasonal_Load shifting scenario: Cost for HP &amp; HW in winter.jpeg&quot;, dpi = 600)</code></pre>
</div>
</div>
<div id="cpd-analysis" class="section level3">
<h3><span class="header-section-number">13.5.6</span> CPD analysis</h3>
<pre class="r"><code>#Hot water
#Loading data
CpdMinOrig12  &lt;- read.csv(&quot;/Volumes/hum-csafe/Research Projects/GREEN Grid/externalData/Aurora_CPD/Edited_2012.csv&quot;)
CpdMinOrig13  &lt;- read.csv(&quot;/Volumes/hum-csafe/Research Projects/GREEN Grid/externalData/Aurora_CPD/Edited_2013.csv&quot;)
CpdMinOrig14  &lt;-read.csv(&quot;/Volumes/hum-csafe/Research Projects/GREEN Grid/externalData/Aurora_CPD/Edited_2014.csv&quot;)
CpdMinOrig15  &lt;- read.csv(&quot;/Volumes/hum-csafe/Research Projects/GREEN Grid/externalData/Aurora_CPD/Edited_2015.csv&quot;)
CpdMinOrig16  &lt;- read.csv(&quot;/Volumes/hum-csafe/Research Projects/GREEN Grid/externalData/Aurora_CPD/Edited_2016.csv&quot;)


#Binding data
CpdMinAll &lt;- rbind(CpdMinOrig12, CpdMinOrig13, CpdMinOrig14, CpdMinOrig15, CpdMinOrig16)


#Time and month adjustments
CpdMinAll &lt;- data.table::as.data.table(CpdMinAll)
CpdMinAll &lt;- CpdMinAll[, dateTime := lubridate::dmy_hm(DateTime, tz = &quot;Pacific/Auckland&quot;)]
CpdMinAll &lt;- CpdMinAll[, year := lubridate::year(dateTime)]
CpdMinAll &lt;- CpdMinAll[, obsHalfHour := hms::as.hms(dateTime)]
CpdMinAll &lt;- CpdMinAll[, month := lubridate::month(dateTime)]
CpdMinAll &lt;- CpdMinAll[month &gt;= 5 &amp; month &lt;= 5, season := &quot;Autumn&quot;]
CpdMinAll &lt;- CpdMinAll[month == 6 | month == 7 | month == 8, season := &quot;Winter&quot;]


#Loading and scaling hot water load
HWprofileDT &lt;- hotWaterProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HWprofileDT &lt;- HWprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HWprofileDT &lt;- HWprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHHhotWater)/90]#kW per household and half hour for the whole 90 day season

#Calculating Probability
CpdSumDT &lt;- CpdMinAll[, .(SumMins = sum(CPDmin)/5), keyby = .(season, obsHalfHour)]
CpdSumDT &lt;- CpdSumDT[, totalMins := sum(SumMins)]
                          

CpdSumDT &lt;- CpdSumDT[, Probability := SumMins / totalMins]

#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(HWprofileDT, season, obsHalfHour)
CpdMergedHWDT &lt;- HWprofileDT[CpdSumDT]

#Calculating average kW at congestion periods per household
CpdMergedHWDT &lt;- CpdMergedHWDT[, AvgDemCPD := kWperHh * Probability]
AvgHWCpdDem &lt;- sum(CpdMergedHWDT$AvgDemCPD)

#Introducing prices #Using Frankton GXP of Aurora CPD pricing (lowest charges)
PS1 &lt;- 0.3079
PS2 &lt;- 0.3387
PS3 &lt;- 0.3616
PS4 &lt;- 0.4698

#Adding prices to DT
CpdSumDT &lt;- CpdSumDT[, PS1 := PS1]
CpdSumDT &lt;- CpdSumDT[, PS2 := PS2]
CpdSumDT &lt;- CpdSumDT[, PS3 := PS3]
CpdSumDT &lt;- CpdSumDT[, PS4 := PS4]

#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(CpdMergedHWDT, season, obsHalfHour)
CpdMergedHWDT &lt;- CpdMergedHWDT[CpdSumDT]

#Claculating annual charges hot water for one household
sumPS1HW &lt;- AvgHWCpdDem * PS1 * 365
sumPS2HW &lt;- AvgHWCpdDem * PS2 * 365
sumPS3HW &lt;- AvgHWCpdDem * PS3 * 365
sumPS4HW &lt;- AvgHWCpdDem * PS4 * 365


#Visualising CPD by season
  myPlot &lt;- ggplot2::ggplot(CpdSumDT, aes(x = obsHalfHour)) +
  geom_line(aes(y=Probability, colour = season), size=1) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Probability of congestion time-periods by season&quot;) +
  labs(x=&#39;Time of Day&#39;, y=&#39;Probability&#39;) +
  facet_grid(season ~ .) +
 # scale_y_continuous(breaks = c(20, 40, 60, 80)) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;),hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),
                          hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;), hms::as.hms(&quot;20:00:00&quot;)))

  
  myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/CPD%20analysis-1.png" /><!-- --></p>
<pre class="r"><code> #ggsave(&quot;Probability of congestion time-periods by season.jpeg&quot;, dpi = 600)


  
  
  
  
  
  #Heat pump
  #Loading and scaling hot water load
HPprofileDT &lt;- heatPumpProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HPprofileDT &lt;- HPprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HPprofileDT &lt;- HPprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHHheatPumps)/90]#kW per household and half hour for the whole 90 day season

#Calculating Probability
CpdSumDT &lt;- CpdMinAll[, .(SumMins = sum(CPDmin)/5), keyby = .(season, obsHalfHour)]
CpdSumDT &lt;- CpdSumDT[, totalMins := sum(SumMins)]
                          

CpdSumDT &lt;- CpdSumDT[, Probability := SumMins / totalMins]

#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(HPprofileDT, season, obsHalfHour)
CpdMergedHPDT &lt;- HPprofileDT[CpdSumDT]

#Calculating average kW at congestion periods per household
CpdMergedHPDT &lt;- CpdMergedHPDT[, AvgDemCPD := kWperHh * Probability]
AvgHPCpdDem &lt;- sum(CpdMergedHPDT$AvgDemCPD)
  

#Claculating annual charges hot water for one household
sumPS1HP &lt;- AvgHPCpdDem * PS1 * 365
sumPS2HP &lt;- AvgHPCpdDem * PS2 * 365
sumPS3HP &lt;- AvgHPCpdDem * PS3 * 365
sumPS4HP &lt;- AvgHPCpdDem * PS4 * 365




#Refrigeration
#Loading and scaling hot refrigeration load
REFprofileDT &lt;- refrigerationProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
REFprofileDT &lt;- REFprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
REFprofileDT &lt;- REFprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000))/nzHouseholds/90]#kW per household and half hour for the whole 90 day season

#Calculating Probability
CpdSumDT &lt;- CpdMinAll[, .(SumMins = sum(CPDmin)/5), keyby = .(season, obsHalfHour)]
CpdSumDT &lt;- CpdSumDT[, totalMins := sum(SumMins)]
                          

CpdSumDT &lt;- CpdSumDT[, Probability := SumMins / totalMins]

#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(REFprofileDT, season, obsHalfHour)
CpdMergedREFDT &lt;- REFprofileDT[CpdSumDT]

#Calculating average kW at congestion periods per household
CpdMergedREFDT &lt;- CpdMergedREFDT[, AvgDemCPD := kWperHh * Probability]
AvgREFCpdDem &lt;- sum(CpdMergedREFDT$AvgDemCPD)
  

#Claculating annual charges hot water for one household
sumPS1REF &lt;- AvgREFCpdDem * PS1 * 365
sumPS2REF &lt;- AvgREFCpdDem * PS2 * 365
sumPS3REF &lt;- AvgREFCpdDem * PS3 * 365
sumPS4REF &lt;- AvgREFCpdDem * PS4 * 365



#ALl three appliances together

HPprofileDT &lt;- heatPumpProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HPprofileDT &lt;- HPprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HPprofileDT &lt;- HPprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHHheatPumps)/90]#kW per household and half hour for the whole 90 day season

HWprofileDT &lt;- hotWaterProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HWprofileDT &lt;- HWprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HWprofileDT &lt;- HWprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHHhotWater)/90]#kW per household and half hour for the whole 90 day season


#Loading and scaling hot refrigeration load
REFprofileDT &lt;- refrigerationProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
REFprofileDT &lt;- REFprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
REFprofileDT &lt;- REFprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHouseholds)/90]#kW per household and half hour for the whole 90 day season





HPHWREFprofileDT &lt;- copy(HWprofileDT)
HPHWREFprofileDT &lt;- HPHWREFprofileDT[, kWperHhSum := kWperHh + (HPprofileDT$kWperHh) +
                                       (REFprofileDT$kWperHh)]

#Calculating Probability
CpdSumDT &lt;- CpdMinAll[, .(SumMins = sum(CPDmin)/5), keyby = .(season, obsHalfHour)]
CpdSumDT &lt;- CpdSumDT[, totalMins := sum(SumMins)]
                          

CpdSumDT &lt;- CpdSumDT[, Probability := SumMins / totalMins]

#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(HPHWREFprofileDT, season, obsHalfHour)
CpdMergedHPHWREFDT &lt;- HPHWREFprofileDT[CpdSumDT]

#Calculating average kW at congestion periods per household
CpdMergedHPHWREFDT &lt;- CpdMergedHPHWREFDT[, AvgDemCPD := kWperHhSum * Probability]
AvgHPHWREFCpdDem &lt;- sum(CpdMergedHPHWREFDT$AvgDemCPD)
  

#Claculating annual charges hot water for one household
sumPS1HPHWREF &lt;- AvgHPHWREFCpdDem * PS1 * 365
sumPS2HPHWREF &lt;- AvgHPHWREFCpdDem * PS2 * 365
sumPS3HPHWREF &lt;- AvgHPHWREFCpdDem * PS3 * 365
sumPS4HPHWREF &lt;- AvgHPHWREFCpdDem * PS4 * 365








#Both appliances together

HPprofileDT &lt;- heatPumpProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HPprofileDT &lt;- HPprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HPprofileDT &lt;- HPprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHHheatPumps)/90]#kW per household and half hour for the whole 90 day season

HWprofileDT &lt;- hotWaterProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HWprofileDT &lt;- HWprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HWprofileDT &lt;- HWprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHHhotWater)/90]#kW per household and half hour for the whole 90 day season

HPHWprofileDT &lt;- copy(HWprofileDT)
HPHWprofileDT &lt;- HPHWprofileDT[, kWperHhSum := kWperHh + (HPprofileDT$kWperHh)]

#Calculating Probability
CpdSumDT &lt;- CpdMinAll[, .(SumMins = sum(CPDmin)/5), keyby = .(season, obsHalfHour)]
CpdSumDT &lt;- CpdSumDT[, totalMins := sum(SumMins)]
                          

CpdSumDT &lt;- CpdSumDT[, Probability := SumMins / totalMins]

#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(HPHWprofileDT, season, obsHalfHour)
CpdMergedHPHWDT &lt;- HPHWprofileDT[CpdSumDT]

#Calculating average kW at congestion periods per household
CpdMergedHPHWDT &lt;- CpdMergedHPHWDT[, AvgDemCPD := kWperHhSum * Probability]
AvgHPHWCpdDem &lt;- sum(CpdMergedHPHWDT$AvgDemCPD)
  

#Claculating annual charges hot water for one household
sumPS1HPHW &lt;- AvgHPHWCpdDem * PS1 * 365
sumPS2HPHW &lt;- AvgHPHWCpdDem * PS2 * 365
sumPS3HPHW &lt;- AvgHPHWCpdDem * PS3 * 365
sumPS4HPHW &lt;- AvgHPHWCpdDem * PS4 * 365


#------------------------------------------------------------------------------

#Total New Zealand number: Must be run seperately to the previous one. Same variable names in results


#Hot water
#Loading data
CpdMinOrig12  &lt;- read.csv(&quot;/Volumes/hum-csafe/Research Projects/GREEN Grid/externalData/Aurora_CPD/Edited_2012.csv&quot;)
CpdMinOrig13  &lt;- read.csv(&quot;/Volumes/hum-csafe/Research Projects/GREEN Grid/externalData/Aurora_CPD/Edited_2013.csv&quot;)
CpdMinOrig14  &lt;-read.csv(&quot;/Volumes/hum-csafe/Research Projects/GREEN Grid/externalData/Aurora_CPD/Edited_2014.csv&quot;)
CpdMinOrig15  &lt;- read.csv(&quot;/Volumes/hum-csafe/Research Projects/GREEN Grid/externalData/Aurora_CPD/Edited_2015.csv&quot;)
CpdMinOrig16  &lt;- read.csv(&quot;/Volumes/hum-csafe/Research Projects/GREEN Grid/externalData/Aurora_CPD/Edited_2016.csv&quot;)


#Binding data
CpdMinAll &lt;- rbind(CpdMinOrig12, CpdMinOrig13, CpdMinOrig14, CpdMinOrig15, CpdMinOrig16)


#Time and month adjustments
CpdMinAll &lt;- data.table::as.data.table(CpdMinAll)
CpdMinAll &lt;- CpdMinAll[, dateTime := lubridate::dmy_hm(DateTime, tz = &quot;Pacific/Auckland&quot;)]
CpdMinAll &lt;- CpdMinAll[, year := lubridate::year(dateTime)]
CpdMinAll &lt;- CpdMinAll[, obsHalfHour := hms::as.hms(dateTime)]
CpdMinAll &lt;- CpdMinAll[, month := lubridate::month(dateTime)]
CpdMinAll &lt;- CpdMinAll[month &gt;= 5 &amp; month &lt;= 5, season := &quot;Autumn&quot;]
CpdMinAll &lt;- CpdMinAll[month == 6 | month == 7 | month == 8, season := &quot;Winter&quot;]


#Loading and scaling hot water load
HWprofileDT &lt;- hotWaterProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HWprofileDT &lt;- HWprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HWprofileDT &lt;- HWprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000))/90]#kW per household and half hour for the whole 90 day season

#Calculating Probability
CpdSumDT &lt;- CpdMinAll[, .(SumMins = sum(CPDmin)/5), keyby = .(season, obsHalfHour)]
CpdSumDT &lt;- CpdSumDT[, totalMins := sum(SumMins)]
                          

CpdSumDT &lt;- CpdSumDT[, Probability := SumMins / totalMins]

#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(HWprofileDT, season, obsHalfHour)
CpdMergedHWDT &lt;- HWprofileDT[CpdSumDT]

#Calculating average kW at congestion periods per household
CpdMergedHWDT &lt;- CpdMergedHWDT[, AvgDemCPD := kWperHh * Probability]
AvgHWCpdDem &lt;- sum(CpdMergedHWDT$AvgDemCPD)

#Introducing prices
PS1 &lt;- 0.3079
PS2 &lt;- 0.3387
PS3 &lt;- 0.3616
PS4 &lt;- 0.4698

#Adding prices to DT
CpdSumDT &lt;- CpdSumDT[, PS1 := PS1]
CpdSumDT &lt;- CpdSumDT[, PS2 := PS2]
CpdSumDT &lt;- CpdSumDT[, PS3 := PS3]
CpdSumDT &lt;- CpdSumDT[, PS4 := PS4]

#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(CpdMergedHWDT, season, obsHalfHour)
CpdMergedHWDT &lt;- CpdMergedHWDT[CpdSumDT]

#Claculating annual charges hot water for one household
sumPS1HW &lt;- AvgHWCpdDem * PS1 * 365/1000000
sumPS2HW &lt;- AvgHWCpdDem * PS2 * 365/1000000
sumPS3HW &lt;- AvgHWCpdDem * PS3 * 365/1000000
sumPS4HW &lt;- AvgHWCpdDem * PS4 * 365/1000000



  
  
  
  
  
  #Heat pump
  #Loading and scaling hot water load
HPprofileDT &lt;- heatPumpProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HPprofileDT &lt;- HPprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HPprofileDT &lt;- HPprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000))/90]#kW per household and half hour for the whole 90 day season

#Calculating Probability
CpdSumDT &lt;- CpdMinAll[, .(SumMins = sum(CPDmin)/5), keyby = .(season, obsHalfHour)]
CpdSumDT &lt;- CpdSumDT[, totalMins := sum(SumMins)]
                          

CpdSumDT &lt;- CpdSumDT[, Probability := SumMins / totalMins]

#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(HPprofileDT, season, obsHalfHour)
CpdMergedHPDT &lt;- HPprofileDT[CpdSumDT]

#Calculating average kW at congestion periods per household
CpdMergedHPDT &lt;- CpdMergedHPDT[, AvgDemCPD := kWperHh * Probability]
AvgHPCpdDem &lt;- sum(CpdMergedHPDT$AvgDemCPD)
  

#Claculating annual charges hot water for one household
sumPS1HP &lt;- AvgHPCpdDem * PS1 * 365/1000000
sumPS2HP &lt;- AvgHPCpdDem * PS2 * 365/1000000
sumPS3HP &lt;- AvgHPCpdDem * PS3 * 365/1000000
sumPS4HP &lt;- AvgHPCpdDem * PS4 * 365/1000000






#Both appliances together

HPprofileDT &lt;- heatPumpProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HPprofileDT &lt;- HPprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HPprofileDT &lt;- HPprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000))/90]#kW per household and half hour for the whole 90 day season

HWprofileDT &lt;- hotWaterProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HWprofileDT &lt;- HWprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HWprofileDT &lt;- HWprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000))/90]#kW per household and half hour for the whole 90 day season

HPHWprofileDT &lt;- copy(HWprofileDT)
HPHWprofileDT &lt;- HPHWprofileDT[, kWperHhSum := kWperHh + (HPprofileDT$kWperHh)]

#Calculating Probability
CpdSumDT &lt;- CpdMinAll[, .(SumMins = sum(CPDmin)/5), keyby = .(season, obsHalfHour)]
CpdSumDT &lt;- CpdSumDT[, totalMins := sum(SumMins)]
                          

CpdSumDT &lt;- CpdSumDT[, Probability := SumMins / totalMins]

#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(HPHWprofileDT, season, obsHalfHour)
CpdMergedHPHWDT &lt;- HPHWprofileDT[CpdSumDT]

#Calculating average kW at congestion periods per household
CpdMergedHPHWDT &lt;- CpdMergedHPHWDT[, AvgDemCPD := kWperHhSum * Probability]
AvgHPHWCpdDem &lt;- sum(CpdMergedHPHWDT$AvgDemCPD)
  

#Claculating annual charges hot water for one household
sumPS1HPHW &lt;- AvgHPHWCpdDem * PS1 * 365/1000000
sumPS2HPHW &lt;- AvgHPHWCpdDem * PS2 * 365/1000000
sumPS3HPHW &lt;- AvgHPHWCpdDem * PS3 * 365/1000000
sumPS4HPHW &lt;- AvgHPHWCpdDem * PS4 * 365/1000000



#Further visualisation

 CPDVisual &lt;- copy(CpdSumDT)
 CPDVisual &lt;- CPDVisual[, SumMins := (SumMins)/60]
 
 #Visualising CPD by season
  myPlot &lt;- ggplot2::ggplot(CPDVisual, aes(x = obsHalfHour, fill = season)) +
  geom_bar(aes(y=SumMins), stat = &quot;identity&quot;, position = &quot;dodge&quot;) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Sum of average amount of congestion time-periods by season&quot;) + 
  #How many hours per half hour during 2012-2016 average
  labs(x=&#39;Time of Day&#39;, y=&#39;Hours &#39;) +
  facet_grid(season ~ .) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;),hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),
                          hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;), hms::as.hms(&quot;20:00:00&quot;)))

  
  myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/CPD%20analysis-2.png" /><!-- --></p>
<pre class="r"><code>  #ggsave(&quot;Sum of average amount of congestion time-periods by season.jpeg&quot;, dpi = 600)
  
 CPDVisual &lt;- copy(CpdSumDT)
 CPDVisual &lt;- CPDVisual[, SumHours := ifelse(season == &quot;Autumn&quot; |
                                                  season == &quot;Winter&quot;, sum(SumMins)/60,0),
                        keyby = .(season)]
 CPDVisual$SumHours</code></pre>
<pre><code>##  [1] 14.274 14.274 14.274 14.274 14.274 14.274 14.274 14.274 14.274 14.274
## [11] 14.274 14.274 14.274 14.274 14.274 14.274 14.274 14.274 14.274 14.274
## [21] 14.274 14.274 14.274 14.274 14.274 14.274 14.274 14.274 14.274 14.274
## [31] 14.274 14.274 14.274 14.274 14.274 14.274 14.274 14.274 14.274 14.274
## [41] 14.274 14.274 14.274 14.274 14.274 14.274 14.274 14.274 82.718 82.718
## [51] 82.718 82.718 82.718 82.718 82.718 82.718 82.718 82.718 82.718 82.718
## [61] 82.718 82.718 82.718 82.718 82.718 82.718 82.718 82.718 82.718 82.718
## [71] 82.718 82.718 82.718 82.718 82.718 82.718 82.718 82.718 82.718 82.718
## [81] 82.718 82.718 82.718 82.718 82.718 82.718 82.718 82.718 82.718 82.718
## [91] 82.718 82.718 82.718 82.718 82.718 82.718</code></pre>
<pre class="r"><code>#Heat Pump

#SC1 per household

 #Heat pump
  #Loading and scaling hot water load
HPprofileDT &lt;- heatPumpProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HPprofileDT &lt;- HPprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HPprofileDT &lt;- HPprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000))/nzHHheatPumps/90]#kW per household and half hour for the whole 90 day season

#Calculating Probability
CpdSumDT &lt;- CpdMinAll[, .(SumMins = sum(CPDmin)/5), keyby = .(season, obsHalfHour)]
CpdSumDT &lt;- CpdSumDT[, totalMins := sum(SumMins)]
                          

CpdSumDT &lt;- CpdSumDT[, Probability := SumMins / totalMins]

#Calculating average kW at congestion periods per household
HPprofileDT &lt;- HPprofileDT[, Period := &quot;Not Peak&quot;]

HPprofileDT &lt;- HPprofileDT[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

HPprofileDT &lt;- HPprofileDT[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

HPprofileDT &lt;- HPprofileDT[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

HPprofileDT &lt;- HPprofileDT[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

HPprofileDT &lt;- HPprofileDT[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]
HPprofileDT &lt;- HPprofileDT[, kWperHhSC1 := ifelse(Period == &quot;Morning Peak&quot; | Period == &quot;Evening Peak&quot;,
                                             kWperHh*0, kWperHh)]
#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(HPprofileDT, season, obsHalfHour)

CpdMergedHPDT &lt;- HPprofileDT[CpdSumDT]
CpdMergedHPDT &lt;- CpdMergedHPDT[, AvgDemCPD := kWperHhSC1 * Probability]
AvgHPCpdDemSC1 &lt;- sum(CpdMergedHPDT$AvgDemCPD)



#Claculating annual charges hot water for one household
sumPS1HP &lt;- AvgHPCpdDemSC1 * PS1 * 365
sumPS2HP &lt;- AvgHPCpdDemSC1 * PS2 * 365
sumPS3HP &lt;- AvgHPCpdDemSC1 * PS3 * 365
sumPS4HP &lt;- AvgHPCpdDemSC1 * PS4 * 365

#______________________________________________________________________

#SC1 total NZ

 #Heat pump
  #Loading and scaling hot water load
HPprofileDT &lt;- heatPumpProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HPprofileDT &lt;- HPprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HPprofileDT &lt;- HPprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000))/90]#kW per household and half hour for the whole 90 day season

#Calculating Probability
CpdSumDT &lt;- CpdMinAll[, .(SumMins = sum(CPDmin)/5), keyby = .(season, obsHalfHour)]
CpdSumDT &lt;- CpdSumDT[, totalMins := sum(SumMins)]
                          

CpdSumDT &lt;- CpdSumDT[, Probability := SumMins / totalMins]

#Calculating average kW at congestion periods per household
HPprofileDT &lt;- HPprofileDT[, Period := &quot;Not Peak&quot;]

HPprofileDT &lt;- HPprofileDT[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

HPprofileDT &lt;- HPprofileDT[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

HPprofileDT &lt;- HPprofileDT[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

HPprofileDT &lt;- HPprofileDT[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

HPprofileDT &lt;- HPprofileDT[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]
HPprofileDT &lt;- HPprofileDT[, kWperHhSC1 := ifelse(Period == &quot;Morning Peak&quot; | Period == &quot;Evening Peak&quot;,
                                             kWperHh*0, kWperHh)]
#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(HPprofileDT, season, obsHalfHour)

CpdMergedHPDT &lt;- HPprofileDT[CpdSumDT]
CpdMergedHPDT &lt;- CpdMergedHPDT[, AvgDemCPD := kWperHhSC1 * Probability]
AvgHPCpdDemSC1 &lt;- sum(CpdMergedHPDT$AvgDemCPD)



#Claculating annual charges hot water for one household
sumPS1HP &lt;- AvgHPCpdDemSC1 * PS1 * 365/1000000
sumPS2HP &lt;- AvgHPCpdDemSC1 * PS2 * 365/1000000
sumPS3HP &lt;- AvgHPCpdDemSC1 * PS3 * 365/1000000
sumPS4HP &lt;- AvgHPCpdDemSC1 * PS4 * 365/1000000

#______________________________________________________________________-

#Heat Pump

#SC2 per household

 #Heat pump
  #Loading and scaling hot water load
HPprofileDT &lt;- heatPumpProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HPprofileDT &lt;- HPprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HPprofileDT &lt;- HPprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000))/nzHHheatPumps/90]#kW per household and half hour for the whole 90 day season

#Calculating Probability
CpdSumDT &lt;- CpdMinAll[, .(SumMins = sum(CPDmin)/5), keyby = .(season, obsHalfHour)]
CpdSumDT &lt;- CpdSumDT[, totalMins := sum(SumMins)]
                          

CpdSumDT &lt;- CpdSumDT[, Probability := SumMins / totalMins]

#Calculating average kW at congestion periods per household
HPprofileDT &lt;- HPprofileDT[, Period := &quot;Not Peak&quot;]

HPprofileDT &lt;- HPprofileDT[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

HPprofileDT &lt;- HPprofileDT[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

HPprofileDT &lt;- HPprofileDT[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

HPprofileDT &lt;- HPprofileDT[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

HPprofileDT &lt;- HPprofileDT[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]
HPprofileDT &lt;- HPprofileDT[, kWperHhSC2 := ifelse(Period == &quot;Morning Peak&quot; | Period == &quot;Evening Peak&quot;,
                                             kWperHh*0.5, kWperHh)]
#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(HPprofileDT, season, obsHalfHour)

CpdMergedHPDT &lt;- HPprofileDT[CpdSumDT]
CpdMergedHPDT &lt;- CpdMergedHPDT[, AvgDemCPD := kWperHhSC2 * Probability]
AvgHPCpdDemSC2 &lt;- sum(CpdMergedHPDT$AvgDemCPD)



#Claculating annual charges hot water for one household
sumPS1HP &lt;- AvgHPCpdDemSC2 * PS1 * 365
sumPS2HP &lt;- AvgHPCpdDemSC2 * PS2 * 365
sumPS3HP &lt;- AvgHPCpdDemSC2 * PS3 * 365
sumPS4HP &lt;- AvgHPCpdDemSC2 * PS4 * 365



#______________________________________________________________________

#SC2 total NZ

 #Heat pump
  #Loading and scaling hot water load
HPprofileDT &lt;- heatPumpProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HPprofileDT &lt;- HPprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HPprofileDT &lt;- HPprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000))/90]#kW per household and half hour for the whole 90 day season

#Calculating Probability
CpdSumDT &lt;- CpdMinAll[, .(SumMins = sum(CPDmin)/5), keyby = .(season, obsHalfHour)]
CpdSumDT &lt;- CpdSumDT[, totalMins := sum(SumMins)]
                          

CpdSumDT &lt;- CpdSumDT[, Probability := SumMins / totalMins]

#Calculating average kW at congestion periods per household
HPprofileDT &lt;- HPprofileDT[, Period := &quot;Not Peak&quot;]

HPprofileDT &lt;- HPprofileDT[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

HPprofileDT &lt;- HPprofileDT[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

HPprofileDT &lt;- HPprofileDT[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

HPprofileDT &lt;- HPprofileDT[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

HPprofileDT &lt;- HPprofileDT[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]
HPprofileDT &lt;- HPprofileDT[, kWperHhSC2 := ifelse(Period == &quot;Morning Peak&quot; | Period == &quot;Evening Peak&quot;,
                                             kWperHh*0.5, kWperHh)]
#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(HPprofileDT, season, obsHalfHour)

CpdMergedHPDT &lt;- HPprofileDT[CpdSumDT]
CpdMergedHPDT &lt;- CpdMergedHPDT[, AvgDemCPD := kWperHhSC2 * Probability]
AvgHPCpdDemSC2 &lt;- sum(CpdMergedHPDT$AvgDemCPD)



#Claculating annual charges hot water for one household
sumPS1HP &lt;- AvgHPCpdDemSC2 * PS1 * 365/1000000
sumPS2HP &lt;- AvgHPCpdDemSC2 * PS2 * 365/1000000
sumPS3HP &lt;- AvgHPCpdDemSC2 * PS3 * 365/1000000
sumPS4HP &lt;- AvgHPCpdDemSC2 * PS4 * 365/1000000

#____________________________________________________________________________________



#SC3 per household &amp; total (just adjust line 4461 to get the individual or total charge)

 #Heat pump
  #Loading and scaling hot water load
HPprofileDT &lt;- heatPumpProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HPprofileDT &lt;- HPprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HPprofileDT &lt;- HPprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHHheatPumps)/90]#kW per household and half hour for the whole 90 day season

#Calculating Probability
CpdSumDT &lt;- CpdMinAll[, .(SumMins = sum(CPDmin)/5), keyby = .(season, obsHalfHour)]
CpdSumDT &lt;- CpdSumDT[, totalMins := sum(SumMins)]
                          

CpdSumDT &lt;- CpdSumDT[, Probability := SumMins / totalMins]

#Calculating average kW at congestion periods per household

#Defining peak and off-peak periods

HPprofileDT &lt;- HPprofileDT[, Period := &quot;Not Peak&quot;]

HPprofileDT &lt;- HPprofileDT[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

HPprofileDT &lt;- HPprofileDT[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

HPprofileDT &lt;- HPprofileDT[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

HPprofileDT &lt;- HPprofileDT[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

HPprofileDT &lt;- HPprofileDT[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

#Building the sum of each peak period by season
AuMP &lt;- HPprofileDT[season == &quot;Autumn&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(kWperHh)]
WiMP &lt;- HPprofileDT[season == &quot;Winter&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(kWperHh)]


AuEP &lt;- HPprofileDT[season == &quot;Autumn&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(kWperHh)]
WiEP &lt;- HPprofileDT[season == &quot;Winter&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(kWperHh)]

        


#Counting number of rows that will be associated to spread the Morning Peak
AuMPHalfHours &lt;- nrow(HPprofileDT[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
WiMPHalfHours &lt;- nrow(HPprofileDT[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])


#Counting number of rows that will be associated to spread the Evening Peak
AuEPHalfHours &lt;- nrow(HPprofileDT[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
WiEPHalfHours &lt;- nrow(HPprofileDT[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])


#Calculating the proportion that each row will take on to spread the GWhs
distGWhOP1Au &lt;- AuMP/AuMPHalfHours
distGWhOP1Wi &lt;- WiMP/WiMPHalfHours


distGWhOP2Au &lt;- AuEP/AuEPHalfHours
distGWhOP2Wi &lt;- WiEP/WiEPHalfHours




#Adding amount of spreaded peak consumption to off-peak periods
HPprofileDT &lt;- HPprofileDT[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs3 :=
                     kWperHh + distGWhOP1Au]
HPprofileDT &lt;- HPprofileDT[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs3 :=
                     kWperHh + distGWhOP1Wi]



HPprofileDT &lt;- HPprofileDT[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs3 :=
                     kWperHh + distGWhOP2Au]
HPprofileDT &lt;- HPprofileDT[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs3 :=
                     kWperHh + distGWhOP2Wi]



#Setting missing values in peak periods to NULL
HPprofileDT &lt;- HPprofileDT[, kWperHhSC3:= ifelse(Period ==&quot;Morning Peak&quot; |
                                                   Period == &quot;Evening Peak&quot;,
                                  0, GWhs3)]



#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(HPprofileDT, season, obsHalfHour)

CpdMergedHPDT &lt;- HPprofileDT[CpdSumDT]
CpdMergedHPDT &lt;- CpdMergedHPDT[, AvgDemCPD := kWperHhSC3 * Probability]
AvgHPCpdDemSC3 &lt;- sum(CpdMergedHPDT$AvgDemCPD)



#Claculating annual charges hot water for one household
sumPS1HP &lt;- AvgHPCpdDemSC3 * PS1 * 365
sumPS2HP &lt;- AvgHPCpdDemSC3 * PS2 * 365
sumPS3HP &lt;- AvgHPCpdDemSC3 * PS3 * 365
sumPS4HP &lt;- AvgHPCpdDemSC3 * PS4 * 365</code></pre>
<pre class="r"><code>#Hot water

#SC1 per household

 #Hot water
  #Loading and scaling hot water load
HWprofileDT &lt;- hotWaterProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HWprofileDT &lt;- HWprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HWprofileDT &lt;- HWprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHHhotWater)/90]#kW per household and half hour for the whole 90 day season

#Calculating Probability
CpdSumDT &lt;- CpdMinAll[, .(SumMins = sum(CPDmin)/5), keyby = .(season, obsHalfHour)]
CpdSumDT &lt;- CpdSumDT[, totalMins := sum(SumMins)]
                          

CpdSumDT &lt;- CpdSumDT[, Probability := SumMins / totalMins]

#Calculating average kW at congestion periods per household
HWprofileDT &lt;- HWprofileDT[, Period := &quot;Not Peak&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]
HWprofileDT &lt;- HWprofileDT[, kWperHhSC1 := ifelse(Period == &quot;Morning Peak&quot; | Period == &quot;Evening Peak&quot;,
                                             kWperHh*0, kWperHh)]
#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(HWprofileDT, season, obsHalfHour)

CpdMergedHWDT &lt;- HWprofileDT[CpdSumDT]
CpdMergedHWDT &lt;- CpdMergedHWDT[, AvgDemCPD := kWperHhSC1 * Probability]
AvgHWCpdDemSC1 &lt;- sum(CpdMergedHWDT$AvgDemCPD)



#Claculating annual charges hot water for one household
sumPS1HW &lt;- AvgHWCpdDemSC1 * PS1 * 365
sumPS2HW &lt;- AvgHWCpdDemSC1 * PS2 * 365
sumPS3HW &lt;- AvgHWCpdDemSC1 * PS3 * 365
sumPS4HW &lt;- AvgHWCpdDemSC1 * PS4 * 365

#______________________________________________________________________

#SC1 total NZ

 #Hot water
  #Loading and scaling hot water load
HWprofileDT &lt;- hotWaterProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HWprofileDT &lt;- HWprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HWprofileDT &lt;- HWprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000))/90]#kW per household and half hour for the whole 90 day season

#Calculating Probability
CpdSumDT &lt;- CpdMinAll[, .(SumMins = sum(CPDmin)/5), keyby = .(season, obsHalfHour)]
CpdSumDT &lt;- CpdSumDT[, totalMins := sum(SumMins)]
                          

CpdSumDT &lt;- CpdSumDT[, Probability := SumMins / totalMins]

#Calculating average kW at congestion periods per household
HWprofileDT &lt;- HWprofileDT[, Period := &quot;Not Peak&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]
HWprofileDT &lt;- HWprofileDT[, kWperHhSC1 := ifelse(Period == &quot;Morning Peak&quot; | Period == &quot;Evening Peak&quot;,
                                             kWperHh*0, kWperHh)]
#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(HWprofileDT, season, obsHalfHour)

CpdMergedHWDT &lt;- HWprofileDT[CpdSumDT]
CpdMergedHWDT &lt;- CpdMergedHWDT[, AvgDemCPD := kWperHhSC1 * Probability]
AvgHWCpdDemSC1 &lt;- sum(CpdMergedHWDT$AvgDemCPD)



#Claculating annual charges hot water for one household
sumPS1HW &lt;- AvgHWCpdDemSC1 * PS1 * 365/1000000
sumPS2HW &lt;- AvgHWCpdDemSC1 * PS2 * 365/1000000
sumPS3HW &lt;- AvgHWCpdDemSC1 * PS3 * 365/1000000
sumPS4HW &lt;- AvgHWCpdDemSC1 * PS4 * 365/1000000


#___________________________________________________________________

#Hot water

#SC2 (per household)adjust /nzHeatpumps and /1000000 further down for total number

 #Hot water
  #Loading and scaling hot water load
HWprofileDT &lt;- hotWaterProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HWprofileDT &lt;- HWprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HWprofileDT &lt;- HWprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHHhotWater)/90]#kW per household and half hour for the whole 90 day season

#Calculating Probability
CpdSumDT &lt;- CpdMinAll[, .(SumMins = sum(CPDmin)/5), keyby = .(season, obsHalfHour)]
CpdSumDT &lt;- CpdSumDT[, totalMins := sum(SumMins)]
                          

CpdSumDT &lt;- CpdSumDT[, Probability := SumMins / totalMins]

#Calculating average kW at congestion periods per household
HWprofileDT &lt;- HWprofileDT[, Period := &quot;Not Peak&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]
HWprofileDT &lt;- HWprofileDT[, kWperHhSC1 := ifelse(Period == &quot;Morning Peak&quot; | Period == &quot;Evening Peak&quot;,
                                             kWperHh*0.5, kWperHh)]
#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(HWprofileDT, season, obsHalfHour)

CpdMergedHWDT &lt;- HWprofileDT[CpdSumDT]
CpdMergedHWDT &lt;- CpdMergedHWDT[, AvgDemCPD := kWperHhSC1 * Probability]
AvgHWCpdDemSC2 &lt;- sum(CpdMergedHWDT$AvgDemCPD)



#Claculating annual charges hot water for one household
sumPS1HW &lt;- AvgHWCpdDemSC2 * PS1 * 365
sumPS2HW &lt;- AvgHWCpdDemSC2 * PS2 * 365
sumPS3HW &lt;- AvgHWCpdDemSC2 * PS3 * 365
sumPS4HW &lt;- AvgHWCpdDemSC2 * PS4 * 365

#________________________________________________________________________





# SC3 hot water (adjust number of hot water installations and /1000000 further down)

 #Hot water
  #Loading and scaling hot water load
HWprofileDT &lt;- hotWaterProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HWprofileDT &lt;- HWprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HWprofileDT &lt;- HWprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHHhotWater)/90]#kW per household and half hour for the whole 90 day season

#Calculating Probability
CpdSumDT &lt;- CpdMinAll[, .(SumMins = sum(CPDmin)/5), keyby = .(season, obsHalfHour)]
CpdSumDT &lt;- CpdSumDT[, totalMins := sum(SumMins)]
                          

CpdSumDT &lt;- CpdSumDT[, Probability := SumMins / totalMins]

#Calculating average kW at congestion periods per household



#Defining peak and off-peak periods
HWprofileDT &lt;- HWprofileDT[, Period := &quot;Not Peak&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

#Building the sum of each peak period by season
AuMP2 &lt;- HWprofileDT[season == &quot;Autumn&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(kWperHh)]
WiMP2 &lt;- HWprofileDT[season == &quot;Winter&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(kWperHh)]


AuEP2 &lt;- HWprofileDT[season == &quot;Autumn&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(kWperHh)]
WiEP2 &lt;- HWprofileDT[season == &quot;Winter&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(kWperHh)]



#Counting number of rows that will be associated to spread the Morning Peak
AuMPHalfHours2 &lt;- nrow(HWprofileDT[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
WiMPHalfHours2 &lt;- nrow(HWprofileDT[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])


#Counting number of rows that will be associated to spread the Evening Peak
AuEPHalfHours2 &lt;- nrow(HWprofileDT[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
WiEPHalfHours2 &lt;- nrow(HWprofileDT[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])


#Calculating the proportion that each row will take on to spread the GWhs
distGWhOP1Au2 &lt;- AuMP2/AuMPHalfHours2
distGWhOP1Wi2 &lt;- WiMP2/WiMPHalfHours2


distGWhOP2Au2 &lt;- AuEP2/AuEPHalfHours2
distGWhOP2Wi2 &lt;- WiEP2/WiEPHalfHours2




#Adding amount of spreaded peak consumption to off-peak periods
HWprofileDT &lt;- HWprofileDT[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs4 :=
                     kWperHh + distGWhOP1Au2]
HWprofileDT &lt;- HWprofileDT[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs4 :=
                     kWperHh + distGWhOP1Wi2]


HWprofileDT &lt;- HWprofileDT[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs4 :=
                     kWperHh + distGWhOP2Au2]
HWprofileDT &lt;- HWprofileDT[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs4 :=
                     kWperHh + distGWhOP2Wi2]



#Setting missing values in peak periods to NULL
HWprofileDT &lt;- HWprofileDT[, GWhs4:= ifelse(Period ==&quot;Morning Peak&quot;,
                                  0, GWhs4)]
HWprofileDT &lt;- HWprofileDT[, GWhs4:= ifelse(Period ==&quot;Evening Peak&quot;,
                                  0, GWhs4)]

#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(HWprofileDT, season, obsHalfHour)

CpdMergedHWDT &lt;- HWprofileDT[CpdSumDT]
CpdMergedHWDT &lt;- CpdMergedHWDT[, AvgDemCPD := GWhs4 * Probability]
AvgHWCpdDemSC2 &lt;- sum(CpdMergedHWDT$AvgDemCPD)



#Claculating annual charges hot water for one household
sumPS1HW &lt;- AvgHWCpdDemSC2 * PS1 * 365
sumPS2HW &lt;- AvgHWCpdDemSC2 * PS2 * 365
sumPS3HW &lt;- AvgHWCpdDemSC2 * PS3 * 365
sumPS4HW &lt;- AvgHWCpdDemSC2 * PS4 * 365</code></pre>
<pre class="r"><code>#Refrigeration

#SC1 per household

 #Refrigeration
  #Loading and scaling hot water load
HWprofileDT &lt;- refrigerationProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HWprofileDT &lt;- HWprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HWprofileDT &lt;- HWprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHouseholds)/90]#kW per household and half hour for the whole 90 day season

#Calculating Probability
CpdSumDT &lt;- CpdMinAll[, .(SumMins = sum(CPDmin)/5), keyby = .(season, obsHalfHour)]
CpdSumDT &lt;- CpdSumDT[, totalMins := sum(SumMins)]
                          

CpdSumDT &lt;- CpdSumDT[, Probability := SumMins / totalMins]

#Calculating average kW at congestion periods per household
HWprofileDT &lt;- HWprofileDT[, Period := &quot;Not Peak&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]
HWprofileDT &lt;- HWprofileDT[, kWperHhSC1 := ifelse(Period == &quot;Morning Peak&quot; | Period == &quot;Evening Peak&quot;,
                                             kWperHh*0, kWperHh)]
#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(HWprofileDT, season, obsHalfHour)

CpdMergedHWDT &lt;- HWprofileDT[CpdSumDT]
CpdMergedHWDT &lt;- CpdMergedHWDT[, AvgDemCPD := kWperHhSC1 * Probability]
AvgHWCpdDemSC1 &lt;- sum(CpdMergedHWDT$AvgDemCPD)



#Claculating annual charges hot water for one household
sumPS1HW &lt;- AvgHWCpdDemSC1 * PS1 * 365
sumPS2HW &lt;- AvgHWCpdDemSC1 * PS2 * 365
sumPS3HW &lt;- AvgHWCpdDemSC1 * PS3 * 365
sumPS4HW &lt;- AvgHWCpdDemSC1 * PS4 * 365

#______________________________________________________________________

#SC1 total NZ

 #Hot water
  #Loading and scaling hot water load
HWprofileDT &lt;- refrigerationProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HWprofileDT &lt;- HWprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HWprofileDT &lt;- HWprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000))/90]#kW per household and half hour for the whole 90 day season

#Calculating Probability
CpdSumDT &lt;- CpdMinAll[, .(SumMins = sum(CPDmin)/5), keyby = .(season, obsHalfHour)]
CpdSumDT &lt;- CpdSumDT[, totalMins := sum(SumMins)]
                          

CpdSumDT &lt;- CpdSumDT[, Probability := SumMins / totalMins]

#Calculating average kW at congestion periods per household
HWprofileDT &lt;- HWprofileDT[, Period := &quot;Not Peak&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]
HWprofileDT &lt;- HWprofileDT[, kWperHhSC1 := ifelse(Period == &quot;Morning Peak&quot; | Period == &quot;Evening Peak&quot;,
                                             kWperHh*0, kWperHh)]
#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(HWprofileDT, season, obsHalfHour)

CpdMergedHWDT &lt;- HWprofileDT[CpdSumDT]
CpdMergedHWDT &lt;- CpdMergedHWDT[, AvgDemCPD := kWperHhSC1 * Probability]
AvgHWCpdDemSC1 &lt;- sum(CpdMergedHWDT$AvgDemCPD)



#Claculating annual charges hot water for one household
sumPS1HW &lt;- AvgHWCpdDemSC1 * PS1 * 365/1000000
sumPS2HW &lt;- AvgHWCpdDemSC1 * PS2 * 365/1000000
sumPS3HW &lt;- AvgHWCpdDemSC1 * PS3 * 365/1000000
sumPS4HW &lt;- AvgHWCpdDemSC1 * PS4 * 365/1000000


#___________________________________________________________________

#Refrigeration

#SC2 (per household)adjust /nzHeatpumps and /1000000 further down for total number

 #Refrigeration
  #Loading and scaling hot water load
HWprofileDT &lt;- refrigerationProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HWprofileDT &lt;- HWprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HWprofileDT &lt;- HWprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHouseholds)/90]#kW per household and half hour for the whole 90 day season

#Calculating Probability
CpdSumDT &lt;- CpdMinAll[, .(SumMins = sum(CPDmin)/5), keyby = .(season, obsHalfHour)]
CpdSumDT &lt;- CpdSumDT[, totalMins := sum(SumMins)]
                          

CpdSumDT &lt;- CpdSumDT[, Probability := SumMins / totalMins]

#Calculating average kW at congestion periods per household
HWprofileDT &lt;- HWprofileDT[, Period := &quot;Not Peak&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]
HWprofileDT &lt;- HWprofileDT[, kWperHhSC1 := ifelse(Period == &quot;Morning Peak&quot; | Period == &quot;Evening Peak&quot;,
                                             kWperHh*0.5, kWperHh)]
#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(HWprofileDT, season, obsHalfHour)

CpdMergedHWDT &lt;- HWprofileDT[CpdSumDT]
CpdMergedHWDT &lt;- CpdMergedHWDT[, AvgDemCPD := kWperHhSC1 * Probability]
AvgHWCpdDemSC2 &lt;- sum(CpdMergedHWDT$AvgDemCPD)



#Claculating annual charges hot water for one household
sumPS1HW &lt;- AvgHWCpdDemSC2 * PS1 * 365
sumPS2HW &lt;- AvgHWCpdDemSC2 * PS2 * 365
sumPS3HW &lt;- AvgHWCpdDemSC2 * PS3 * 365
sumPS4HW &lt;- AvgHWCpdDemSC2 * PS4 * 365

#________________________________________________________________________





# SC3 refrigeration (adjust number of hot water installations and /1000000 further down)

 #Refrigeration
  #Loading and scaling hot water load
HWprofileDT &lt;- refrigerationProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HWprofileDT &lt;- HWprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HWprofileDT &lt;- HWprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHouseholds)/90]#kW per household and half hour for the whole 90 day season

#Calculating Probability
CpdSumDT &lt;- CpdMinAll[, .(SumMins = sum(CPDmin)/5), keyby = .(season, obsHalfHour)]
CpdSumDT &lt;- CpdSumDT[, totalMins := sum(SumMins)]
                          

CpdSumDT &lt;- CpdSumDT[, Probability := SumMins / totalMins]

#Calculating average kW at congestion periods per household



#Defining peak and off-peak periods
HWprofileDT &lt;- HWprofileDT[, Period := &quot;Not Peak&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

HWprofileDT &lt;- HWprofileDT[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

#Building the sum of each peak period by season
AuMP2 &lt;- HWprofileDT[season == &quot;Autumn&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(kWperHh)]
WiMP2 &lt;- HWprofileDT[season == &quot;Winter&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(kWperHh)]


AuEP2 &lt;- HWprofileDT[season == &quot;Autumn&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(kWperHh)]
WiEP2 &lt;- HWprofileDT[season == &quot;Winter&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(kWperHh)]



#Counting number of rows that will be associated to spread the Morning Peak
AuMPHalfHours2 &lt;- nrow(HWprofileDT[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
WiMPHalfHours2 &lt;- nrow(HWprofileDT[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])


#Counting number of rows that will be associated to spread the Evening Peak
AuEPHalfHours2 &lt;- nrow(HWprofileDT[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
WiEPHalfHours2 &lt;- nrow(HWprofileDT[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])


#Calculating the proportion that each row will take on to spread the GWhs
distGWhOP1Au2 &lt;- AuMP2/AuMPHalfHours2
distGWhOP1Wi2 &lt;- WiMP2/WiMPHalfHours2


distGWhOP2Au2 &lt;- AuEP2/AuEPHalfHours2
distGWhOP2Wi2 &lt;- WiEP2/WiEPHalfHours2




#Adding amount of spreaded peak consumption to off-peak periods
HWprofileDT &lt;- HWprofileDT[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs4 :=
                     kWperHh + distGWhOP1Au2]
HWprofileDT &lt;- HWprofileDT[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs4 :=
                     kWperHh + distGWhOP1Wi2]


HWprofileDT &lt;- HWprofileDT[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs4 :=
                     kWperHh + distGWhOP2Au2]
HWprofileDT &lt;- HWprofileDT[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs4 :=
                     kWperHh + distGWhOP2Wi2]



#Setting missing values in peak periods to NULL
HWprofileDT &lt;- HWprofileDT[, GWhs4:= ifelse(Period ==&quot;Morning Peak&quot;,
                                  0, GWhs4)]
HWprofileDT &lt;- HWprofileDT[, GWhs4:= ifelse(Period ==&quot;Evening Peak&quot;,
                                  0, GWhs4)]

#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(HWprofileDT, season, obsHalfHour)

CpdMergedHWDT &lt;- HWprofileDT[CpdSumDT]
CpdMergedHWDT &lt;- CpdMergedHWDT[, AvgDemCPD := GWhs4 * Probability]
AvgHWCpdDemSC2 &lt;- sum(CpdMergedHWDT$AvgDemCPD)



#Claculating annual charges hot water for one household
sumPS1HW &lt;- AvgHWCpdDemSC2 * PS1 * 365
sumPS2HW &lt;- AvgHWCpdDemSC2 * PS2 * 365
sumPS3HW &lt;- AvgHWCpdDemSC2 * PS3 * 365
sumPS4HW &lt;- AvgHWCpdDemSC2 * PS4 * 365</code></pre>
<pre class="r"><code># SC1

#Both appliances together

HPprofileDT &lt;- heatPumpProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HPprofileDT &lt;- HPprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HPprofileDT &lt;- HPprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHHheatPumps)/90]#kW per household and half hour for the whole 90 day season

HWprofileDT &lt;- hotWaterProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HWprofileDT &lt;- HWprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HWprofileDT &lt;- HWprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHHhotWater)/90]#kW per household and half hour for the whole 90 day season

HPHWprofileDT &lt;- copy(HWprofileDT)
HPHWprofileDT &lt;- HPHWprofileDT[, kWperHhSum := kWperHh + (HPprofileDT$kWperHh)]

#Calculating Probability
CpdSumDT &lt;- CpdMinAll[, .(SumMins = sum(CPDmin)/5), keyby = .(season, obsHalfHour)]
CpdSumDT &lt;- CpdSumDT[, totalMins := sum(SumMins)]
                          

CpdSumDT &lt;- CpdSumDT[, Probability := SumMins / totalMins]


#Calculating average kW at congestion periods per household
HPHWprofileDT &lt;- HPHWprofileDT[, Period := &quot;Not Peak&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]
HPHWprofileDT &lt;- HPHWprofileDT[, kWperHhSum := ifelse(Period == &quot;Morning Peak&quot; | Period == &quot;Evening Peak&quot;,
                                             kWperHhSum*0, kWperHhSum)]


#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(HPHWprofileDT, season, obsHalfHour)
CpdMergedHPHWDT &lt;- HPHWprofileDT[CpdSumDT]

CpdMergedHPHWDT &lt;- CpdMergedHPHWDT[, AvgDemCPD := kWperHhSum * Probability]
AvgHPHWCpdDem &lt;- sum(CpdMergedHPHWDT$AvgDemCPD)
  

#Claculating annual charges hot water for one household
sumPS1HPHW &lt;- AvgHPHWCpdDem * PS1 * 365
sumPS2HPHW &lt;- AvgHPHWCpdDem * PS2 * 365
sumPS3HPHW &lt;- AvgHPHWCpdDem * PS3 * 365
sumPS4HPHW &lt;- AvgHPHWCpdDem * PS4 * 365



#__________________________________________________________

#SC2 Both appliances together


HPprofileDT &lt;- heatPumpProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HPprofileDT &lt;- HPprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HPprofileDT &lt;- HPprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHHheatPumps)/90]#kW per household and half hour for the whole 90 day season

HWprofileDT &lt;- hotWaterProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HWprofileDT &lt;- HWprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HWprofileDT &lt;- HWprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHHhotWater)/90]#kW per household and half hour for the whole 90 day season

HPHWprofileDT &lt;- copy(HWprofileDT)
HPHWprofileDT &lt;- HPHWprofileDT[, kWperHhSum := kWperHh + (HPprofileDT$kWperHh)]

#Calculating Probability
CpdSumDT &lt;- CpdMinAll[, .(SumMins = sum(CPDmin)/5), keyby = .(season, obsHalfHour)]
CpdSumDT &lt;- CpdSumDT[, totalMins := sum(SumMins)]
                          

CpdSumDT &lt;- CpdSumDT[, Probability := SumMins / totalMins]


#Calculating average kW at congestion periods per household
HPHWprofileDT &lt;- HPHWprofileDT[, Period := &quot;Not Peak&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]
HPHWprofileDT &lt;- HPHWprofileDT[, kWperHhSum := ifelse(Period == &quot;Morning Peak&quot; | Period == &quot;Evening Peak&quot;,
                                             kWperHhSum*0.5, kWperHhSum)]


#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(HPHWprofileDT, season, obsHalfHour)
CpdMergedHPHWDT &lt;- HPHWprofileDT[CpdSumDT]

CpdMergedHPHWDT &lt;- CpdMergedHPHWDT[, AvgDemCPD := kWperHhSum * Probability]
AvgHPHWCpdDem &lt;- sum(CpdMergedHPHWDT$AvgDemCPD)
  

#Claculating annual charges hot water for one household
sumPS1HPHW &lt;- AvgHPHWCpdDem * PS1 * 365
sumPS2HPHW &lt;- AvgHPHWCpdDem * PS2 * 365
sumPS3HPHW &lt;- AvgHPHWCpdDem * PS3 * 365
sumPS4HPHW &lt;- AvgHPHWCpdDem * PS4 * 365

#_____________________________________________________________________________

#SC3 Both appliances together

HPprofileDT &lt;- heatPumpProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HPprofileDT &lt;- HPprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HPprofileDT &lt;- HPprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHHheatPumps)/90]#kW per household and half hour for the whole 90 day season

HWprofileDT &lt;- hotWaterProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HWprofileDT &lt;- HWprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HWprofileDT &lt;- HWprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHHhotWater)/90]#kW per household and half hour for the whole 90 day season

HPHWprofileDT &lt;- copy(HWprofileDT)
HPHWprofileDT &lt;- HPHWprofileDT[, kWperHhSum := kWperHh + (HPprofileDT$kWperHh)]

#Calculating Probability
CpdSumDT &lt;- CpdMinAll[, .(SumMins = sum(CPDmin)/5), keyby = .(season, obsHalfHour)]
CpdSumDT &lt;- CpdSumDT[, totalMins := sum(SumMins)]
                          

CpdSumDT &lt;- CpdSumDT[, Probability := SumMins / totalMins]


#Calculating average kW at congestion periods per household
#Defining peak and off-peak periods
HPHWprofileDT &lt;- HPHWprofileDT[, Period := &quot;Not Peak&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

#Building the sum of each peak period by season
AuMP2 &lt;- HPHWprofileDT[season == &quot;Autumn&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(kWperHhSum)]
WiMP2 &lt;- HPHWprofileDT[season == &quot;Winter&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(kWperHhSum)]


AuEP2 &lt;- HPHWprofileDT[season == &quot;Autumn&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(kWperHhSum)]
WiEP2 &lt;- HPHWprofileDT[season == &quot;Winter&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(kWperHhSum)]



#Counting number of rows that will be associated to spread the Morning Peak
AuMPHalfHours2 &lt;- nrow(HPHWprofileDT[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
WiMPHalfHours2 &lt;- nrow(HPHWprofileDT[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])


#Counting number of rows that will be associated to spread the Evening Peak
AuEPHalfHours2 &lt;- nrow(HPHWprofileDT[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
WiEPHalfHours2 &lt;- nrow(HPHWprofileDT[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])


#Calculating the proportion that each row will take on to spread the GWhs
distGWhOP1Au2 &lt;- AuMP2/AuMPHalfHours2
distGWhOP1Wi2 &lt;- WiMP2/WiMPHalfHours2


distGWhOP2Au2 &lt;- AuEP2/AuEPHalfHours2
distGWhOP2Wi2 &lt;- WiEP2/WiEPHalfHours2




#Adding amount of spreaded peak consumption to off-peak periods
HPHWprofileDT &lt;- HPHWprofileDT[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs4 :=
                     kWperHhSum + distGWhOP1Au2]
HPHWprofileDT &lt;- HPHWprofileDT[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs4 :=
                     kWperHhSum + distGWhOP1Wi2]


HPHWprofileDT &lt;- HPHWprofileDT[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs4 :=
                     kWperHhSum + distGWhOP2Au2]
HPHWprofileDT &lt;- HPHWprofileDT[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs4 :=
                     kWperHhSum + distGWhOP2Wi2]



#Setting missing values in peak periods to NULL
HPHWprofileDT &lt;- HPHWprofileDT[, GWhs4:= ifelse(Period ==&quot;Morning Peak&quot;,
                                  0, GWhs4)]
HPHWprofileDT &lt;- HPHWprofileDT[, GWhs4:= ifelse(Period ==&quot;Evening Peak&quot;,
                                  0, GWhs4)]

#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(HPHWprofileDT, season, obsHalfHour)

CpdMergedHWDT &lt;- HPHWprofileDT[CpdSumDT]
CpdMergedHWDT &lt;- CpdMergedHWDT[, AvgDemCPD := GWhs4 * Probability]
AvgHWHPCpdDemSC2 &lt;- sum(CpdMergedHWDT$AvgDemCPD)



#Claculating annual charges hot water for one household
sumPS1HW &lt;- AvgHWHPCpdDemSC2 * PS1 * 365
sumPS2HW &lt;- AvgHWHPCpdDemSC2 * PS2 * 365
sumPS3HW &lt;- AvgHWHPCpdDemSC2 * PS3 * 365
sumPS4HW &lt;- AvgHWHPCpdDemSC2 * PS4 * 365</code></pre>
<pre class="r"><code># SC1

#Both appliances together

HPprofileDT &lt;- heatPumpProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HPprofileDT &lt;- HPprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HPprofileDT &lt;- HPprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHHheatPumps)/90]#kW per household and half hour for the whole 90 day season

HWprofileDT &lt;- hotWaterProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HWprofileDT &lt;- HWprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HWprofileDT &lt;- HWprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHHhotWater)/90]#kW per household and half hour for the whole 90 day season

REFprofileDT &lt;- refrigerationProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
REFprofileDT &lt;- REFprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
REFprofileDT &lt;- REFprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHouseholds)/90]#kW per household and half hour for the whole 90 day season

HPHWprofileDT &lt;- copy(HWprofileDT)
HPHWprofileDT &lt;- HPHWprofileDT[, kWperHhSum := kWperHh + (HPprofileDT$kWperHh) +
                                 (REFprofileDT$kWperHh)]

#Calculating Probability
CpdSumDT &lt;- CpdMinAll[, .(SumMins = sum(CPDmin)/5), keyby = .(season, obsHalfHour)]
CpdSumDT &lt;- CpdSumDT[, totalMins := sum(SumMins)]
                          

CpdSumDT &lt;- CpdSumDT[, Probability := SumMins / totalMins]


#Calculating average kW at congestion periods per household
HPHWprofileDT &lt;- HPHWprofileDT[, Period := &quot;Not Peak&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]
HPHWprofileDT &lt;- HPHWprofileDT[, kWperHhSum := ifelse(Period == &quot;Morning Peak&quot; | Period == &quot;Evening Peak&quot;,
                                             kWperHhSum*0, kWperHhSum)]


#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(HPHWprofileDT, season, obsHalfHour)
CpdMergedHPHWDT &lt;- HPHWprofileDT[CpdSumDT]

CpdMergedHPHWDT &lt;- CpdMergedHPHWDT[, AvgDemCPD := kWperHhSum * Probability]
AvgHPHWCpdDem &lt;- sum(CpdMergedHPHWDT$AvgDemCPD)
  

#Claculating annual charges hot water for one household
sumPS1HPHW &lt;- AvgHPHWCpdDem * PS1 * 365
sumPS2HPHW &lt;- AvgHPHWCpdDem * PS2 * 365
sumPS3HPHW &lt;- AvgHPHWCpdDem * PS3 * 365
sumPS4HPHW &lt;- AvgHPHWCpdDem * PS4 * 365



#__________________________________________________________

#SC2 Both appliances together


HPprofileDT &lt;- heatPumpProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HPprofileDT &lt;- HPprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HPprofileDT &lt;- HPprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHHheatPumps)/90]#kW per household and half hour for the whole 90 day season

HWprofileDT &lt;- hotWaterProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HWprofileDT &lt;- HWprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HWprofileDT &lt;- HWprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHHhotWater)/90]#kW per household and half hour for the whole 90 day season

REFprofileDT &lt;- refrigerationProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
REFprofileDT &lt;- REFprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
REFprofileDT &lt;- REFprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHouseholds)/90]#kW per household and half hour for the whole 90 day season

HPHWprofileDT &lt;- copy(HWprofileDT)
HPHWprofileDT &lt;- HPHWprofileDT[, kWperHhSum := kWperHh + (HPprofileDT$kWperHh) +
                                 (REFprofileDT$kWperHh)]

#Calculating Probability
CpdSumDT &lt;- CpdMinAll[, .(SumMins = sum(CPDmin)/5), keyby = .(season, obsHalfHour)]
CpdSumDT &lt;- CpdSumDT[, totalMins := sum(SumMins)]
                          

CpdSumDT &lt;- CpdSumDT[, Probability := SumMins / totalMins]


#Calculating average kW at congestion periods per household
HPHWprofileDT &lt;- HPHWprofileDT[, Period := &quot;Not Peak&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]
HPHWprofileDT &lt;- HPHWprofileDT[, kWperHhSum := ifelse(Period == &quot;Morning Peak&quot; | Period == &quot;Evening Peak&quot;,
                                             kWperHhSum*0.5, kWperHhSum)]


#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(HPHWprofileDT, season, obsHalfHour)
CpdMergedHPHWDT &lt;- HPHWprofileDT[CpdSumDT]

CpdMergedHPHWDT &lt;- CpdMergedHPHWDT[, AvgDemCPD := kWperHhSum * Probability]
AvgHPHWCpdDem &lt;- sum(CpdMergedHPHWDT$AvgDemCPD)
  

#Claculating annual charges hot water for one household
sumPS1HPHW &lt;- AvgHPHWCpdDem * PS1 * 365
sumPS2HPHW &lt;- AvgHPHWCpdDem * PS2 * 365
sumPS3HPHW &lt;- AvgHPHWCpdDem * PS3 * 365
sumPS4HPHW &lt;- AvgHPHWCpdDem * PS4 * 365

#_____________________________________________________________________________

#SC3 Both appliances together

HPprofileDT &lt;- heatPumpProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HPprofileDT &lt;- HPprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HPprofileDT &lt;- HPprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHHheatPumps)/90]#kW per household and half hour for the whole 90 day season

HWprofileDT &lt;- hotWaterProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
HWprofileDT &lt;- HWprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
HWprofileDT &lt;- HWprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHHhotWater)/90]#kW per household and half hour for the whole 90 day season

REFprofileDT &lt;- refrigerationProfileDT[ !(season %in% c(&quot;Spring&quot;, &quot;Summer&quot;))]
REFprofileDT &lt;- REFprofileDT[, .(sumGWhperHalfHour = sum(scaledGWh)),
                           keyby = .(season, obsHalfHour)]
REFprofileDT &lt;- REFprofileDT[, kWperHh := (((sumGWhperHalfHour *
                                                2)*1000*1000)/nzHouseholds)/90]#kW per household and half hour for the whole 90 day season

HPHWprofileDT &lt;- copy(HWprofileDT)
HPHWprofileDT &lt;- HPHWprofileDT[, kWperHhSum := kWperHh + (HPprofileDT$kWperHh) +
                                 (REFprofileDT$kWperHh)]

#Calculating Probability
CpdSumDT &lt;- CpdMinAll[, .(SumMins = sum(CPDmin)/5), keyby = .(season, obsHalfHour)]
CpdSumDT &lt;- CpdSumDT[, totalMins := sum(SumMins)]
                          

CpdSumDT &lt;- CpdSumDT[, Probability := SumMins / totalMins]


#Calculating average kW at congestion periods per household
#Defining peak and off-peak periods
HPHWprofileDT &lt;- HPHWprofileDT[, Period := &quot;Not Peak&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

HPHWprofileDT &lt;- HPHWprofileDT[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]

#Building the sum of each peak period by season
AuMP2 &lt;- HPHWprofileDT[season == &quot;Autumn&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(kWperHhSum)]
WiMP2 &lt;- HPHWprofileDT[season == &quot;Winter&quot; &amp; Period == &quot;Morning Peak&quot;,
                sum(kWperHhSum)]


AuEP2 &lt;- HPHWprofileDT[season == &quot;Autumn&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(kWperHhSum)]
WiEP2 &lt;- HPHWprofileDT[season == &quot;Winter&quot; &amp; Period == &quot;Evening Peak&quot;,
                sum(kWperHhSum)]



#Counting number of rows that will be associated to spread the Morning Peak
AuMPHalfHours2 &lt;- nrow(HPHWprofileDT[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])
WiMPHalfHours2 &lt;- nrow(HPHWprofileDT[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 1&quot;])


#Counting number of rows that will be associated to spread the Evening Peak
AuEPHalfHours2 &lt;- nrow(HPHWprofileDT[season == &quot;Autumn&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])
WiEPHalfHours2 &lt;- nrow(HPHWprofileDT[season == &quot;Winter&quot; &amp;
                              Period == &quot;Off Peak 2&quot;])


#Calculating the proportion that each row will take on to spread the GWhs
distGWhOP1Au2 &lt;- AuMP2/AuMPHalfHours2
distGWhOP1Wi2 &lt;- WiMP2/WiMPHalfHours2


distGWhOP2Au2 &lt;- AuEP2/AuEPHalfHours2
distGWhOP2Wi2 &lt;- WiEP2/WiEPHalfHours2




#Adding amount of spreaded peak consumption to off-peak periods
HPHWprofileDT &lt;- HPHWprofileDT[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs4 :=
                     kWperHhSum + distGWhOP1Au2]
HPHWprofileDT &lt;- HPHWprofileDT[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 1&quot;, GWhs4 :=
                     kWperHhSum + distGWhOP1Wi2]


HPHWprofileDT &lt;- HPHWprofileDT[season == &quot;Autumn&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs4 :=
                     kWperHhSum + distGWhOP2Au2]
HPHWprofileDT &lt;- HPHWprofileDT[season == &quot;Winter&quot; &amp;
                     Period == &quot;Off Peak 2&quot;, GWhs4 :=
                     kWperHhSum + distGWhOP2Wi2]



#Setting missing values in peak periods to NULL
HPHWprofileDT &lt;- HPHWprofileDT[, GWhs4:= ifelse(Period ==&quot;Morning Peak&quot;,
                                  0, GWhs4)]
HPHWprofileDT &lt;- HPHWprofileDT[, GWhs4:= ifelse(Period ==&quot;Evening Peak&quot;,
                                  0, GWhs4)]

#Preparing for merging
setkey(CpdSumDT, season, obsHalfHour)
setkey(HPHWprofileDT, season, obsHalfHour)

CpdMergedHWDT &lt;- HPHWprofileDT[CpdSumDT]
CpdMergedHWDT &lt;- CpdMergedHWDT[, AvgDemCPD := GWhs4 * Probability]
AvgHWHPCpdDemSC2 &lt;- sum(CpdMergedHWDT$AvgDemCPD)



#Claculating annual charges hot water for one household
sumPS1HW &lt;- AvgHWHPCpdDemSC2 * PS1 * 365
sumPS2HW &lt;- AvgHWHPCpdDemSC2 * PS2 * 365
sumPS3HW &lt;- AvgHWHPCpdDemSC2 * PS3 * 365
sumPS4HW &lt;- AvgHWHPCpdDemSC2 * PS4 * 365</code></pre>
</div>
</div>
</div>
<div id="grid-generation" class="section level1">
<h1><span class="header-section-number">14</span> Grid generation</h1>
<pre class="r"><code>Generationdata  &lt;- read.csv(&quot;/Volumes/hum-csafe/Research Projects/GREEN Grid/externalData/EA_Generation_Data/Monthly extract/2018_01_07.csv&quot;)


#Time and month adjustments
GenDT &lt;- data.table::as.data.table(Generationdata)
GenDT &lt;- GenDT[, Period.start := lubridate::dmy_hm(Period.start, tz = &quot;Pacific/Auckland&quot;)]
GenDT &lt;- GenDT[, year := lubridate::year(Period.start)]
GenDT &lt;- GenDT[, obsHalfHour := hms::as.hms(Period.start)]
GenDT &lt;- GenDT[, month := lubridate::month(Period.start)]
GenDT &lt;- GenDT[month == 1, season := &quot;Summer&quot;]
GenDT &lt;- GenDT[month == 7, season := &quot;Winter&quot;]

GenDT &lt;- GenDT[, Period.start := NULL]
GenDT &lt;- GenDT[, Period.end := NULL]

GenDT &lt;- GenDT[, GWh := GWh * 3]#Scaling up for whole season</code></pre>
<div id="running-scenarios" class="section level2">
<h2><span class="header-section-number">14.1</span> Running scenarios</h2>
<pre class="r"><code>#Determining electricity generation during peak time-periods


MPS &lt;- hms::as.hms(&quot;06:00:00&quot;)
MPE &lt;- hms::as.hms(&quot;10:00:00&quot;)

EPS &lt;- hms::as.hms(&quot;17:00:00&quot;)
EPE &lt;- hms::as.hms(&quot;21:00:00&quot;)

OP1S &lt;- hms::as.hms(&quot;21:30:00&quot;)
OP1E &lt;- hms::as.hms(&quot;23:30:00&quot;)

OP12S &lt;- hms::as.hms(&quot;00:00:00&quot;)
OP12E &lt;- hms::as.hms(&quot;05:30:00&quot;)

OP2S &lt;- hms::as.hms(&quot;10:30:00&quot;)
OP2E &lt;- hms::as.hms(&quot;16:30:00&quot;)



sc1data &lt;- GenDT

sc1data &lt;- sc1data[, .(GWh1 = sum(GWh)), 
                    keyby = .(season, obsHalfHour)]


sc1data &lt;- sc1data[, Period := &quot;Not Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

sc1data &lt;- sc1data[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]




#Change the order in facet_grid()
sc1data$season &lt;- factor(sc1data$season, levels = c(&quot;Summer&quot;,
                                                    &quot;Winter&quot;))


sc1data &lt;- sc1data[, .(PotCur = sum(GWh1)),
                   keyby = .(season, Period)]
sc1data</code></pre>
<pre><code>##    season       Period   PotCur
## 1: Summer Evening Peak 1925.841
## 2: Summer Morning Peak 1848.993
## 3: Summer   Off Peak 1 2834.028
## 4: Summer   Off Peak 2 2861.607
## 5: Winter Evening Peak 2431.611
## 6: Winter Morning Peak 2248.020
## 7: Winter   Off Peak 1 3139.080
## 8: Winter   Off Peak 2 3091.740</code></pre>
</div>
<div id="grid-generation-total-impact" class="section level2">
<h2><span class="header-section-number">14.2</span> Grid generation total impact</h2>
<pre class="r"><code>Generationdata  &lt;- read.csv(&quot;/Volumes/hum-csafe/Research Projects/GREEN Grid/externalData/EA_Generation_Data/Monthly extract/2018_01_07.csv&quot;)


#Time and month adjustments
GenDT &lt;- data.table::as.data.table(Generationdata)
GenDT &lt;- GenDT[, Period.start := lubridate::dmy_hm(Period.start, tz = &quot;Pacific/Auckland&quot;)]
GenDT &lt;- GenDT[, year := lubridate::year(Period.start)]
GenDT &lt;- GenDT[, obsHalfHour := hms::as.hms(Period.start)]
GenDT &lt;- GenDT[, month := lubridate::month(Period.start)]
GenDT &lt;- GenDT[month == 1, season := &quot;Summer&quot;]
GenDT &lt;- GenDT[month == 7, season := &quot;Winter&quot;]

GenDT &lt;- GenDT[, Period.start := NULL]
GenDT &lt;- GenDT[, Period.end := NULL]

#GenDT &lt;- GenDT[, GWh := GWh * 3]#Scaling up for whole season




GenDT &lt;- GenDT[, .(meanGWh = mean(`GWh`)), keyby = .(season, obsHalfHour)]

GenDT &lt;- GenDT[, Period := &quot;Not Peak&quot;]

GenDT &lt;- GenDT[obsHalfHour &gt;= MPS &amp; 
                     obsHalfHour &lt;= MPE,
                   Period := &quot;Morning Peak&quot;]

GenDT &lt;- GenDT[obsHalfHour &gt;= EPS &amp; 
                     obsHalfHour &lt;= EPE,
                   Period := &quot;Evening Peak&quot;]

GenDT &lt;- GenDT[obsHalfHour &gt;= OP1S &amp; 
                     obsHalfHour &lt;= OP1E,
                   Period := &quot;Off Peak 1&quot;]

GenDT &lt;- GenDT[obsHalfHour &gt;= OP12S &amp; 
                     obsHalfHour &lt;= OP12E,
                   Period := &quot;Off Peak 1&quot;]

GenDT &lt;- GenDT[obsHalfHour &gt;= OP2S &amp; 
                     obsHalfHour &lt;= OP2E,
                   Period := &quot;Off Peak 2&quot;]


GenDT &lt;- GenDT[, SuSc1 := meanGWh]
GenDT &lt;- GenDT[, SuSc1 := ifelse(Period==&quot;Morning Peak&quot; &amp; season == &quot;Summer&quot;, SuSc1 * 0.8466, SuSc1)]
GenDT &lt;- GenDT[, SuSc1 := ifelse(Period==&quot;Evening Peak&quot; &amp; season == &quot;Summer&quot;, SuSc1 * 0.8541, SuSc1)]
GenDT &lt;- GenDT[, SuSc1 := ifelse(Period==&quot;Morning Peak&quot; &amp; season == &quot;Winter&quot;, SuSc1 * 0.8178, SuSc1)]
GenDT &lt;- GenDT[, SuSc1 := ifelse(Period==&quot;Evening Peak&quot; &amp; season == &quot;Winter&quot;, SuSc1 * 0.7950, SuSc1)]


GenDT &lt;- GenDT[, SuSc2 := meanGWh]
GenDT &lt;- GenDT[, SuSc2 := ifelse(Period==&quot;Morning Peak&quot; &amp; season == &quot;Summer&quot;, SuSc2 * 0.9233, SuSc2)]
GenDT &lt;- GenDT[, SuSc2 := ifelse(Period==&quot;Evening Peak&quot; &amp; season == &quot;Summer&quot;, SuSc2 * 0.9271, SuSc2)]
GenDT &lt;- GenDT[, SuSc2 := ifelse(Period==&quot;Morning Peak&quot; &amp; season == &quot;Winter&quot;, SuSc2 * 0.8975, SuSc2)]
GenDT &lt;- GenDT[, SuSc2 := ifelse(Period==&quot;Evening Peak&quot; &amp; season == &quot;Winter&quot;, SuSc2 * 0.9089, SuSc2)]

GenDT &lt;- GenDT[, SuSc3 := meanGWh]
GenDT &lt;- GenDT[, SuSc3 := ifelse(Period==&quot;Morning Peak&quot; &amp; season == &quot;Summer&quot;, SuSc3 * 0.8466, SuSc3)]
GenDT &lt;- GenDT[, SuSc3 := ifelse(Period==&quot;Evening Peak&quot; &amp; season == &quot;Summer&quot;, SuSc3 * 0.8541, SuSc3)]
GenDT &lt;- GenDT[, SuSc3 := ifelse(Period==&quot;Morning Peak&quot; &amp; season == &quot;Winter&quot;, SuSc3 * 0.8178, SuSc3)]
GenDT &lt;- GenDT[, SuSc3 := ifelse(Period==&quot;Evening Peak&quot; &amp; season == &quot;Winter&quot;, SuSc3 * 0.7950, SuSc3)]
GenDT &lt;- GenDT[, SuSc3 := ifelse(Period==&quot;Off Peak 1&quot; &amp; season == &quot;Summer&quot;, SuSc3 * 1.1001, SuSc3)]
GenDT &lt;- GenDT[, SuSc3 := ifelse(Period==&quot;Off Peak 2&quot; &amp; season == &quot;Summer&quot;, SuSc3 * 1.0981, SuSc3)]
GenDT &lt;- GenDT[, SuSc3 := ifelse(Period==&quot;Off Peak 1&quot; &amp; season == &quot;Winter&quot;, SuSc3 * 1.1467, SuSc3)]
GenDT &lt;- GenDT[, SuSc3 := ifelse(Period==&quot;Off Peak 2&quot; &amp; season == &quot;Winter&quot;, SuSc3 * 1.1433, SuSc3)]


#Visualising shifted and original consumption two colours
  myPlot &lt;- ggplot2::ggplot(GenDT, aes(x = obsHalfHour)) +
  geom_line(aes(y=SuSc3, color=&quot;red&quot;), size=0.5) +
     geom_line(aes(y=meanGWh, color=&quot;blue&quot;), size=1.5) +
  geom_line(aes(y=SuSc1, color=&quot;green&quot;), size=0.5) +  
     geom_line(aes(y=SuSc2, color=&quot;orange&quot;), size=0.5) +  
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Effects of demand response scenarios 1-3 on total electricity generation per day&quot;) +
  scale_colour_manual(name = element_blank(), 
      values = c(&#39;red&#39;=&#39;red&#39;, &#39;blue&#39;=&#39;blue&#39;,&#39;orange&#39;=&#39;orange&#39;, &#39;green&#39;=&#39;green&#39;),  labels = c(&#39;Orig. Generation&#39;, &#39;SC1: Load curtailment&#39;, &#39;SC2: Halved load curtailment&#39;,&#39;SC3: Load shifting&#39;)) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
  scale_y_continuous( limits = c(0,3.5), expand = c(0,0) )+
  #scale_y_continuous(breaks = c(0.1)) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;04:00:00&quot;), hms::as.hms(&quot;08:00:00&quot;),       hms::as.hms(&quot;12:00:00&quot;), hms::as.hms(&quot;16:00:00&quot;), 
  hms::as.hms(&quot;20:00:00&quot;))) 
  
  myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/loading%20summer%20data%20analysis-1.png" /><!-- --></p>
<pre class="r"><code>ggsave(&quot;Effects of DR.jpeg&quot;, dpi = 600)</code></pre>
<pre><code>## Saving 7 x 5 in image</code></pre>
</div>
</div>
<div id="energy-efficiency-lighting" class="section level1">
<h1><span class="header-section-number">15</span> Energy Efficiency: Lighting</h1>
<div id="data-import" class="section level2">
<h2><span class="header-section-number">15.1</span> Data import</h2>
<pre class="r"><code>LightingHCS &lt;- data.table::as.data.table(
 readr::read_csv(&quot;/Volumes/hum-csafe/Research Projects/GREEN Grid/cleanData/safe/gridSpy/1min/dataExtracts/Lighting_2015-04-01_2016-03-31_observations.csv.gz&quot;,
                       col_types = cols(
                       hhID = col_character(),
                       linkID = col_character(),
                       r_dateTime = col_datetime(format = &quot;&quot;),
                       circuit = col_character(),
                       powerW = col_double() # &lt;- crucial otherwise readr infers integers for some reason
                     )
                 )
)

LightObsDT &lt;- data.table::as.data.table(LightingHCS)

LightObsDT &lt;- LightObsDT[, year := lubridate::year(r_dateTime)]
LightObsDT &lt;- LightObsDT[, obsHourMin := hms::as.hms(r_dateTime)]
LightObsDT &lt;- LightObsDT[, month := lubridate::month(r_dateTime)]

LightObsDT &lt;- LightObsDT[month &gt;= 12 | month == 1 | month == 2, season := &quot;Summer&quot;]
LightObsDT &lt;- LightObsDT[month &gt;= 3 | month == 4 | month == 5, season := &quot;Autumn&quot;]
LightObsDT &lt;- LightObsDT[month == 6 | month == 7 | month == 8, season := &quot;Winter&quot;]
LightObsDT &lt;- LightObsDT[month == 9 | month == 10 | month == 11, season := &quot;Spring&quot;]

#Building daily average per season

LightDT &lt;- LightObsDT[, .(meanW = mean(powerW)), keyby = .(obsHourMin, season)]



#ggplot2::ggplot(LightDT, aes(x = obsHalfHour, y = meanW, colour = season)) + #geom_line()</code></pre>
</div>
<div id="lighting-calculation-per-household" class="section level2">
<h2><span class="header-section-number">15.2</span> Lighting calculation per household</h2>
<pre class="r"><code>LEDfac &lt;- 0.11270924 # This is out of the Excel calculation
nzHouseholds &lt;- 1457464 # Census 2013 data on households (copied from HP calc)

LightDT &lt;- LightDT[, meanMWtotal := ((meanW * nzHouseholds)/1000/1000)]  
LightDT &lt;- LightDT[, meanWLed := meanW * LEDfac]
LightDT &lt;- LightDT[, meanMWLedTot := ((meanW * LEDfac * nzHouseholds)/1000/1000)]
LightDT &lt;- LightDT[, oriWh := meanW/60]
LightDT &lt;- LightDT[, oriMWhTot := (meanW/60/1000/1000) * nzHouseholds]
LightDT &lt;- LightDT[, LedWh := meanWLed/60]
LightDT &lt;- LightDT[, LedMWhTot := (meanWLed/60/1000/1000) * nzHouseholds]




consumOrigPDDT &lt;- LightDT[, .(consumOrigPDkWh = sum(meanW/60)/1000),
                          keyby = .(season)]

consumOrigTotPDDT &lt;- LightDT[, .(consumOrigTotPDGWh = sum(meanW/60 * nzHouseholds)/1000/1000/1000), keyby = .(season)]

consumOrigPYDT &lt;- LightDT[, .(consumOrigPYkWh = sum(meanW/60*90)/1000), keyby = .(season)]

consumOrigTotPYDT &lt;- LightDT[, .(consumOrigTotPYGWh = sum(meanW/60*90*nzHouseholds)/1000/1000/1000), keyby = .(season)]

consumLEDPDDT &lt;- LightDT[, .(consumLEDPDkWh = sum(meanW*LEDfac)/60/1000), keyby = .(season)]

consumLEDTotPDDT &lt;- LightDT[, .(consumLEDTotPDGWh = sum(meanW*LEDfac*nzHouseholds)/60/1000/1000/1000), keyby = .(season)]

consumLEDPYDT &lt;- LightDT[, .(consumLEDPYkWh = sum(meanW*LEDfac*90)/60/1000), keyby = .(season)]

consumLEDTotPYDT &lt;- LightDT[, .(consumLEDTotPYGWh = sum(meanW*LEDfac*90*nzHouseholds)/60/1000/1000/1000), keyby = .(season)]</code></pre>
</div>
<div id="visualisation-1" class="section level2">
<h2><span class="header-section-number">15.3</span> Visualisation</h2>
<pre class="r"><code>consumOrigPDDT #Consumption in kWh for an avg day per season for one household</code></pre>
<pre><code>##    season consumOrigPDkWh
## 1: Autumn        2.573960
## 2: Spring        2.459135
## 3: Summer        1.736652
## 4: Winter        3.472153</code></pre>
<pre class="r"><code>consumOrigTotPDDT #Consumption in GWh for an avg day per season for total NZ</code></pre>
<pre><code>##    season consumOrigTotPDGWh
## 1: Autumn           3.751455
## 2: Spring           3.584101
## 3: Summer           2.531108
## 4: Winter           5.060538</code></pre>
<pre class="r"><code>consumOrigPYDT #Consumption in kWh per season for one household</code></pre>
<pre><code>##    season consumOrigPYkWh
## 1: Autumn        231.6564
## 2: Spring        221.3222
## 3: Summer        156.2987
## 4: Winter        312.4937</code></pre>
<pre class="r"><code>consumOrigTotPYDT #Consumption in GWh per season for total NZ</code></pre>
<pre><code>##    season consumOrigTotPYGWh
## 1: Autumn           337.6309
## 2: Spring           322.5691
## 3: Summer           227.7998
## 4: Winter           455.4484</code></pre>
<pre class="r"><code>consumLEDPDDT #Consumption in kWh for an avg day per season for one household LED 100%</code></pre>
<pre><code>##    season consumLEDPDkWh
## 1: Autumn      0.2901091
## 2: Spring      0.2771673
## 3: Summer      0.1957368
## 4: Winter      0.3913437</code></pre>
<pre class="r"><code>consumLEDTotPDDT #Consumption in GWh for an avg day per season for total NZ LED 100%</code></pre>
<pre><code>##    season consumLEDTotPDGWh
## 1: Autumn         0.4228236
## 2: Spring         0.4039613
## 3: Summer         0.2852793
## 4: Winter         0.5703693</code></pre>
<pre class="r"><code>consumLEDPYDT #Consumption in kWh per season for one household LED 100%</code></pre>
<pre><code>##    season consumLEDPYkWh
## 1: Autumn       26.10982
## 2: Spring       24.94506
## 3: Summer       17.61631
## 4: Winter       35.22093</code></pre>
<pre class="r"><code>consumLEDTotPYDT #Consumption in GWh per season for total NZ LED 100%</code></pre>
<pre><code>##    season consumLEDTotPYGWh
## 1: Autumn          38.05412
## 2: Spring          36.35652
## 3: Summer          25.67514
## 4: Winter          51.33324</code></pre>
<pre class="r"><code>#Change the order in facet_grid()
LightDT$season &lt;- factor(LightDT$season, levels = c(&quot;Spring&quot;,&quot;Summer&quot;,
                                                    &quot;Autumn&quot;, &quot;Winter&quot;))

#Visualising shifted and original consumption two colours
myPlot &lt;- ggplot2::ggplot(LightDT, aes(x = obsHourMin)) +
  geom_line(aes(y=oriMWhTot, color=&quot;red&quot;), size=0.5) +
  geom_line(aes(y=LedMWhTot, color=&quot;blue&quot;), size=0.5) +
  theme(text = element_text(family = &quot;Cambria&quot;)) +
  ggtitle(&quot;Lighting energy for an average day per season total NZ&quot;) +
  scale_colour_manual(name = element_blank(), 
                      values = c(&#39;red&#39;=&#39;red&#39;, &#39;blue&#39;=&#39;blue&#39;),  labels = c(&#39;LED technology&#39;, &#39;Current technologies&#39;)) +
  facet_grid(season ~ .) +
  labs(x=&#39;Time of Day&#39;, y=&#39;Energy (MWh)&#39;) +
  #scale_y_continuous( limits = c(0,3.5), expand = c(0,0) )+
  #scale_y_continuous(breaks = c(0.1)) +
  scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), 
                          hms::as.hms(&quot;04:00:00&quot;), 
                          hms::as.hms(&quot;08:00:00&quot;),       
                          hms::as.hms(&quot;12:00:00&quot;), 
                          hms::as.hms(&quot;16:00:00&quot;), 
                          hms::as.hms(&quot;20:00:00&quot;),
                          hms::as.hms(&quot;24:00:00&quot;))) 
myPlot</code></pre>
<p><img src="heatPumpProfileAnalysis_files/figure-html/Insert%20variables%20from%20above-1.png" /><!-- --></p>
<pre class="r"><code>ggsave(&quot;Lighting energy for an average day per season total NZ.jpg&quot;, dpi=600)</code></pre>
<pre><code>## Saving 7 x 5 in image</code></pre>
</div>
</div>
<div id="myplot-example" class="section level1">
<h1><span class="header-section-number">16</span> MyPlot example</h1>
<pre class="r"><code>#sc1data &lt;- heatPumpProfileDT
#sc1data[, c(&quot;medianW&quot;, &quot;obsHourMin&quot;, &quot;meanW&quot;, &quot;nObs&quot;, &quot;sdW&quot;, &quot;scaledMWmethod1&quot;, &quot;EECApmMethod2&quot;):=NULL] #Deleting unnecessary columns

#sc1data &lt;- sc1data[, .(GWh = sum(scaledGWh)), 
                   # keyby = .(season, obsHalfHour)]

#myPlot &lt;- ggplot2::ggplot(sc1data, aes(x = obsHalfHour, color=GWh)) +
  #geom_step(aes(y=GWh), size=0.5) +
 # theme(text = element_text(family = &quot;Cambria&quot;)) +
 # ggtitle(&quot;Total New Zealand half hour heat pump energy consumption by season for 2015&quot;) +
 # facet_grid(season ~ .) +
 # labs(x=&#39;Time of Day&#39;, y=&#39;GWh&#39;) +
 # scale_y_continuous(breaks = c(3, 6, 9, 12)) +
 # scale_x_time(breaks = c(hms::as.hms(&quot;00:00:00&quot;), hms::as.hms(&quot;03:00:00&quot;), hms::as.hms(&quot;06:00:00&quot;),       hms::as.hms(&quot;09:00:00&quot;), hms::as.hms(&quot;12:00:00&quot;), 
 # hms::as.hms(&quot;15:00:00&quot;), hms::as.hms(&quot;18:00:00&quot;), hms::as.hms(&quot;21:00:00&quot;))) +
 # scale_colour_gradient(low= &quot;green&quot;, high=&quot;red&quot;, guide = &quot;colorbar&quot;)

#myPlot

#ggsave(&quot;Total New Zealand half hour heat pump energy consumption by season for 2015.jpeg&quot;,
      # dpi=600)





#Other examples

#AuMP &lt;- 38.35385
#WiMP &lt;- 96.89743
#SpMP &lt;- 39.09743
#SuMP &lt;- 23.28916
#AuEP &lt;- 29.11365
#WiEP &lt;- 75.27774
#SpEP &lt;- 35.80694
#SuEP &lt;- 10.12392

#AuNP1 &lt;- sc1data[ GWhs1[1:12 42:48]]
#AuNP2 &lt;- sc1data[ c(22:32), &quot;GWhs1&quot;]
#WiNP1 &lt;- sc1data[ c(145:156, 186:192), &quot;GWhs1&quot;]
#WiNP2 &lt;- sc1data[ c(166:176), &quot;GWhs1&quot;]
#SpNP1 &lt;- sc1data[ c(49:60, 90:96), &quot;GWhs1&quot;]
#SpNP2 &lt;- sc1data[ c(70:80), &quot;GWhs1&quot;]
#SuNP1 &lt;- sc1data[ c(97:108, 138:144), &quot;GWhs1&quot;]
#SuNP2 &lt;- sc1data[ c(118:128), &quot;GWhs1&quot;]

#sc1data &lt;- sc1data[, ShiftL := GWhs1] # Creating new column ShiftL based on GWhs1

# Updating ShiftL predefined rows with the percentage of peak-period sum. Spreading Morning Peak load over a longer duration than Evening Peak
#sc1data &lt;- sc1data[, ShiftL := AuNP1 * AuMP * 1/19]
#sc1data &lt;- sc1data[, ShiftL := WiNP1 * WiMP * 1/19]
#sc1data &lt;- sc1data[, ShiftL := SpNP1 * SpMP * 1/19]
#sc1data &lt;- sc1data[, ShiftL := SuNP1 * SuMP * 1/19]

#sc1data &lt;- sc1data[, ShiftL := AuNP2 * AuEP * 1/11]
#sc1data &lt;- sc1data[, ShiftL := WiNP2 * WiEP * 1/11]
#sc1data &lt;- sc1data[, ShiftL := SpNP2 * SpEP * 1/11]
#sc1data &lt;- sc1data[, ShiftL := SuNP2 * SuEP * 1/11]


#sc1data &lt;- sc1data[, ShiftL:= ifelse(Period == &quot;Evening Peak&quot;, 0, ShiftL )]
#sc1data &lt;- sc1data[, ShiftL:= ifelse(Period == &quot;Morning Peak&quot;, 0, ShiftL )]</code></pre>
</div>
<div id="runtime" class="section level1">
<h1><span class="header-section-number">17</span> Runtime</h1>
<p>Analysis completed in 207.99 seconds ( 3.47 minutes) using <a href="https://cran.r-project.org/package=knitr">knitr</a> in <a href="http://www.rstudio.com">RStudio</a> with R version 3.4.4 (2018-03-15) running on x86_64-apple-darwin15.6.0.</p>
</div>
<div id="r-environment" class="section level1">
<h1><span class="header-section-number">18</span> R environment</h1>
<p>R packages used:</p>
<ul>
<li>base R - for the basics <span class="citation">[@baseR]</span></li>
<li>data.table - for fast (big) data handling <span class="citation">[@data.table]</span></li>
<li>lubridate - date manipulation <span class="citation">[@lubridate]</span></li>
<li>ggplot2 - for slick graphics <span class="citation">[@ggplot2]</span></li>
<li>readr - for csv reading/writing <span class="citation">[@readr]</span></li>
<li>skimr - for skim <span class="citation">[@skimr]</span></li>
<li>knitr - to create this document &amp; neat tables <span class="citation">[@knitr]</span></li>
<li>GREENGrid - for local NZ GREEN Grid project utilities</li>
</ul>
<p>Session info:</p>
<pre><code>## R version 3.4.4 (2018-03-15)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS High Sierra 10.13.6
## 
## Matrix products: default
## BLAS: /Library/Frameworks/R.framework/Versions/3.4/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.4/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_NZ.UTF-8/en_NZ.UTF-8/en_NZ.UTF-8/C/en_NZ.UTF-8/en_NZ.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] bindrcpp_0.2.2    knitr_1.20        skimr_1.0.3       hms_0.4.2        
## [5] readr_1.1.1       lubridate_1.7.4   ggplot2_3.0.0     data.table_1.11.6
## [9] GREENGrid_0.1.0  
## 
## loaded via a namespace (and not attached):
##  [1] tidyselect_0.2.4  xfun_0.3          purrr_0.2.5      
##  [4] reshape2_1.4.3    lattice_0.20-35   colorspace_1.3-2 
##  [7] htmltools_0.3.6   yaml_2.2.0        rlang_0.2.2      
## [10] pillar_1.3.0      glue_1.3.0        withr_2.1.2      
## [13] sp_1.3-1          jpeg_0.1-8        plyr_1.8.4       
## [16] bindr_0.1.1       stringr_1.3.1     munsell_0.5.0    
## [19] gtable_0.2.0      RgoogleMaps_1.4.2 mapproj_1.2.6    
## [22] evaluate_0.11     labeling_0.3      highr_0.7        
## [25] proto_1.0.0       Rcpp_0.12.18      geosphere_1.5-7  
## [28] openssl_1.0.2     scales_1.0.0      backports_1.1.2  
## [31] rjson_0.2.20      png_0.1-7         digest_0.6.17    
## [34] stringi_1.2.4     bookdown_0.7      dplyr_0.7.6      
## [37] grid_3.4.4        rprojroot_1.3-2   cli_1.0.1        
## [40] tools_3.4.4       magrittr_1.5      maps_3.3.0       
## [43] lazyeval_0.2.1    tibble_1.4.2      crayon_1.3.4     
## [46] tidyr_0.8.1       pkgconfig_2.0.2   assertthat_0.2.0 
## [49] rmarkdown_1.10    R6_2.2.2          ggmap_2.6.1      
## [52] compiler_3.4.4</code></pre>
</div>
<div id="references" class="section level1">
<h1><span class="header-section-number">19</span> References</h1>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
